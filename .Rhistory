strip.background = element_blank()))
annual_df_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 1) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
#theme(legend.position = "none") +
#guides(color = FALSE, shape = NULL) +
facet_wrap(~ dataset) +
geom_text(aes(x, y, label = text1), data = text_df, size = 3,
hjust = 0, fontface = "bold") +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = facet_label_text, size = 5, hjust = 0.25, vjust = 0.75,
show.legend = FALSE) +
geom_point(aes(x = year, y = 9, shape = species, color = NULL), data = spYrs, alpha = 1, size = 2) +
geom_point(aes(x = year, y = 8.5, shape = NULL, color = NULL),
data = hew_yrs, alpha = 1, size = 1.5, shape = 8) +
scale_shape_manual(values = c(1, 2, 0))
text_df <- data.frame(x = c(rep(1938, 3)),
y = c(10.56, 12.9, 15.39),
text1 = c("Min", "Mean", "Max"),
dataset = rep("Air", 3),
metric = c("minimum", "median", "maximum"))
facet_label_text <- data.frame(x = rep(1922, 2),
y = rep(17.5, 2),
text1 = c("A", "B"),
dataset = c("Air", "Seawater"))
theme_set(theme_bw() +
theme(panel.background = element_blank(),
strip.background = element_blank()))
annual_df_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 1) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
#theme(legend.position = "none") +
#guides(color = FALSE, shape = NULL) +
facet_wrap(~ dataset) +
geom_text(aes(x, y, label = text1), data = text_df, size = 3,
hjust = 0, fontface = "bold") +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = facet_label_text, size = 5, hjust = 0.25, vjust = 0.75,
show.legend = FALSE) +
geom_point(aes(x = year, y = 9, shape = species, color = NULL), data = spYrs, alpha = 1, size = 2) +
geom_point(aes(x = year, y = 8.5, shape = NULL, color = NULL),
data = hew_yrs, alpha = 1, size = 1.5, shape = 8) +
scale_shape_manual(values = c(1, 2, 0))
annual_df_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 1) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "none") +
#guides(color = FALSE, shape = NULL) +
facet_wrap(~ dataset) +
geom_text(aes(x, y, label = text1), data = text_df, size = 3,
hjust = 0, fontface = "bold") +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = facet_label_text, size = 5, hjust = 0.25, vjust = 0.75,
show.legend = FALSE) +
geom_point(aes(x = year, y = 9, shape = species, color = NULL), data = spYrs, alpha = 1, size = 2) +
geom_point(aes(x = year, y = 8.5, shape = NULL, color = NULL),
data = hew_yrs, alpha = 1, size = 1.5, shape = 8) +
scale_shape_manual(values = c(1, 2, 0))
theme_set(theme_bw() +
theme(panel.background = element_blank(),
strip.background = element_blank()))
annual_df_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 1) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "none") +
#guides(color = FALSE, shape = NULL) +
facet_wrap(~ dataset) +
geom_text(aes(x, y, label = text1), data = text_df, size = 3,
hjust = 0, fontface = "bold") +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = facet_label_text, size = 5, hjust = 0.25, vjust = 0.75,
show.legend = FALSE) +
geom_point(aes(x = year, y = 9, shape = species, color = NULL), data = spYrs, alpha = 1, size = 2) +
geom_point(aes(x = year, y = 8.5, shape = NULL, color = NULL),
data = hew_yrs, alpha = 1, size = 1.5, shape = 8) +
scale_shape_manual(values = c(1, 2, 0))
?theme_set
winter_annual
# I will use the top 25th percentile of summer temps and bottom 25th percentile of winter temps
remove_data = T
summer_annual <- dat %>% group_by(dataset) %>%
do(get_summer_annual_means(., my_quant = 0.75, remove = remove_data)) %>% ungroup()
winter_annual <- dat %>% group_by(dataset) %>%
do(get_winter_annual_means(., my_quant = 0.25, remove = remove_data)) %>% ungroup()
annual_mean <- dat %>% group_by(dataset, year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup()
source("R/temperature_functions.R")
dat <- load_sst_air_data()
dat
tail(dat)
##### FILTER DATA #####
# I want a time-series starting 10 years prior to the first historic sampling year
# Childs sampled Littorina in 1947
# Hewatt sampled in 1931-1933
start_year <- 1922
dat <- dat %>% filter(year > start_year & year < 2016)
## What are the warmest and coldest months?
# dat %>% group_by(dataset, month) %>%
#   summarise(meanTemp = mean(tempC, na.rm = TRUE)) %>% ungroup() %>%
#   arrange(dataset, meanTemp) %>% View()
# Coldest == Dec, Jan, Feb
# Warmest == July, Aug, Sep
##### SELECT SUMMER, WINTER TEMPS #####
# I will use the top 25th percentile of summer temps and bottom 25th percentile of winter temps
remove_data = T
summer_annual <- dat %>% group_by(dataset) %>%
do(get_summer_annual_means(., my_quant = 0.75, remove = remove_data)) %>% ungroup()
summer_annual
winter_annual <- dat %>% group_by(dataset) %>%
do(get_winter_annual_means(., my_quant = 0.25, remove = remove_data)) %>% ungroup()
annual_mean <- dat %>% group_by(dataset, year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup()
## Collate annual data
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# # Plot
remove_data
summer_annual <- dat %>% group_by(dataset) %>%
do(get_summer_annual_means(., my_quant = 0.75, remove = remove_data)) %>% ungroup()
winter_annual <- dat %>% group_by(dataset) %>%
do(get_winter_annual_means(., my_quant = 0.25, remove = remove_data)) %>% ungroup()
annual_mean <- dat %>% group_by(dataset, year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup()
annual_mean
## Collate annual data
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
annual_mean %>%
filter(!is.na(tempC))
annual_mean
annual_mean %>%
filter(!is.na(tempC))
annual_mean %>%
filter(!is.na(mean))
## Collate annual data
annual_df <- annual_mean %>%
filter(!is.na(mean)) %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
annual_df_long
annual_df_long %>%
group_by(dataset, metric) %>%
summarise(mean(tempC, na.rm = TRUE))
text_df <- data.frame(x = c(rep(1938, 3)),
y = c(10.56, 12.9, 15.39),
text1 = c("Min", "Mean", "Max"),
dataset = rep("Air", 3),
metric = c("minimum", "median", "maximum"))
facet_label_text <- data.frame(x = rep(1922, 2),
y = rep(17.5, 2),
text1 = c("A", "B"),
dataset = c("Air", "Seawater"))
theme_set(theme_bw() +
theme(panel.background = element_blank(),
strip.background = element_blank()))
annual_df_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 1) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "none") +
#guides(color = FALSE, shape = NULL) +
facet_wrap(~ dataset) +
geom_text(aes(x, y, label = text1), data = text_df, size = 3,
hjust = 0, fontface = "bold") +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = facet_label_text, size = 5, hjust = 0.25, vjust = 0.75,
show.legend = FALSE) +
geom_point(aes(x = year, y = 9, shape = species, color = NULL), data = spYrs, alpha = 1, size = 2) +
geom_point(aes(x = year, y = 8.5, shape = NULL, color = NULL),
data = hew_yrs, alpha = 1, size = 1.5, shape = 8) +
scale_shape_manual(values = c(1, 2, 0))
ggsave("figs/temp_timeseries.pdf", height = 3.5, width = 7)
summer_annual <- dat %>% group_by(dataset) %>%
do(get_summer_annual_means(., my_quant = 0.9, remove = remove_data)) %>% ungroup()
winter_annual <- dat %>% group_by(dataset) %>%
do(get_winter_annual_means(., my_quant = 0.1, remove = remove_data)) %>% ungroup()
winter_annual
annual_mean <- dat %>% group_by(dataset, year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup()
## Collate annual data
annual_df <- annual_mean %>%
filter(!is.na(mean)) %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# # Plot
annual_df_long %>%
group_by(dataset, metric) %>%
summarise(mean(tempC, na.rm = TRUE))
text_df <- data.frame(x = c(rep(1938, 3)),
y = c(10.56, 12.9, 15.39),
text1 = c("Min", "Mean", "Max"),
dataset = rep("Air", 3),
metric = c("minimum", "median", "maximum"))
facet_label_text <- data.frame(x = rep(1922, 2),
y = rep(17.5, 2),
text1 = c("A", "B"),
dataset = c("Air", "Seawater"))
theme_set(theme_bw() +
theme(panel.background = element_blank(),
strip.background = element_blank()))
annual_df_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 1) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "none") +
#guides(color = FALSE, shape = NULL) +
facet_wrap(~ dataset) +
geom_text(aes(x, y, label = text1), data = text_df, size = 3,
hjust = 0, fontface = "bold") +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = facet_label_text, size = 5, hjust = 0.25, vjust = 0.75,
show.legend = FALSE) +
geom_point(aes(x = year, y = 9, shape = species, color = NULL), data = spYrs, alpha = 1, size = 2) +
geom_point(aes(x = year, y = 8.5, shape = NULL, color = NULL),
data = hew_yrs, alpha = 1, size = 1.5, shape = 8) +
scale_shape_manual(values = c(1, 2, 0))
annual_df_long %>%
group_by(dataset, metric) %>%
summarise(mean(tempC, na.rm = TRUE))
annual_df_long %>%
group_by(dataset, metric) %>%
summarise(mean = mean(tempC, na.rm = TRUE))
annual_df_long %>%
group_by(dataset, metric) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
filter(dataset == "Air")
air_means <- annual_df_long %>%
group_by(dataset, metric) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
filter(dataset == "Air")
air_means <- annual_df_long %>%
group_by(dataset, metric) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
filter(dataset == "Air") %>% select(mean) %>% arrange()
air_means <- annual_df_long %>%
group_by(dataset, metric) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
filter(dataset == "Air")
air_means
air_means <- annual_df_long %>%
group_by(dataset, metric) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
filter(dataset == "Air") %>% arrange(mean)
air_means
air_means
text_df <- data.frame(x = c(rep(1938, 3)),
y = air_means$mean,
text1 = c("Min", "Mean", "Max"),
dataset = rep("Air", 3),
metric = c("minimum", "median", "maximum"))
annual_df_long
text_df <- data.frame(x = c(rep(1938, 3)),
y = air_means$mean,
text1 = c("Min", "Mean", "Max"),
dataset = rep("Air", 3),
metric = c("minimum", "mean", "maximum"))
text_df <- data.frame(x = c(rep(1938, 3)),
y = air_means$mean,
text1 = c("Min", "Mean", "Max"),
dataset = rep("Air", 3),
metric = c("minimum", "mean", "maximum"))
facet_label_text <- data.frame(x = rep(1922, 2),
y = rep(24, 2),
text1 = c("A", "B"),
dataset = c("Air", "Seawater"))
theme_set(theme_bw() +
theme(panel.grid  = element_blank(),
strip.background = element_blank()))
annual_df_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 1) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "none") +
#guides(color = FALSE, shape = NULL) +
facet_wrap(~ dataset) +
geom_text(aes(x, y, label = text1), data = text_df, size = 3,
hjust = 0, fontface = "bold") +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = facet_label_text, size = 5, hjust = 0.25, vjust = 0.75,
show.legend = FALSE) +
geom_point(aes(x = year, y = 9, shape = species, color = NULL), data = spYrs, alpha = 1, size = 2) +
geom_point(aes(x = year, y = 8.5, shape = NULL, color = NULL),
data = hew_yrs, alpha = 1, size = 1.5, shape = 8) +
scale_shape_manual(values = c(1, 2, 0))
ggsave("figs/temp_timeseries.pdf", height = 3.5, width = 7)
annual_df_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 1) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "none") +
#guides(color = FALSE, shape = NULL) +
facet_wrap(~ dataset) +
geom_text(aes(x, y, label = text1), data = text_df, size = 3,
hjust = 0, fontface = "bold") +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = facet_label_text, size = 5, hjust = 0.25, vjust = 0.75,
show.legend = FALSE) +
geom_point(aes(x = year, y = 5, shape = species, color = NULL), data = spYrs, alpha = 1, size = 2) +
geom_point(aes(x = year, y = 4.5, shape = NULL, color = NULL),
data = hew_yrs, alpha = 1, size = 1.5, shape = 8) +
scale_shape_manual(values = c(1, 2, 0))
ggsave("figs/temp_timeseries.pdf", height = 3.5, width = 7)
annual_df_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 1) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "none") +
#guides(color = FALSE, shape = NULL) +
facet_wrap(~ dataset) +
geom_text(aes(x, y, label = text1), data = text_df, size = 3,
hjust = 0, fontface = "bold") +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = facet_label_text, size = 5, hjust = 0.25, vjust = 0.75,
show.legend = FALSE) +
geom_point(aes(x = year, y = 4, shape = species, color = NULL), data = spYrs, alpha = 1, size = 2) +
geom_point(aes(x = year, y = 3, shape = NULL, color = NULL),
data = hew_yrs, alpha = 1, size = 1.5, shape = 8) +
scale_shape_manual(values = c(1, 2, 0))
ggsave("figs/temp_timeseries.pdf", height = 3.5, width = 7)
annual_df_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 1) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "none") +
#guides(color = FALSE, shape = NULL) +
facet_wrap(~ dataset) +
geom_text(aes(x, y, label = text1), data = text_df, size = 3,
hjust = 0, fontface = "bold") +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = facet_label_text, size = 5, hjust = 0.25, vjust = 0.75,
show.legend = FALSE) +
geom_point(aes(x = year, y = 4.5, shape = species, color = NULL), data = spYrs, alpha = 1, size = 2) +
geom_point(aes(x = year, y = 3.5, shape = NULL, color = NULL),
data = hew_yrs, alpha = 1, size = 1.5, shape = 8) +
scale_shape_manual(values = c(1, 2, 0))
ggsave("figs/temp_timeseries.pdf", height = 3.5, width = 7)
ggsave("figs/plot_temp_timeseries.pdf", height = 3.5, width = 7)
library(grid)
source("R/choose_size_data.R")
source("R/choose_size_threshold.R")
# load data - approximated sizes
dat <- choose_size_data(method = "normal")
# Do not remove any data
dat2 <- choose_size_threshold(x = dat, era = "combined", filter_data = F) %>%
filter(!is.na(size1mm))
names(dat2)
unique(dat2$species)
# plotting functions
source("./R/multiplotF.R")
theme_set(theme_bw(base_size = 12) +
theme(strip.background = element_blank(),
#panel.grid = element_blank()),
strip.text = element_text(face = "italic")))
n_df <- dat2 %>% filter(!is.na(size1mm)) %>%
group_by(species, era) %>% summarise(n = n()) %>%
ungroup()
n_df
yr_df <- dat2 %>% filter(!is.na(size1mm)) %>%
group_by(species, era) %>% distinct(year) %>% ungroup()
facet_panels <- dat2 %>% select(species) %>% distinct() %>%
arrange(species)
facet_panels
facet_panels <- facet_panels %>%
mutate(facet_labels = paste(LETTERS)[1:3]) %>%
arrange(facet_labels) %>%
mutate(past_text = c("1963; n=817", "1950; n=493", "1947; n=682"),
present_text = c("2014; n=5646", "2015; n=605", "2014; n=733"))
dat3 <- dat2 %>%
inner_join(., facet_panels, by = c("species"))
theme_set(theme_bw(base_size = 12) +
theme(strip.background = element_blank(),
panel.grid = element_blank(),
strip.text = element_text(face = "italic")))
dat3 %>%
ggplot(aes(size1mm, fill = era)) +
geom_density(alpha = 0.5) +
facet_wrap( ~ species) +
scale_fill_manual(values = c("red", "black")) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.position = "none") +
geom_vline(aes(xintercept = size_threshold),
linetype = "dashed", color = "black", alpha = 0.65) +
geom_text(data = facet_panels, aes(0, 0.15, label = facet_labels),
inherit.aes = FALSE, size = 6, nudge_x = 1, nudge_y = 0.01) +
geom_text(data = facet_panels, aes(15, 0.115, label = past_text),
inherit.aes = FALSE, size = 4, nudge_x = 1, nudge_y = 0.01, color = "red", hjust = 0) +
geom_text(data = facet_panels, aes(15, 0.1, label = present_text),
inherit.aes = FALSE, size = 4, nudge_x = 1, nudge_y = 0.01, color = "black", hjust = 0)
## Boxplot
dat3 %>%
ggplot(aes(era, size1mm, fill = era)) +
geom_boxplot(alpha = 0.5) +
facet_wrap( ~ species) +
scale_fill_manual(values = c("red", "black")) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.position = "none")
## Boxplot
dat3 %>%
ggplot(aes(era, size1mm, fill = era)) +
geom_violin(alpha = 0.5) +
facet_wrap( ~ species) +
scale_fill_manual(values = c("red", "black")) +
xlab("Size (mm)") +
ylab("Size (mm)") +
theme(legend.position = "none")
## Boxplot
dat3 %>%
ggplot(aes(era, size1mm, fill = era)) +
geom_violin(alpha = 0.5) +
geom_boxplot() +
facet_wrap( ~ species) +
scale_fill_manual(values = c("red", "black")) +
xlab("") +
ylab("Size (mm)") +
theme(legend.position = "none") +
geom_text(data = facet_panels, aes(0, 0.15, label = facet_labels),
inherit.aes = FALSE, size = 6, nudge_x = 1, nudge_y = 0.01) +
geom_text(data = facet_panels, aes(15, 0.115, label = past_text),
inherit.aes = FALSE, size = 4, nudge_x = 1, nudge_y = 0.01, color = "red", hjust = 0) +
geom_text(data = facet_panels, aes(15, 0.1, label = present_text),
inherit.aes = FALSE, size = 4, nudge_x = 1, nudge_y = 0.01, color = "black", hjust = 0)
dat3 %>%
ggplot(aes(era, size1mm, fill = era)) +
geom_violin(alpha = 0.5) +
geom_boxplot() +
facet_wrap( ~ species) +
scale_fill_manual(values = c("red", "black")) +
xlab("") +
ylab("Size (mm)") +
theme(legend.position = "none")
## Boxplot
dat3 %>%
ggplot(aes(era, size1mm, fill = era)) +
#geom_violin(alpha = 0.5) +
geom_boxplot() +
facet_wrap( ~ species) +
scale_fill_manual(values = c("red", "black")) +
xlab("") +
ylab("Size (mm)") +
theme(legend.position = "none") +
geom_text(data = facet_panels, aes(0, 0.15, label = facet_labels),
inherit.aes = FALSE, size = 6, nudge_x = 1, nudge_y = 0.01) +
geom_text(data = facet_panels, aes(15, 0.115, label = past_text),
inherit.aes = FALSE, size = 4, nudge_x = 1, nudge_y = 0.01, color = "red", hjust = 0) +
geom_text(data = facet_panels, aes(15, 0.1, label = present_text),
inherit.aes = FALSE, size = 4, nudge_x = 1, nudge_y = 0.01, color = "black", hjust = 0)
## Boxplot
dat3 %>%
ggplot(aes(era, size1mm, fill = era)) +
#geom_violin(alpha = 0.5) +
geom_boxplot() +
facet_wrap( ~ species) +
scale_fill_manual(values = c("red", "black")) +
xlab("") +
ylab("Size (mm)") +
theme(legend.position = "none")
dat3 %>%
ggplot(aes(era, size1mm, color = era)) +
#geom_violin(alpha = 0.5) +
geom_boxplot() +
facet_wrap( ~ species) +
scale_fill_manual(values = c("red", "black")) +
xlab("") +
ylab("Size (mm)") +
theme(legend.position = "none")
