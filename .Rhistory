geom_point(alpha = 0.6, size = 2) +
#geom_line(aes(group = sampleArea), color = "gray", size = 0.5, position = dodge) +
geom_errorbar(aes(ymax = size_mean + size_CI,
ymin = size_mean - size_CI), width = 0.2, alpha = 0.6) +
labs(x = "Tidal height (m)", y = "Size (mm)") +
theme(strip.background = element_blank()) +
facet_wrap(~ species) +
guides(shape = FALSE) +
theme(legend.position = c(0, 0.0), legend.justification = c(0, 0)) +
theme(legend.title = element_blank())
head(dm2)
unique(dm2$sampleArea)
names(dm2)
names(tempMeans)
names(dm2)
names(tempMeans)
names(sizeLL)
names(tempMeans)
names(sizeLL)
View(sizeLL)
head(rawDat)
head(sizeLL)
names(rawDat)
names(sizeLL)
names(rawDat)
unique(rawDat$position)
unique(rawDat)
names(rawDat)
head(sizeLL)
sampleAreas <- unique(dat4$sampleArea)
sampleAreas
names(rawDat)
unique(rawDat$position)
loggerPositions <- unique(rawDat$position)
lpDF <- data.frame(position = loggerPositions)
head(lpDF)
lpdf
lpDF
sampleAreas
head(sizeLL)
loggerPositions
lodi <- sizeLL %>% filter(species == "Lottia digitalis")
head(lodi)
lodi <- sizeLL %>% filter(species == "Lottia digitalis") %>%
select(sampleArea, position)
head(lodi)
View(lodi)
lodi <- sizeLL %>% filter(species == "Lottia digitalis") %>%
select(sampleArea, position) %>% distinct()
head(lodi)
lodi
dat4 %>% filter(species != "Lottia digitalis") %>%
select(sampleArea) %>% unlist()
dat4 %>% filter(species != "Lottia digitalis") %>% distinct() %>%
select(sampleArea) %>% unlist()
dat4 %>% filter(species != "Lottia digitalis") %>%
select(sampleArea) %>% distinct()
dat4 %>% filter(species != "Lottia digitalis") %>%
select(sampleArea) %>% distinct() %>% unlist()
sampleAreas <- dat4 %>% filter(species != "Lottia digitalis") %>%
select(sampleArea) %>% distinct() %>% unlist()
sampleAreas
sampleAreas <- dat4 %>% filter(species != "Lottia digitalis") %>%
select(sampleArea) %>% distinct() %>% unlist(use.names = FALSE)
sampleAreas
loggerPositions
lodi
loggerPositions
names(rawDat)
loggerPositions <- rawDat %>% filter(species != "LIKE") %>%
select(position) %>% distinct() %>% unlist(use.names = FALSE)
rawDat %>% filter(species != "LIKE")
loggerPositions <- rawDat %>% filter(sp != "LIKE") %>%
select(position) %>% distinct() %>% unlist(use.names = FALSE)
loggerPositions
loggerPositions <- rawDat %>% filter(sp != "LODI") %>%
select(position) %>% distinct() %>% unlist(use.names = FALSE)
loggerPositions
lpDF <- data.frame(position = loggerPositions)
lpDF
lpDF$sampleArea <- c(rep("Wara.B", 3),
rep("Wara.D", 5),
rep("HighRock_zoneA", 2),
rep("HighRock_zoneB", 2),
rep("HighRock_zoneC", 2),
rep("HighRock_zoneD", 2))
lpDF
lodi
link_sampleArea_position <- rbind(lpDF, lodi)
link_sampleArea_position
names(rawDat2)
names(rawDat)
rawDat2 <- inner_join(rawDat, spCodes, by = "sp")
names(rawDat2)
rawDat3 <- inner_join(rawDat2, link_sampleArea_position, by = "position")
head(rawDat3)
sample_area_daily <- rawDat3 %>%
group_by(sampleArea, species, day) %>%
summarise(daily_mean = mean(tempC),
daily_med = median(tempC),
daily_max = max(tempC),
daily_min = min(tempC),
daily_cv = sd(tempC)/daily_mean) %>%
ungroup()
sample_area_daily
sadL <- sample_area_daily %>% gather(key = metric, value = tempC,
daily_mean:daily_cv)
sadL_means <- sadL %>%
group_by(species, sampleArea, metric) %>%
summarise(mean = mean(tempC),
sd = sd(tempC),
n = n(),
se = sd/sqrt(n),
CI = qt(0.975, df = n - 1) * se) %>%
ungroup()
sadL_means
names(sadL_means)
names(tempMeans)
names(dm2)
dm3 <- inner_join(dm2, sadL_means, by = c("species", "sampleArea"))
head(dm3)
dm3 %>% filter(studySub == "subset") %>%
ggplot(aes(mean, size_mean, color = era, shape = species)) +
geom_point(alpha = 0.5, size = 2) +
geom_errorbar(aes(ymax = size_mean + size_CI,
ymin = size_mean - size_CI), width = 0.2, alpha = 0.5) +
labs(x = "Temperature", y = "Size (mm)") +
theme(strip.background = element_blank()) +
guides(shape = FALSE) +
theme(legend.position = c(0.5, 1), legend.justification = c(0.5, 1)) +
theme(legend.title = element_blank()) +
facet_wrap(~ metric, scales = "free")
link_sampleArea_position
sizeLL2 <-  %>% filter(species != "Chlorostoma funebralis") %>%
select(sampleArea, position) %>% distinct()
sizeLL2 <-  sizeLL %>% filter(species != "Chlorostoma funebralis") %>%
select(sampleArea, position) %>% distinct()
sizeLL2
sizeLL
sizeLL %>% select(sampleArea, position) %>% distinct()
sizeLL2 <-  sizeLL %>% #filter(species != "Chlorostoma funebralis") %>%
select(sampleArea, position) %>% distinct()
names(sizeLL2)
unique(rawDat2$position)
rawDat3 <- inner_join(rawDat2, sizeLL2, by = "position")
head(rawDat3)
unique(rawDat3$position)
sample_area_daily <- rawDat3 %>%
group_by(sampleArea, species, day) %>%
summarise(daily_mean = mean(tempC),
daily_med = median(tempC),
daily_max = max(tempC),
daily_min = min(tempC),
daily_cv = sd(tempC)/daily_mean) %>%
ungroup()
sample_area_daily
# Get in long format
sadL <- sample_area_daily %>% gather(key = metric, value = tempC,
daily_mean:daily_cv)
# Get means of daily mean, max and min
sadL_means <- sadL %>%
group_by(species, sampleArea, metric) %>%
summarise(mean = mean(tempC),
sd = sd(tempC),
n = n(),
se = sd/sqrt(n),
CI = qt(0.975, df = n - 1) * se) %>%
ungroup()
dm3 <- inner_join(dm2, sadL_means, by = c("species", "sampleArea"))
head(dm3)
dm3 %>% filter(studySub == "subset") %>%
ggplot(aes(mean, size_mean, color = era, shape = species)) +
geom_point(alpha = 0.5, size = 2) +
geom_errorbar(aes(ymax = size_mean + size_CI,
ymin = size_mean - size_CI), width = 0.2, alpha = 0.5) +
labs(x = "Temperature", y = "Size (mm)") +
theme(strip.background = element_blank()) +
guides(shape = FALSE) +
theme(legend.position = c(0.5, 1), legend.justification = c(0.5, 1)) +
theme(legend.title = element_blank()) +
facet_wrap(~ metric, scales = "free")
dm3 %>% filter(studySub == "subset" & species == "Littorina keenae") %>%
ggplot(aes(mean, size_mean, color = era, shape = species)) +
geom_point(alpha = 0.5, size = 2) +
geom_errorbar(aes(ymax = size_mean + size_CI,
ymin = size_mean - size_CI), width = 0.2, alpha = 0.5) +
labs(x = "Temperature", y = "Size (mm)") +
theme(strip.background = element_blank()) +
guides(shape = FALSE) +
theme(legend.position = c(0.5, 1), legend.justification = c(0.5, 1)) +
theme(legend.title = element_blank()) +
facet_wrap(~ metric, scales = "free")
dm3 %>% filter(studySub == "subset" & species == "Littorina keenae") %>%
ggplot(aes(mean, size_mean, color = era, shape = species)) +
geom_point(alpha = 0.5, size = 2) +
geom_errorbar(aes(ymax = size_mean + size_CI,
ymin = size_mean - size_CI), width = 0.2, alpha = 0.5) +
labs(x = "Temperature", y = "Size (mm)") +
theme(strip.background = element_blank()) +
guides(shape = FALSE) +
theme(legend.position = c(0.5, 1), legend.justification = c(0.5, 1)) +
theme(legend.title = element_blank()) +
facet_wrap(~ metric, scales = "free") +
geom_smooth(method = "lm")
dm3 %>% filter(studySub == "subset" & species == "Littorina keenae") %>%
ggplot(aes(mean, size_mean, color = era, shape = species)) +
geom_point(alpha = 0.5, size = 2) +
geom_errorbar(aes(ymax = size_mean + size_CI,
ymin = size_mean - size_CI), width = 0.2, alpha = 0.5) +
labs(x = "Temperature", y = "Size (mm)") +
theme(strip.background = element_blank()) +
guides(shape = FALSE) +
theme(legend.position = c(0.5, 1), legend.justification = c(0.5, 1)) +
theme(legend.title = element_blank()) +
facet_wrap(~ metric, scales = "free")
library(dplyr)
library(tidyr)
library(ggplot2)
theme_set(theme_bw(base_size = 12))
library(lubridate)
# Load temperature data and size data
source("05_summarise_intertidal_temps.R")
tempMeans %>%
ggplot(aes(tidalHT, mean, shape = species, color = metric)) +
geom_point(alpha = 0.6, size = 2) +
geom_errorbar(aes(ymax = mean + CI,
ymin = mean - CI), width = 0.2, alpha = 0.6) +
labs(x = "Tidal height (m)", y = "Mean temperature (C)") +
theme(strip.background = element_blank()) +
facet_wrap(~ species) +
guides(shape = FALSE) +
theme(legend.position = "top") +
theme(legend.title = element_blank())
tempMeans %>% %>% filter(metric != "cv") %>%
ggplot(aes(tidalHT, mean, shape = species, color = metric)) +
geom_point(alpha = 0.6, size = 2) +
geom_errorbar(aes(ymax = mean + CI,
ymin = mean - CI), width = 0.2, alpha = 0.6) +
labs(x = "Tidal height (m)", y = "Mean temperature (C)") +
theme(strip.background = element_blank()) +
facet_wrap(~ species) +
guides(shape = FALSE) +
theme(legend.position = "top") +
theme(legend.title = element_blank())
## Plot means of daily mean, max and min
tempMeans %>% filter(metric != "cv") %>%
ggplot(aes(tidalHT, mean, shape = species, color = metric)) +
geom_point(alpha = 0.6, size = 2) +
geom_errorbar(aes(ymax = mean + CI,
ymin = mean - CI), width = 0.2, alpha = 0.6) +
labs(x = "Tidal height (m)", y = "Mean temperature (C)") +
theme(strip.background = element_blank()) +
facet_wrap(~ species) +
guides(shape = FALSE) +
theme(legend.position = "top") +
theme(legend.title = element_blank())
tempMeans %>% filter(metric != "daily_cv") %>%
ggplot(aes(tidalHT, mean, shape = species, color = metric)) +
geom_point(alpha = 0.6, size = 2) +
geom_errorbar(aes(ymax = mean + CI,
ymin = mean - CI), width = 0.2, alpha = 0.6) +
labs(x = "Tidal height (m)", y = "Mean temperature (C)") +
theme(strip.background = element_blank()) +
facet_wrap(~ species) +
guides(shape = FALSE) +
theme(legend.position = "top") +
theme(legend.title = element_blank())
tempMedL %>% filter(metric != "cv") %>%
ggplot(aes(tidalHT, tempC, shape = species, color = metric)) +
geom_point(alpha = 0.6, size = 2) +
labs(x = "Tidal height (m)", y = "Mean temperature (C)") +
theme(strip.background = element_blank()) +
facet_wrap(~ species) +
guides(shape = FALSE) +
theme(legend.position = "top") +
theme(legend.title = element_blank())
tempMedL %>% filter(metric == "cv") %>%
ggplot(aes(tidalHT, tempC, shape = species, color = metric)) +
geom_point(alpha = 0.6, size = 2) +
labs(x = "Tidal height (m)", y = "Mean temperature (C)") +
theme(strip.background = element_blank()) +
facet_wrap(~ species) +
guides(shape = FALSE) +
theme(legend.position = "top") +
theme(legend.title = element_blank())
pres <- dat4 %>% filter(era == "present")
# load lat long info with positions of nearest loggers
sizeLL <- read.csv("output/sizeLL_edit.csv")
unique(pres$sampleUnit)
head(pres)
suMeans <- pres %>% filter(!is.na(size1mm)) %>%
group_by(species, sp, site, nest1, nest2, sampleUnit,
sampleArea, year, lat, long, tideHTm) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se,
size_max = quantile(size1mm, 0.95),
size_median = median(size1mm)) %>%
ungroup()
suMeans %>%
ggplot(aes(tideHTm, size_mean, color = species)) +
geom_point() +
# geom_errorbar(aes(ymax = size_mean + size_CI, ymin = size_mean - size_CI)) +
geom_smooth(method = "lm") +
labs(x = "Tidal height (m)", y = "Mean size (mm)") +
theme(legend.position = c(1, 1), legend.justification = c(1, 1)) +
theme(legend.title = element_blank())
suMeans %>%
ggplot(aes(tideHTm, size_mean, color = species)) +
geom_point() +
geom_errorbar(aes(ymax = size_mean + size_CI, ymin = size_mean - size_CI)) +
geom_smooth(method = "lm") +
labs(x = "Tidal height (m)", y = "Mean size (mm)") +
theme(legend.position = c(1, 1), legend.justification = c(1, 1)) +
theme(legend.title = element_blank())
nest1Means <- pres %>% filter(!is.na(size1mm)) %>%
group_by(species, sp, site, nest1, year, lat, long, tideHTm) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se,
tidalHT_mean = mean(tideHTm, na.rm = TRUE),
size_max = quantile(size1mm, 0.95)) %>%
ungroup()
nest1Means %>%
ggplot(aes(tideHTm, size_mean, color = species)) +
geom_point(alpha = 0.5) +
geom_errorbar(aes(ymax = size_mean + size_CI, ymin = size_mean - size_CI), alpha = 0.5) +
geom_smooth(method = "lm") +
labs(x = "Tidal height (m)", y = "Mean size (mm)") +
theme(legend.position = c(1, 1), legend.justification = c(1, 1)) +
theme(legend.title = element_blank())
nest1Means %>%
ggplot(aes(tideHTm, size_max, color = species)) +
geom_point(alpha = 0.5) +
geom_smooth(method = "lm") +
labs(x = "Tidal height (m)", y = "Max size (mm)") +
theme(legend.position = c(1, 1), legend.justification = c(1, 1)) +
theme(legend.title = element_blank())
sizeLL %>% select(sampleUnit, position) %>% head()
names(pres)
pres2 <- sizeLL %>% select(sampleUnit, position) %>%
inner_join(pres, ., by = "sampleUnit")
suMeans2 <- sizeLL %>% select(sampleUnit, position) %>%
inner_join(suMeans, ., by = "sampleUnit")
suMeans2 <- sizeLL %>% select(sampleUnit, position) %>%
inner_join(suMeans, ., by = "sampleUnit")
suMeans3 <- tempMeans %>% select(position, aspect, slope, metric:CI) %>%
inner_join(suMeans2, ., by = "position")
head(suMeans3)
unique(suMeans3$metric)
suMeans3 %>% filter(metric != "daily_med") %>%
ggplot(aes(mean, size_median, color = species,
shape = species, size = size_n)) +
geom_point(alpha = 0.25) +
geom_smooth(method = "lm") +
labs(x = "Temperature (C)", y = "Median size (mm)") +
theme(legend.position = "top") +
theme(legend.title = element_blank()) +
facet_wrap(~ metric, scales = "free") +
guides(size = FALSE)
View(suMeans3)
pres2 <- pres %>% select(sampleUnit, position) %>%
inner_join(suMeans, ., by = "sampleUnit")
pres2 <- sizeLL %>% select(sampleUnit, position) %>%
inner_join(suMeans, ., by = "sampleUnit")
pres3 <- tempMeans %>% select(position, aspect, slope, metric:CI) %>%
inner_join(suMeans2, ., by = "position")
head(pres)
sizeLL
pres2 <- sizeLL %>% select(sampleUnit, position) %>%
left_join(suMeans, ., by = "sampleUnit")
pres2 <- sizeLL %>% select(sampleUnit, position) %>%
inner_join(pres, ., by = "sampleUnit")
pres3 <- tempMeans %>% select(position, aspect, slope, metric:CI) %>%
inner_join(pres2, ., by = "position")
tempMeans
head(pres3)
pres3 %>% filter(metric == "daily_max") %>%
ggplot(aes(mean, size1mm, color = species,
shape = species)) +
geom_point(alpha = 0.25) +
geom_smooth(method = "lm") +
labs(x = "Temperature (C)", y = "Size (mm)") +
theme(legend.position = "top") +
theme(legend.title = element_blank())
names(sizeLL2)
rm(list=ls(all=TRUE))
source("05_summarise_intertidal_temps.R")
##### SUMMARISE SIZE CHANGE DATA - COMPLETE #####
datMeans <- dat4 %>% filter(!is.na(size1mm)) %>%
group_by(species, sp, site, era, year, sampleArea) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se,
size_max = quantile(size1mm, 0.95)) %>%
ungroup()
datMeans
##### SUMMARISE SIZE CHANGE DATA - SUBSET #####
datMeansSub <- dat5 %>% filter(!is.na(size1mm)) %>%
group_by(species, sp, site, era, year, sampleArea) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se,
size_max = quantile(size1mm, 0.95)) %>%
ungroup()
datMeansSub
##### COMBINE 2 SUMMARIES #####
datMeans2 <- datMeans %>% mutate(studySub = "complete")
datMeansSub2 <- datMeansSub %>% mutate(studySub = "subset")
dm <- rbind(datMeans2, datMeansSub2)
##### JOIN ENVIRONMENT INFO #####
### Summarise lat-longs and tidal heights
envDat <- dat2 %>% filter(era == "present") %>%
group_by(species, site, era, sampleArea) %>%
summarise(lat_mean = mean(lat),
long_mean = mean(long),
tidalHeight = mean(tideHTm)) %>%
ungroup()
### Join snail data with env data
names(envDat)
names(datMeans)
dm2 <- envDat %>% select(sampleArea, lat_mean:tidalHeight) %>%
inner_join(dm, .,  by = "sampleArea")
dm2
names(sadL_means)
names(dm2)
dm3 <- inner_join(dm2, sadL_means, by = c("species", "sampleArea"))
head(dm3)
dm3 %>% filter(studySub == "subset" & species == "Littorina keenae") %>%
ggplot(aes(mean, size_mean, color = era, shape = species)) +
geom_point(alpha = 0.5, size = 2) +
geom_errorbar(aes(ymax = size_mean + size_CI,
ymin = size_mean - size_CI), width = 0.2, alpha = 0.5) +
labs(x = "Temperature", y = "Size (mm)") +
theme(strip.background = element_blank()) +
guides(shape = FALSE) +
theme(legend.position = c(0.5, 1), legend.justification = c(0.5, 1)) +
theme(legend.title = element_blank()) +
facet_wrap(~ metric, scales = "free")
pres <- dat4 %>% filter(era == "present")
suMeans <- pres %>% filter(!is.na(size1mm)) %>%
group_by(species, sp, site, nest1, nest2, sampleUnit,
sampleArea, year, lat, long, tideHTm) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se,
size_max = quantile(size1mm, 0.95),
size_median = median(size1mm)) %>%
ungroup()
nest1Means
nest1Means <- pres %>% filter(!is.na(size1mm)) %>%
group_by(species, sp, site, nest1, year, lat, long, tideHTm) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se,
tidalHT_mean = mean(tideHTm, na.rm = TRUE),
size_max = quantile(size1mm, 0.95)) %>%
ungroup()
suMeans2 <- sizeLL %>% select(sampleUnit, position) %>%
inner_join(suMeans, ., by = "sampleUnit")
# Now join tempMeans to size data by position
suMeans3 <- tempMeans %>% select(position, aspect, slope, metric:CI) %>%
inner_join(suMeans2, ., by = "position")
View(position_daily2)
rm(list=ls(all=TRUE))
source("05_summarise_size_data.R")
library(nlme)
library(AICcmodavg)
tempMeans
pres3 %>% filter(metric == "daily_max") %>%
ggplot(aes(mean, size1mm, color = species,
shape = species)) +
geom_point(alpha = 0.25) +
geom_smooth(method = "lm") +
labs(x = "Temperature (C)", y = "Size (mm)") +
theme(legend.position = "top") +
theme(legend.title = element_blank())
head(pres3)
head(pres3)
head(pres3)
unique(pres3$metric)
unique(pres3$sampleUnit)
unique(pres3$sampleArea)
statDat <- pres3
names(pres3)
unique(pres3$metric)
statDat <- pres3 %>% filter(metric == "mean")
statDat <- pres3 %>% filter(metric == "daily_mean")
lmeMod1 <- lme(fixed = size1mm ~ species * mean ,
random = list(~ 1 | sampleArea, ~ 1 | position),
na.action = na.omit,
data = statDat)
round(summary(lmeMod1)$tTable, 3)
meanDat <- pres3 %>% filter(metric == "daily_mean")
maxDat <- pres3 %>% filter(metric == "daily_max")
lmeMod1 <- lme(fixed = size1mm ~ species * mean,
random = list(~ 1 | sampleArea, ~ 1 | position),
na.action = na.omit,
data = maxDat)
round(summary(lmeMod1)$tTable, 3)
