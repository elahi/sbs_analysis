tserie <- xts(tserie, order.by=Date)
head(tserie)
lon <- -122.0005
lat <- 36.64
tserie <- as.vector(extract(sst, cbind(lon, lat)))
tserie <- xts(tserie, order.by=Date)
head(tserie)
lon <- -122.0001
lat <- 36.64
tserie <- as.vector(extract(sst, cbind(lon, lat)))
tserie <- xts(tserie, order.by=Date)
head(tserie)
lon <- -122.00001
lat <- 36.64
tserie <- as.vector(extract(sst, cbind(lon, lat)))
tserie <- xts(tserie, order.by=Date)
head(tserie)
lon <- -122.0000
lat <- 36.64
tserie <- as.vector(extract(sst, cbind(lon, lat)))
tserie <- xts(tserie, order.by=Date)
head(tserie)
lon <- -122.0000
lat <- 36.94
tserie <- as.vector(extract(sst, cbind(lon, lat)))
tserie <- xts(tserie, order.by=Date)
head(tserie)
#Plotting the timeseries
lat <- 36.64
lon <- -121.99999
lat <- 36.64
tserie <- as.vector(extract(sst, cbind(lon, lat)))
tserie <- xts(tserie, order.by=Date)
head(tserie)
lon <- -122.00001
lat <- 36.64
tserie <- as.vector(extract(sst, cbind(lon, lat)))
tserie <- xts(tserie, order.by=Date)
head(tserie)
par(mar = rep(2, 4))
plot(tserie, t='n', main='HadISST')
lines(tserie, col='grey')
lines(xts(runmean(tserie, 12), order.by=Date), col='red', lwd=2)
filename <- paste(lat, "-", lon, ".csv", sep = "")
filename <- paste(lat, lon, ".csv", sep = "_")
tserie <- as.vector(extract(sst, cbind(lon, lat)))
tserie <- xts(tserie, order.by=Date)
head(tserie)
#Plotting the timeseries
par(mar = rep(2, 4))
plot(tserie, t='n', main='HadISST')
lines(tserie, col='grey')
lines(xts(runmean(tserie, 12), order.by=Date), col='red', lwd=2)
dat <- read.csv("sbs_meta/hadisst/sbs_hadisst_gps.csv")
dat <- read.csv("sbs_meta/hadisst/sbs_hadisst_gps.csv")
dat <- read.csv("sbs_meta/hadisst/sbs_hadisst_gps.csv")
head(dat)
dat
sst
load_hadsst <- function(file = "../bigFiles/HadISST_sst.nc") {
b <- raster::brick(file)
raster::NAvalue(b) <- -1000
return(b)
}
sst2 <- load_hadsst()
head(sst2)
image(capture)
capture <- raster(inputfile) #Reading only the first layer
image(capture)
rm(capture)
load_hadsst <- function(file = "../bigFiles/HadISST_sst.nc") {
b <- raster::brick(file)
raster::NAvalue(b) <- -1000
return(b)
}
sst <- load_hadsst
dat <- read.csv("sbs_meta/hadisst/sbs_hadisst_gps.csv")
dat
Date <- substr(names(sst),2,11)
Date
Date <- gsub('\\.', '\\-', Date)
Date <- as.Date(Date)
names(sst)
sst <- load_hadsst
names(sst)
sst <- brick(inputfile)
sst
names(sst)
sst <- load_hadsst()
names(sst)
Date <- substr(names(sst), 2, 11)
Date
Date <- gsub('\\.', '\\-', Date)
Date <- as.Date(Date)
?extract
DAT
dat
studies <- unique(dat$study)
i = 1
study.i <- study[i]
study <- unique(dat$study)
?study
i = 1
study.i <- study[i]
study.i
dat.i <- dat %>% filter(study == study.i)
dat.i
tseries.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
tseries.i <- xts(tseries.i, order.by = Date)
head(tseries.i)
tseries.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
head(tseries.i)
View(tserie)
tseries.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
df.i <- as.data.frame(tseries.i)
head(df.i)
names(df.i) <- study.i
df.i
head(df.i)
df.i <- data.frame(Date, tseries.i)
head(df.i)
head(tserie)
tseries.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
head(Date)
study <- unique(dat$study)
i = 1
study.i <- study[i]
dat.i <- dat %>% filter(study == study.i)
tserie.i <- xts(tserie.i, order.by = Date)
tserie.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
tserie.i <- xts(tserie.i, order.by = Date)
head(tserie.i)
par(mar = rep(2, 4))
plot(tserie, t='n', main='HadISST')
lines(tserie, col='grey')
lines(xts(runmean(tserie, 12), order.by=Date), col='red', lwd=2)
head(tserie.i)
df.i <- data.frame(tserie.i)
head(df.i)
df.i <- data.frame(Date, tserie.i)
head(df.i)
names(tserie.i) <- study.i
head(tserie.i)
df.i <- data.frame(Date, tserie.i)
head(df.i)
tserie.df <- data.frame(Date, tserie.i)
View(tserie.df)
for(i in 2:length(study)){
study.i <- study[i]
dat.i <- dat %>% filter(study == study.i)
tserie.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
tserie.i <- xts(tserie.i, order.by = Date)
names(tserie.i) <- study.i
tserie.df <- cbind(tserie.df, tserie.i)
}
tserie.df
head(tserie.df)
tserie.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
tserie.i <- xts(tserie.i, order.by = Date)
names(tserie.i) <- study.i
head(tserie.i)
tserie.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
tserie.i
head(tserie.i)
?xts
str(tserie.i)
head(Date)
names(sst)
sst <- brick(inputfile)
sst <- load_hadsst()
names(sst)
Date <- substr(names(sst), 2, 11)
Date
Date <- gsub('\\.', '\\-', Date)
Date <- as.Date(Date)
head(Date)
dat
study <- unique(dat$study)
i = 1
study.i <- study[i]
dat.i <- dat %>% filter(study == study.i)
tserie.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
head(tserie.i)
str(tserie.i)
head(Date)
tserie.i <- xts(tserie.i, order.by = Date)
names(tserie.i) <- study.i
head(tserie.i)
tserie.df <- data.frame(Date, tserie.i)
head(tserie.df)
tserie.df %>%
ggplot(aes(Date, Roy2003)) + geom_line()
par(mar = rep(2, 4))
plot(tserie, t='n', main='HadISST')
lines(tserie, col='grey')
lines(xts(runmean(tserie, 12), order.by=Date), col='red', lwd=2)
runmean(tserie, 12), order.by=Date)
runmean(tserie, 12)
?runmean
tserie.df %>%
mutate(runMean = runmean(Roy2003, 12))
tserie.df %>%
mutate(runMean = runmean(Roy2003, 12)) %>%
ggplot(aes(Date, Roy2003)) + geom_line() +
geom_line(aes(Date, runMean), data = .)
tserie.df %>%
mutate(runMean = runmean(Roy2003, 12)) %>%
ggplot(aes(Date, Roy2003)) + geom_line() +
geom_line(aes(Date, runMean), data = tserie.df)
tserie.df %>%
mutate(runMean = runmean(Roy2003, 12)) %>%
ggplot(aes(Date, Roy2003)) + geom_line() +
geom_line(aes(Date, runMean))
tserie.df %>%
mutate(runMean = runmean(Roy2003, 12)) %>%
ggplot(aes(Date, Roy2003)) + geom_line() +
geom_line(aes(Date, runMean, col = "red"))
tserie.df %>%
mutate(runMean = runmean(Roy2003, 12)) %>%
ggplot(aes(Date, Roy2003)) + geom_line(col = "gray") +
geom_line(aes(Date, runMean), col = "red")
str(tserie.df)
tserie.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
head(tserie.i)
str(tserie.i)
head(Date)
names(tserie.i) <- study.i
head(tserie.i)
tserie.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
head(tserie.i)
str(tserie.i)
head(Date)
tserie.df <- data.frame(Date, tserie.i)
head(tserie.df)
tserie.df %>%
mutate(runMean = runmean(Roy2003, 12)) %>%
ggplot(aes(Date, Roy2003)) + geom_line(col = "gray") +
geom_line(aes(Date, runMean), col = "red")
tserie.df %>%
mutate(runMean = runmean(tserie.i, 12)) %>%
ggplot(aes(Date, tserie.i)) + geom_line(col = "gray") +
geom_line(aes(Date, runMean), col = "red")
tserie.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
head(tserie.i)
str(tserie.i)
head(Date)
xts(tserie.i, order.by = Date)
tserie.i2 <- xts(tserie.i, order.by = Date)
names(tserie.i) <- study.i
head(tserie.i)
tserie.i2 <- xts(tserie.i, order.by = Date)
names(tserie.i2) <- study.i
head(tserie.i2)
head(tserie.i)
tserie.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
head(tserie.i)
tserie.df <- data.frame(Date, tserie.i2)
head(tserie.df)
tserie.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
head(tserie.i)
head(Date)
str(tserie.i)
tserie.df <- data.frame(Date, tserie.i)
head(tserie.df)
tserie.df %>%
mutate(runMean = runmean(tserie.i, 12)) %>%
ggplot(aes(Date, tserie.i)) + geom_line(col = "gray") +
geom_line(aes(Date, runMean), col = "red")
tserie.df <- data.frame(Date, tserie.i) %>%
mutate(study = study.i)
head(tserie.df)
tserie.df
df.i <- data.frame(Date, tserie.i) %>%
mutate(study = study.i)
tserie.df <- df.i
tserie.df %>%
mutate(runMean = runmean(tserie.i, 12)) %>%
ggplot(aes(Date, tserie.i)) + geom_line(col = "gray") +
geom_line(aes(Date, runMean), col = "red")
for(i in 2:length(study)){
study.i <- study[i]
dat.i <- dat %>% filter(study == study.i)
tserie.i <- as.vector(extract(sst, cbind(dat.i$hadLong, dat.i$hadLat)))
df.i <- data.frame(Date, tserie.i) %>%
mutate(study = study.i)
tserie.df <- rbind(tserie.df, df.i)
}
tserie.df %>%
mutate(runMean = runmean(tserie.i, 12)) %>%
ggplot(aes(Date, tserie.i)) + geom_line(col = "gray") +
geom_line(aes(Date, runMean), col = "red") %>%
facet_wrap(~ study)
head(tserie.df)
dfHad <- tserie.df %>% group_by(study) %>%
mutate(runMean = runmean(tserie.i, 12))
dfHad
dfHad <- tserie.df %>% group_by(study) %>%
mutate(runMean = runmean(tserie.i, 12)) %>%
ungroup() %>%
rename(Temperature_C = tserie.i,
Temperature_moving_average_C = runMean)
dfHad
dfHad <- tserie.df %>% group_by(study) %>%
mutate(runMean = runmean(tserie.i, 12)) %>%
ungroup() %>%
rename(Temperature_C = tserie.i,
Moving_average_C = runMean)
dfHad
dfHad %>%
ggplot(aes(Date, Temperature_C)) + geom_line(col = "gray")
dfHad %>%
ggplot(aes(Date, Temperature_C)) + geom_line(col = "gray") +
geom_line(aes(Date, Moving_average_C), col = "red") %>%
facet_wrap(~ study)
dfHad %>%
ggplot(aes(Date, Moving_average_C)) + geom_line(col = "gray")
dfHad %>%
ggplot(aes(Date, Moving_average_C)) + geom_line(col = "gray") +
facet_wrap(~ study)
dfHad %>%
ggplot(aes(Date, Moving_average_C, col = study)) + geom_line()
dat
dfHad <- tserie.df %>% group_by(study) %>%
mutate(Moving_average_C = runmean(tserie.i, 12),
Annual_mean_C = mean(tserie.i)) %>%
ungroup() %>%
rename(Temperature_C = tserie.i)
dfHad <- tserie.df %>% group_by(study) %>%
mutate(Moving_average_C = runmean(tserie.i, 12)) %>%
ungroup() %>%
rename(Temperature_C = tserie.i)
dfHad
dfHad <- tserie.df %>% group_by(study) %>%
mutate(Moving_average_C = runmean(tserie.i, 12)) %>%
ungroup() %>%
rename(Temperature_C = tserie.i)
dfHad
dfAnnual <- dfHad %>% group_by(study, Date) %>%
summarise(mean_C = mean(Temperature_C),
max_C = max(Temperature_C),
min_C = min(Temperature_C))
dfAnnual
dfHad <- tserie.df %>% group_by(study) %>%
mutate(Moving_average_C = runmean(tserie.i, 12),
Year = year(Date)) %>%
ungroup() %>%
rename(Temperature_C = tserie.i)
dfAnnual <- dfHad %>% group_by(Year, Date) %>%
summarise(mean_C = mean(Temperature_C),
max_C = max(Temperature_C),
min_C = min(Temperature_C))
dfAnnual
dfAnnual <- dfHad %>% group_by(study, Year) %>%
summarise(mean_C = mean(Temperature_C),
max_C = max(Temperature_C),
min_C = min(Temperature_C))
dfAnnual
dfAnnL <- gather(dfAnnual, key = metric, value = Temperature_C,
mean_C:min_C)
dfAnnL <- gather(dfAnnual, key = metric, value = Temperature_C,
mean_C:min_C)
dfAnnL
dfAnnL %>%
ggplot(aes(Date, Temperature_C, col = metric)) +
geom_line() %>%
facet_wrap(~study)
dfAnnual <- dfHad %>% group_by(study, Year) %>%
summarise(mean_C = mean(Temperature_C),
max_C = max(Temperature_C),
min_C = min(Temperature_C)) %>%
ungroup()
dfAnnL <- gather(dfAnnual, key = metric, value = Temperature_C,
mean_C:min_C)
dfAnnL %>%
ggplot(aes(Date, Temperature_C, col = metric)) +
geom_line() %>%
facet_wrap(~study)
glimpse(dfAnnL)
dfAnnL %>%
ggplot(aes(Date, Temperature_C, col = metric)) +
geom_line() +
facet_wrap(~study)
dfAnnL %>%
ggplot(aes(Date, Temperature_C, col = metric))
dfHad %>%
ggplot(aes(Date, Moving_average_C, col = study)) + geom_line()
glimpse(dfAnnL)
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line() +
facet_wrap(~ study)
dat
dfHad
dat
dfHad <- tserie.df %>% group_by(study) %>%
mutate(Moving_average_C = runmean(tserie.i, 12),
Year = year(Date)) %>%
ungroup() %>%
rename(Temperature_C = tserie.i) %>%
inner_join(., dat, by = "study")
dfHad
View(dfHad)
dfAnnual <- dfHad %>% group_by(study, Year) %>%
summarise(mean_C = mean(Temperature_C),
max_C = max(Temperature_C),
min_C = min(Temperature_C),
hadYear1 = mean(hadYear1),
hadYear2 = mean(hadYear2)) %>%
ungroup()
dfAnnL <- gather(dfAnnual, key = metric, value = Temperature_C,
mean_C:min_C)
glimpse(dfAnnL)
dfHad %>%
ggplot(aes(Date, Moving_average_C, col = study)) + geom_line()
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line() +
facet_wrap(~ study)
dfAnnL
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line() +
facet_wrap(~ study) +
geom_vline(xintercept = c(hadYear1, hadYear2), linetype = "dashed")
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line() +
facet_wrap(~ study) +
geom_vline(xintercept = hadYear1)
glimpse(dfAnnL)
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line() +
facet_wrap(~ study) +
geom_vline(aes(xintercept = hadYear1))
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line() +
facet_wrap(~ study) +
geom_vline(aes(xintercept = c(hadYear1, hadYear2)), linetype = "dashed")
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line() +
facet_wrap(~ study) +
geom_vline(aes(xintercept = c(hadYear1, hadYear2)))
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line() +
facet_wrap(~ study) +
geom_vline(aes(xintercept = hadYear1), linetype = "dashed")
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line() +
facet_wrap(~ study) +
geom_vline(aes(xintercept = c(hadYear1)), linetype = "dashed")
dfAnnL
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line() +
facet_wrap(~ study) +
geom_vline(aes(xintercept = c(hadYear1, hadYear2)), linetype = "dashed")
summary(dfAnnL)
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line() +
facet_wrap(~ study) +
geom_vline(aes(xintercept = hadYear1), linetype = "dashed") +
geom_vline(aes(xintercept = hadYear2), linetype = "dashed")
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line() +
facet_wrap(~ study) +
geom_vline(aes(xintercept = hadYear1), linetype = "dashed") +
geom_vline(aes(xintercept = hadYear2), linetype = "dashed") +
geom_smooth()
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line() +
facet_wrap(~ study) +
geom_vline(aes(xintercept = hadYear1), linetype = "dashed") +
geom_vline(aes(xintercept = hadYear2), linetype = "dashed") +
geom_smooth(span = 0.1)
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_point() +
facet_wrap(~ study) +
geom_vline(aes(xintercept = hadYear1), linetype = "dashed") +
geom_vline(aes(xintercept = hadYear2), linetype = "dashed") +
geom_smooth(span = 0.5)
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line(alpha = 0.5) +
facet_wrap(~ study) +
geom_vline(aes(xintercept = hadYear1), linetype = "dashed") +
geom_vline(aes(xintercept = hadYear2), linetype = "dashed") +
geom_smooth(span = 0.5)
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line(alpha = 0.5) +
facet_wrap(~ study) +
geom_vline(aes(xintercept = hadYear1), linetype = "dashed") +
geom_vline(aes(xintercept = hadYear2), linetype = "dashed") +
geom_smooth(span = 0.25)
dfAnnL %>%
ggplot(aes(Year, Temperature_C, col = metric)) +
geom_line(alpha = 0.5) +
facet_wrap(~ study) +
geom_vline(aes(xintercept = hadYear1), linetype = "dashed") +
geom_vline(aes(xintercept = hadYear2), linetype = "dashed") +
geom_smooth(span = 0.1)
ggsave("meta_figs/hadisst_by_study.png", width = 7, height = 7)
ggsave("sbs_meta/meta_figs/hadisst_by_study.png", width = 7, height = 7)
