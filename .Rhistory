library(ggplot2)
source("R/convert_histo_to_raw.R")
source("R/choose_size_threshold.R")
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
# Size-frequency raw data, Hayford-Elahi-FHL470, 2018
he
# Size-frequency raw data, Hayford-Elahi-FHL470, 2018
he <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Shady_Cove_shelllength_rawdata_2018.csv")
he
he_present <- data.frame(
study = "Hayford-Elahi",
studySub = NA,
species = "Nucella lamellosa",
sp = "NULA",
site = "ShadyCove",
era = "present",
date = he$Date,
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = he$shell_length_mm,
size1mm_rand = he$shell_length_mm,
habitat = NA,
tideHTm = NA,
lat = NA,
long = NA,
Shaw_hab = NA,
notes = "",
notes2 = ""
)
he_present <- data.frame(
study = "Hayford-Elahi",
studySub = NA,
species = "Nucella lamellosa",
sp = "NULA",
site = "ShadyCove",
era = "present",
date = "4/1/2018",
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = he$shell_length_mm,
size1mm_rand = he$shell_length_mm,
habitat = NA,
tideHTm = NA,
lat = NA,
long = NA,
Shaw_hab = NA,
notes = "",
notes2 = ""
)
spight
# Format Spight 1968 data
spight <- spight %>%
mutate(shell_length_mm = round(shell_length_mm, 1),
frequency_of_occurence = round(frequency_of_occurence, 1))
spigh
spight
# Format Spight 1968 data
spight <- spight %>%
mutate(shell_length_mm = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0))
spight
spight %>% count(shell_length_mm)
spight %>% count(shell_length_mm) %>% print(40)
spight %>% count(shell_length_mm) %>% print(n = 40)
View(spight)
# Size-frequency counts, Spight 1968
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight
spight <- spight %>% arrange(shell_length_mm)
spight
# Size-frequency counts, Spight 1968 at Shady Cove
# Spight 1974, Ecology, Figure 2 Population IV
# Elahi digitized data
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_1974_Fig2_zoom.csv")
spight
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
count = round(frequency_of_occurence, 0))
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(size_bin, 0),
count = round(count, 0))
spight %>% count(size_bin) %>% print(n = 40)
spight %>% count(size_bin, breeding) %>% print(n = 40)
spight %>% count(size_bin, breeding) %>% print(n = 100)
spight %>% count(breeding, size_bin) %>% print(n = 100)
repeat_sizes
spight %>% count(breeding, size_bin) %>% print(n = 100)
# Breeding group is irrelevant, sum across size_bin
spight2 <- spight %>%
group_by(size_bin) %>%
summarise(count = sum(count))
spight2
# Breeding group is irrelevant, sum across size_bin
spight <- spight %>%
group_by(size_bin) %>%
summarise(count = sum(count))
spight
past_size <- repeat_sizes(size_bin_vector = spight$size_bin,
count_vector = spight$count)
past_size_norm <- get_random_sizes(size_bin_vector = spight$size_bin,
count_vector = spight$count,
size_interval = 1,
distribution = "normal")
frank_past_size_unif <- get_random_sizes(size_bin_vector = spight$size_bin,
count_vector = spight$count,
size_interval = 1,
distribution = "uniform")
past_size <- repeat_sizes(size_bin_vector = spight$size_bin,
count_vector = spight$count)
past_size_norm <- get_random_sizes(size_bin_vector = spight$size_bin,
count_vector = spight$count,
size_interval = 1,
distribution = "normal")
past_size_unif <- get_random_sizes(size_bin_vector = spight$size_bin,
count_vector = spight$count,
size_interval = 1,
distribution = "uniform")
hist(past_size, breaks = 5)
hist(past_size, breaks = 10)
hist(past_size, breaks = 20)
hist(past_size_norm, breaks = 25)
hist(past_size, breaks = 25)
hist(past_size_norm, breaks = 25)
par(mfrow = c(1,2))
hist(past_size_unif, breaks = 25)
hist(past_size_norm, breaks = 25)
# Use uniformly distributed sizes
he_past <- data.frame(
study = "Hayford-Elahi",
studySub = NA,
species = "Nucella lamellosa",
sp = "NULA",
site = "ShadyCove",
era = "past",
date = "4/1/1968",
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = past_size,
size1mm_rand = past_size_unif,
habitat = NA,
tideHTm = NA,
lat = NA,
long = NA,
Shaw_hab = NA,
notes = "day is unknown",
notes2 = ""
)
he2 <- rbind(he_present, he_past)
he2
unique(he2$date)
he2 %>% count(era)
with(he2, plot(size1mm, size1mm_rand))
# Size threshold for museum comparison
dat <- he2 %>% mutate(size_threshold = 0)
dat_sub <- choose_size_threshold_general(dat, era = "combined", my_quantile = 0.5)
dat %>% count(species, era)
dat_sub %>% count(species, era)
## Summarise across sample areas
dat_summary_all <- dat %>%
group_by(species, sp, year, era, size_threshold) %>%
summarise(size1mm_mean = mean(size1mm, na.rm = TRUE),
size1mm_sd = sd(size1mm, na.rm = TRUE),
sample_size = n()) %>%
ungroup() %>%
mutate(studySub = "threshold_none",
museum = FALSE)
frank2 <- frank2 %>%
mutate(year = ifelse(era == "past", 1968, 2018))
he2 <- he2 %>%
mutate(year = ifelse(era == "past", 1968, 2018))
he2 %>% count(era)
with(he2, plot(size1mm, size1mm_rand))
# Size threshold for museum comparison
dat <- he2 %>% mutate(size_threshold = 0)
dat_sub <- choose_size_threshold_general(dat, era = "combined", my_quantile = 0.5)
dat %>% count(species, era)
dat_sub %>% count(species, era)
## Summarise across sample areas
dat_summary_all <- dat %>%
group_by(species, sp, year, era, size_threshold) %>%
summarise(size1mm_mean = mean(size1mm, na.rm = TRUE),
size1mm_sd = sd(size1mm, na.rm = TRUE),
sample_size = n()) %>%
ungroup() %>%
mutate(studySub = "threshold_none",
museum = FALSE)
dat_summary_sub <- dat_sub %>%
group_by(species, sp, year, era, size_threshold) %>%
summarise(size1mm_mean = mean(size1mm, na.rm = TRUE),
size1mm_sd = sd(size1mm, na.rm = TRUE),
sample_size = n()) %>%
ungroup() %>%
mutate(studySub = "threshold_median",
museum = TRUE)
dat_summary <- rbind(dat_summary_all, dat_summary_sub)
he1
he2
# Save this file
write.csv("sbs_meta/scraped/HayfordElahi_2018/Hayford-Elahi_raw.csv")
# Save this file
write.csv(he2, "sbs_meta/scraped/HayfordElahi_2018/Hayford-Elahi_raw.csv")
spight
past_size
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
source("R/convert_histo_to_raw.R")
source("R/choose_size_threshold.R")
# Size-frequency counts, Spight 1968 at Shady Cove
# Spight 1974, Ecology, Figure 2 Population IV
# Student digitized data
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(shell_length_mm)
spight # why repeated bins?
# Size-frequency counts, Spight 1968 at Shady Cove
# Spight 1974, Ecology, Figure 2 Population IV
# Elahi digitized data
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_1974_Fig2_zoom.csv")
spight
# Size-frequency raw data, Hayford-Elahi-FHL470, 2018
he <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Shady_Cove_shelllength_rawdata_2018.csv")
he
# Sampling began when the tide height was -0.15m below MLLW, I use 0 below.
he_present <- data.frame(
study = "Hayford-Elahi",
studySub = NA,
species = "Nucella lamellosa",
sp = "NULA",
site = "ShadyCove",
era = "present",
date = "4/19/2018",
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = he$shell_length_mm,
size1mm_rand = he$shell_length_mm,
habitat = NA,
tideHTm = 0,
lat = 48.552,
long = -123.006,
Shaw_hab = NA,
notes = "",
notes2 = ""
)
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(size_bin, 0),
count = round(count, 0))
spight %>% count(breeding, size_bin) %>% print(n = 100)
# Breeding group is irrelevant, sum across size_bin
spight <- spight %>%
group_by(size_bin) %>%
summarise(count = sum(count))
spight
past_size <- repeat_sizes(size_bin_vector = spight$size_bin,
count_vector = spight$count)
past_size_norm <- get_random_sizes(size_bin_vector = spight$size_bin,
count_vector = spight$count,
size_interval = 1,
distribution = "normal")
past_size_unif <- get_random_sizes(size_bin_vector = spight$size_bin,
count_vector = spight$count,
size_interval = 1,
distribution = "uniform")
hist(past_size, breaks = 25)
hist(past_size_norm, breaks = 25)
par(mfrow = c(1,2))
hist(past_size_norm, breaks = 25)
hist(past_size_unif, breaks = 25)
# Use uniformly distributed sizes
# Use repeated sizes
he_past <- data.frame(
study = "Hayford-Elahi",
studySub = NA,
species = "Nucella lamellosa",
sp = "NULA",
site = "ShadyCove",
era = "past",
date = "4/1/1968",
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = past_size,
size1mm_rand = past_size_unif,
habitat = NA,
tideHTm = NA,
lat = NA,
long = NA,
Shaw_hab = NA,
notes = "day is unknown",
notes2 = ""
)
he2 <- rbind(he_present, he_past)
unique(he2$date)
he2 <- he2 %>%
mutate(year = ifelse(era == "past", 1968, 2018))
he2 %>% count(era)
with(he2, plot(size1mm, size1mm_rand))
# Save this file
write.csv(he2, "sbs_meta/scraped/HayfordElahi_2018/Hayford-Elahi_raw.csv")
he_past <- data.frame(
study = "Hayford-Elahi",
studySub = NA,
species = "Nucella lamellosa",
sp = "NULA",
site = "ShadyCove",
era = "past",
date = "4/1/1968",
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = past_size,
size1mm_rand = past_size,
habitat = NA,
tideHTm = NA,
lat = NA,
long = NA,
Shaw_hab = NA,
notes = "day is unknown",
notes2 = ""
)
he2 <- rbind(he_present, he_past)
unique(he2$date)
he2 <- he2 %>%
mutate(year = ifelse(era == "past", 1968, 2018))
he2 %>% count(era)
with(he2, plot(size1mm, size1mm_rand))
# Save this file
write.csv(he2, "sbs_meta/scraped/HayfordElahi_2018/Hayford-Elahi_raw.csv")
##### SUMMARISE #####
View(he2)
he2 %>% count(era)
# Size-frequency counts, Spight 1968 at Shady Cove
# Spight 1974, Ecology, Figure 2 Population IV
# Student digitized data
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(shell_length_mm)
spight # why repeated bins?
spight %>% print(n = 100)# why repeated bins?
spight <- spight %>% arrange(breeding_group, shell_length_mm)
spight %>% print(n = 100)# why repeated bins?
spight <- spight %>% arrange(Year, breeding_group, shell_length_mm)
spight %>% print(n = 100)# why repeated bins?
# Size-frequency counts, Spight 1968 at Shady Cove
# Spight 1974, Ecology, Figure 2 Population IV
# Student digitized data
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(Year, breeding_group, shell_length_mm)
spight %>% print(n = 100)# why repeated bins?
# Size-frequency counts, Spight 1968 at Shady Cove
# Spight 1974, Ecology, Figure 2 Population IV
# Student digitized data
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(Year, breeding_group, shell_length_mm)
spight %>% print(n = 100)# why repeated bins?
# Format Spight data
spight <- spight %>%
mutate(shell_length_mm = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0))
spight %>% count(breeding, size_bin) %>% print(n = 100)
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0))
# Size-frequency counts, Spight 1968 at Shady Cove
# Spight 1974, Ecology, Figure 2 Population IV
# Student digitized data
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(Year, breeding_group, shell_length_mm)
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0))
spight %>% count(breeding_group, size_bin) %>% print(n = 100)
spight %>% count(Year, breeding_group, size_bin) %>% print(n = 100)
spight %>% count(Year)
spight
# Breeding group is irrelevant, sum across size_bin
spight <- spight %>%
group_by(Year, size_bin) %>%
summarise(count = sum(frequency_of_occurence))
spight
# Breeding group is irrelevant, sum across size_bin
spight <- spight %>%
group_by(Year, size_bin) %>%
summarise(count = sum(frequency_of_occurence)) %>%
ungroup()
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0))
spight %>% count(Year, breeding_group, size_bin) %>% print(n = 100)
# Breeding group is irrelevant, sum across size_bin
spight <- spight %>%
group_by(Year, size_bin) %>%
summarise(count = sum(frequency_of_occurence)) %>%
ungroup()
spight
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(Year, breeding_group, shell_length_mm)
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0))
spight %>% count(Year, breeding_group, size_bin) %>% print(n = 100)
# Breeding group is irrelevant, sum across size_bin
spight <- spight %>%
group_by(Year, size_bin) %>%
summarise(count = sum(frequency_of_occurence)) %>%
ungroup()
spight
# Size-frequency counts, Spight 1968 at Shady Cove
# Spight 1974, Ecology, Figure 2 Population IV
# Student digitized data
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(Year, breeding_group, shell_length_mm)
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0))
spight %>% count(Year, breeding_group, size_bin) %>% print(n = 100)
spight
he
spight
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(Year, breeding_group, shell_length_mm)
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0))
spight %>% count(Year, breeding_group, size_bin) %>% print(n = 100)
# Breeding group is irrelevant, sum across size_bin
spight_sum <- spight %>%
group_by(Year, size_bin) %>%
summarise(count = sum(frequency_of_occurence)) %>%
ungroup()
past_size <- spight %>%
group_by(Year, breeding_group) %>%
do(., repeat_sizes(size_bin_vector = size_bin,
count_vector = frequency_of_occurence)) %>%
ungroup()
spight
past_size <- spight %>%
group_by(Year, breeding_group) %>%
do(., repeat_sizes(size_bin_vector = .$size_bin,
count_vector = frequency_of_occurence)) %>%
ungroup()
past_size <- spight %>%
group_by(Year, breeding_group) %>%
do(., repeat_sizes(size_bin_vector = .$size_bin,
count_vector = .$frequency_of_occurence)) %>%
ungroup()
# Use repeated sizes, because increments are in 1mm for both past and present
spight
Year_unique <- unique(spight$Year)
Year_unique
past_size <- vector()
past_size
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0),
yr_bg = paste(Year, breeding_group, sep = "_"))
# Size-frequency counts, Spight 1968 at Shady Cove
# Spight 1974, Ecology, Figure 2 Population IV
# Student digitized data
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(Year, breeding_group, shell_length_mm)
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0),
yr_bg = paste(Year, breeding_group, sep = "_"))
spight %>% count(Year, breeding_group, size_bin) %>% print(n = 100)
# Use repeated sizes, because increments are in 1mm for both past and present
yr_bg_unique <- unique(spight$yr_bg)
# Use repeated sizes, because increments are in 1mm for both past and present
yr_bg_unique <- unique(spight$yr_bg)
past_size <- vector()
past_size
i = 1
i = 1
# Use repeated sizes, because increments are in 1mm for both past and present
yr_bg_unique <- unique(spight$yr_bg)
past_size <- vector()
past_size
i = 1
dat_i <- spight %>% filter(yr_bg == yr_bg_unique[i])
dat_i
past_size_i <- repeat_sizes(size_bin_vector = dat_i$size_bin,
count_vector = dat_i$count)
past_size_i <- repeat_sizes(size_bin_vector = dat_i$size_bin,
count_vector = dat_i$frequency_of_occurence)
past_size_i
