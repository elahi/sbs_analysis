study = "Galloway",
studySub = NA,
species = "Chlorostoma.funebralis",
sp = "CHFU",
site = "SouthCove",
era = "present",
date = frank$Date,
nest1 = frank$`Transect#`,
nest2 = frank$`Sample#`,
nest3 = NA,
nest3note = NA,
sampleUnit = frank$SampleID,
size1mm = round(frank$Width.mm, 1),
habitat = NA,
tideHTm = frank$Elevation.above.MLLW,
lat = frank$lat,
long = frank$long,
Shaw_hab = NA,
notes = "",
notes2 = ""
)
head(frank_present)
head(frank_present)
master <- rbind(ackerman, frank_present)
names(ackerman)
names(frank_present)
ackerman <- ackerman %>%
mutate(Shaw_hab = NA, notes = "", notes2 = "")
master <- rbind(ackerman, frank_present)
master
# load cleaned up data
source("02_sbs_size_dataPrep2.R")
names(master)
names(dat4)
size(dat2)
names(dat2)
names(master)
names(dat)
unique(dat$habitat)
unique(dat$Shaw_hab)
names(dat2)
names(master)
names(dat2)
# Get tidal correction
source("R/buttonPositions.R")
# load data - repeated size bins
dat <- read.csv("./output/sbsMaster.csv", na.strings = "NA",
stringsAsFactors = FALSE) %>%
select(-c(X, row))
# load data - normally approximated sizes
dat_norm <- read.csv("./output/sbsMaster_norm.csv", na.strings = "NA",
stringsAsFactors = FALSE) %>%
select(-c(X, row))
# Add normally approximated sizes to original dataset
dat$size1mm_norm <- dat_norm$size1mm
summary(dat$size1mm_norm)
summary(dat$size1mm)
summary(mod1) # all three species included
summary(mod3) # excluding littorina
dat <- dat %>%
mutate(tideHTm_orig = tideHTm/3.28084,
tideHTm = tideHTm_orig * coef(mod1)[2] + coef(mod1)[1])
# create numeric lat-long columns
dat$lat2 <- as.numeric(substr(dat$lat, 1, 8))
dat$long2 <- as.numeric(paste("-", substr(dat$long, 1, 9), sep = ""))
dat$LL <- with(dat, paste(lat2, long2, sep = ","))
# Littorina keenae = nest1 (zoneA, zoneB, zoneC, zoneD)
dat %>% filter(sp == "LIKE") %>% distinct(nest1, .keep_all = TRUE)
# Lottia digitalis = site (areaA, areaB, areaC) and nest1 (zone1, zone2, zone3)
dat %>% filter(sp == "LODI") %>% distinct(site, nest1,.keep_all = TRUE)
# Chlorostoma funebralis = site (Wara.B, Wara.D)
dat %>% filter(sp == "CHFU") %>% distinct(site, .keep_all = TRUE)
# Create new column called 'sampleArea' based on
# the areas that were resampled in modern surveys
unique(dat$site)
unique(dat$nest1)
dat$sampleArea <- as.factor(ifelse(dat$sp == "CHFU",
paste(dat$site),
paste(dat$site, dat$nest1, sep = "_")))
# Littorina keenae = nest1 + nest2 = sampleUnit
dat %>% filter(sp == "LIKE") %>% group_by(sampleUnit) %>% tally()
# Chlorostoma funebralis = nest1 + nest2 = sampleUnit
dat %>% filter(sp == "CHFU") %>% group_by(sampleUnit) %>% tally()
dat %>% filter(sp == "CHFU") %>% distinct(site, nest1, nest2, .keep_all = TRUE) %>%
select(nest1:long) %>%
head()
# Lottia digitalis = site + nest1 + nest2 (quadrats within tidal heights)
dat %>% filter(sp == "LODI") %>% group_by(sampleUnit) %>% tally()
dat %>% filter(sp == "LODI") %>% group_by(site, nest1, nest2) %>% tally()
# Fix Lottia in present data
dat2 <- dat %>%
mutate(sampleUnit = ifelse(era == "present" & sp == "LODI",
paste(site, nest1, nest2, sep = "_"), sampleUnit))
unique(dat2$sampleUnit)
tidalHTdf <- dat2 %>% filter(!is.na(tideHTm)) %>%
group_by(sampleArea) %>%
summarise(sample_area_tidal_ht = mean(tideHTm),
sample_area_tidal_ht_orig = mean(tideHTm_orig))
tidalHTdf %>%
ggplot(aes(sample_area_tidal_ht_orig, sample_area_tidal_ht)) +
geom_point(alpha = 0.5) +
geom_abline(slope = 1, intercept = 0)
dat2 <- tidalHTdf %>% select(sampleArea, sample_area_tidal_ht) %>%
inner_join(dat2, ., by = "sampleArea")
dat2 <- dat2 %>% group_by(species) %>%
mutate(size_prop = size1mm/max(size1mm, na.rm = TRUE)) %>%
ungroup()
dat2 <- dat2 %>%
select(-c(lat, long)) %>%
rename(lat = lat2, long = long2) %>%
mutate(year = lubridate::year(dmy(date)))
head(dat2)
unique(dat2$year)
dat2 %>% group_by(species, era) %>%
summarise(minDate = min(date),
maxDate = max(date))
names(dat2)
names(master)
dat3 <- dat2 %>%
select(-c(habitat, tideHTm_orig))
names(dat3)
names(master)
dat3 <- dat2 %>%
select(-c(habitat, tideHTm_orig, sample_area_tidal_ht))
names(dat3)
names(master)
dat3 <- dat2 %>%
select(-c(habitat, tideHTm_orig, sample_area_tidal_ht, size_prop))
names(dat3)
names(dat3)
names(master)
master2 <- rbind(master, dat3)
head(dat2)
master2 <- master %>% mutate(year = year(date)) %>% rbind(., dat3)
names(master)
head(master)
?year
master2 <- master %>% mutate(year = lubridate::year(dmy(date))) %>% rbind(., dat3)
master2 <- master %>% mutate(year = lubridate::year(dmy(date))) #%>% rbind(., dat3)
summary(master$date)
unique(master$date)
unique(ackerman$date)
##### Load HayfordKing data #####
ackerman <- read_csv("sbs_meta/scraped/HayfordKing_2017/biogeo_size_change - size_raw_HHWK.csv")
ackerman
names(ackerman)
ackerman <- ackerman %>%
mutate(Shaw_hab = NA, notes = "", notes2 = "")
unique(ackerman$date)
##### Load Galloway data #####
frank <- read_csv("sbs_meta/scraped/Galloway_2017/SouthCove_Tegula-Size-Counts_Spring2017_AG-Shared_2017-10-13_size.csv") # snail size
frank_counts <- read_csv("sbs_meta/scraped/Galloway_2017/SouthCove_Tegula-Size-Counts_Spring2017_AG-Shared_2017-10-13_counts.csv")
frank <- frank_counts %>%
select(SampleID, Density.m2, Elevation.above.MLLW) %>%
left_join(frank, ., by = "SampleID")
summary(frank)
frank_transects <- frank %>% distinct(`Transect#`) %>%
mutate(lat = c("43.301949N", "43.302368N", "43.302711N", "43.303055N"),
long = c("124.39942W", "124.399239W", "124.399057W", "124.398942W"))
frank <- left_join(frank, frank_transects, by = "Transect#")
frank_present <- data.frame(
study = "Galloway",
studySub = NA,
species = "Chlorostoma.funebralis",
sp = "CHFU",
site = "SouthCove",
era = "present",
date = frank$Date,
nest1 = frank$`Transect#`,
nest2 = frank$`Sample#`,
nest3 = NA,
nest3note = NA,
sampleUnit = frank$SampleID,
size1mm = round(frank$Width.mm, 1),
habitat = NA,
tideHTm = frank$Elevation.above.MLLW,
lat = frank$lat,
long = frank$long,
Shaw_hab = NA,
notes = "",
notes2 = ""
)
head(frank_present)
unique(frank_present$date)
master <- rbind(ackerman, frank_present)
# load cleaned up data
source("02_sbs_size_dataPrep2.R")
names(dat2)
names(master)
dat3 <- dat2 %>%
select(-c(habitat, tideHTm_orig, sample_area_tidal_ht, size_prop))
names(dat3)
master2 <- master %>% mutate(year = lubridate::year(dmy(date))) #%>% rbind(., dat3)
names(master)
summary(master$date)
unique(master$date)
master2 <- master %>% mutate(year = lubridate::year(mdy(date))) #%>% rbind(., dat3)
unique(master2$year)
master <- rbind(ackerman, frank_present)
names(master)
unique(master$date)
dat3 <- dat2 %>%
select(-c(habitat, tideHTm_orig, sample_area_tidal_ht, size_prop))
names(dat3)
master2 <- master %>% mutate(year = lubridate::year(mdy(date))) #%>% rbind(., dat3)
unique(master2$year)
unique(ackerman$date)
master2 <- master %>% mutate(year = lubridate::year(mdy(date))) %>% rbind(., dat3)
master <- master %>% mutate(year = lubridate::year(mdy(date)))
names(master)
names(dat3)
dat3 <- dat2 %>%
select(-c(habitat, tideHTm_orig, sample_area_tidal_ht, size_prop, LL))
names(dat3)
ack_past <- ackerman %>%
filter(era == "past")
names(ackerman)
ack_past %>% count(size1mm)
ack_past_histo <- ack_past %>% count(size1mm)
ack_past_size_norm <- get_random_sizes(size_bin_vector = ack_past_histo$size1mm,
count_vector = ack_past_histo$n, size_interval = 1)
# Functions to convert histogram data to vector of raw sizes
source("R/convert_histo_to_raw.R")
ack_past_size_norm <- get_random_sizes(size_bin_vector = ack_past_histo$size1mm,
count_vector = ack_past_histo$n, size_interval = 1)
ack_past_size_norm
plot(ack_past$size1mm, ack_past_size_norm)
get_random_sizes
ackerman$size1mm_norm <- ack_past_size_norm
ack_past$size1mm_norm <- ack_past_size_norm
names(dat3)
ack_pres <- ackerman %>% filter(era == "present")
ack_pres <- ackerman %>% filter(era == "present") %>%
mutate(size1mm_norm = size1mm)
ackerman2 <- rbind(ack_pres, ack_past)
ackerman2
# Get past sizes
frank_past_bins <- c(3.5, 10.5, 17.5, 24.5, 31.5)
frank_past_n <- c(33, 20, 431, 446, 1)
min(frank_present$size1mm)
frank_past_size_vector <- get_random_sizes(size_bin_vector = frank_past_bins,
count_vector = frank_past_n, size_interval = 3.5)
frank_past_size_vector
hist(frank_past_size_vector)
hist(frank_past_size_vector, breaks = 10)
hist(frank_past_size_vector, breaks = 5)
hist(frank_past_size_vector, breaks = 4)
hist(frank_past_size_vector, breaks = 5)
frank_past_size_vector <- get_random_sizes(size_bin_vector = frank_past_bins,
count_vector = frank_past_n, size_interval = 3.5)
hist(frank_past_size_vector, breaks = 5)
unique(frank$Date)
frank_present <- data.frame(
study = "Galloway",
studySub = NA,
species = "Chlorostoma.funebralis",
sp = "CHFU",
site = "SouthCove",
era = "past",
date = "5/1/1968",
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = round(frank_past_size_vector, 1),
habitat = NA,
tideHTm = NA,
lat = NA,
long = NA,
Shaw_hab = NA,
notes = "",
notes2 = ""
)
frank_present
frank_present <- data.frame(
study = "Galloway",
studySub = NA,
species = "Chlorostoma.funebralis",
sp = "CHFU",
site = "SouthCove",
era = "past",
date = "5/1/1968",
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = round(frank_past_size_vector, 1),
habitat = NA,
tideHTm = NA,
lat = NA,
long = NA,
Shaw_hab = NA,
notes = "day-month is unknown",
notes2 = ""
)
##### Load Galloway data #####
frank <- read_csv("sbs_meta/scraped/Galloway_2017/SouthCove_Tegula-Size-Counts_Spring2017_AG-Shared_2017-10-13_size.csv") # snail size
frank_counts <- read_csv("sbs_meta/scraped/Galloway_2017/SouthCove_Tegula-Size-Counts_Spring2017_AG-Shared_2017-10-13_counts.csv")
frank <- frank_counts %>%
select(SampleID, Density.m2, Elevation.above.MLLW) %>%
left_join(frank, ., by = "SampleID")
summary(frank)
frank_transects <- frank %>% distinct(`Transect#`) %>%
mutate(lat = c("43.301949N", "43.302368N", "43.302711N", "43.303055N"),
long = c("124.39942W", "124.399239W", "124.399057W", "124.398942W"))
frank <- left_join(frank, frank_transects, by = "Transect#")
frank_present <- data.frame(
study = "Galloway",
studySub = NA,
species = "Chlorostoma.funebralis",
sp = "CHFU",
site = "SouthCove",
era = "present",
date = frank$Date,
nest1 = frank$`Transect#`,
nest2 = frank$`Sample#`,
nest3 = NA,
nest3note = NA,
sampleUnit = frank$SampleID,
size1mm = round(frank$Width.mm, 1),
habitat = NA,
tideHTm = frank$Elevation.above.MLLW,
lat = frank$lat,
long = frank$long,
Shaw_hab = NA,
notes = "",
notes2 = ""
)
head(frank_present)
unique(frank_present$date)
# Get past sizes
frank_past_bins <- c(3.5, 10.5, 17.5, 24.5, 31.5)
frank_past_n <- c(33, 20, 431, 446, 1)
frank_past_size_vector <- get_random_sizes(size_bin_vector = frank_past_bins,
count_vector = frank_past_n, size_interval = 3.5)
hist(frank_past_size_vector, breaks = 5)
frank_past <- data.frame(
study = "Galloway",
studySub = NA,
species = "Chlorostoma.funebralis",
sp = "CHFU",
site = "SouthCove",
era = "past",
date = "5/1/1968",
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = round(frank_past_size_vector, 1),
habitat = NA,
tideHTm = NA,
lat = NA,
long = NA,
Shaw_hab = NA,
notes = "day-month is unknown",
notes2 = ""
)
frank2 <- rbind(frank_present, frank_past)
master <- rbind(ackerman, frank_present)
frank2
frank2 %>% count(era)
master <- rbind(ackerman2, frank2)
names(frank2)
names(ackerman2)
frank_past_size <- repeat_sizes(size_bin_vector = frank_past_bins,
count_vector = frank_past_n)
frank_past_size
frank_past_size_norm <- get_random_sizes(size_bin_vector = frank_past_bins,
count_vector = frank_past_n, size_interval = 3.5)
hist(frank_past_size, breaks = 5)
hist(frank_past_size_norm, breaks = 5)
frank_present <- data.frame(
study = "Galloway",
studySub = NA,
species = "Chlorostoma.funebralis",
sp = "CHFU",
site = "SouthCove",
era = "present",
date = frank$Date,
nest1 = frank$`Transect#`,
nest2 = frank$`Sample#`,
nest3 = NA,
nest3note = NA,
sampleUnit = frank$SampleID,
size1mm = round(frank$Width.mm, 1),
size1mm_norm = round(frank$Width.mm, 1),
habitat = NA,
tideHTm = frank$Elevation.above.MLLW,
lat = frank$lat,
long = frank$long,
Shaw_hab = NA,
notes = "",
notes2 = ""
)
head(frank_present)
unique(frank_present$date)
# Get past sizes
frank_past_bins <- c(3.5, 10.5, 17.5, 24.5, 31.5)
frank_past_n <- c(33, 20, 431, 446, 1)
frank_past_size <- repeat_sizes(size_bin_vector = frank_past_bins,
count_vector = frank_past_n)
frank_past_size_norm <- get_random_sizes(size_bin_vector = frank_past_bins,
count_vector = frank_past_n, size_interval = 3.5)
hist(frank_past_size, breaks = 5)
hist(frank_past_size_norm, breaks = 5)
frank_past <- data.frame(
study = "Galloway",
studySub = NA,
species = "Chlorostoma.funebralis",
sp = "CHFU",
site = "SouthCove",
era = "past",
date = "5/1/1968",
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = frank_past_size
size1mm_norm = round(frank_past_size_norm, 1),
habitat = NA,
tideHTm = NA,
lat = NA,
long = NA,
Shaw_hab = NA,
notes = "day-month is unknown",
notes2 = ""
)
frank_past <- data.frame(
study = "Galloway",
studySub = NA,
species = "Chlorostoma.funebralis",
sp = "CHFU",
site = "SouthCove",
era = "past",
date = "5/1/1968",
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = frank_past_size,
size1mm_norm = round(frank_past_size_norm, 1),
habitat = NA,
tideHTm = NA,
lat = NA,
long = NA,
Shaw_hab = NA,
notes = "day-month is unknown",
notes2 = ""
)
frank2 <- rbind(frank_present, frank_past)
frank2 %>% count(era)
with(frank2, plot(size1mm, size1mm_norm))
master <- rbind(ackerman2, frank2)
names(master)
names(dat3)
unique(master$study)
dat3 <- dat2 %>%
select(-c(habitat, tideHTm_orig, sample_area_tidal_ht, size_prop, LL)) %>%
mutate(study = "Elahi2015",
studySub = NA)
names(dat3)
names(master)
master <- master %>%
mutate(year = lubridate::year(mdy(date)),
sampleArea = NA)
names(master)
names(dat3)
names(master)
master <- rbind(ackerman2, frank2)
names(master)
master <- master %>%
mutate(year = lubridate::year(mdy(date)),
sampleArea = NA)
names(master)
master2 <- rbind(master, dat3)
names(master) %in% names(dat3)
names(dat3)
sort(names(dat3))
sort(names(master))
unique(master$habitat)
dat3 <- dat2 %>%
select(-c(habitat, tideHTm_orig, sample_area_tidal_ht, size_prop, LL, Shaw_hab)) %>%
mutate(study = "Elahi2015",
studySub = NA)
names(dat3)
master <- master %>%
mutate(year = lubridate::year(mdy(date)),
sampleArea = NA) %>%
select(-c(habitat, Shaw_hab))
names(master)
master2 <- rbind(master, dat3)
master2 %>%
ggplot(aes(era, size1mm_norm)) +
geom_violin() +
facet_wrap(~ species)
master2 %>%
ggplot(aes(era, size1mm_norm)) +
geom_violin() +
facet_wrap(~ species + study)
master2 %>%
ggplot(aes(era, size1mm)) +
geom_violin() +
facet_wrap(~ species + study)
master2 %>%
ggplot(aes(era, size1mm_norm)) +
geom_violin() +
facet_wrap(~ species + study)
