inner_join(., facet_panels, by = c("species", "era"))
## Make separate dataframes
# Littorina keenae
childsDF <- droplevels(filter(dat6, sp == "LIKE"))
childsPast <- childsDF %>% filter(era == "past")
childsPres <- childsDF %>% filter(era == "present")
# Chlorostoma funebralis
waraDF <- droplevels(filter(dat6, sp == "CHFU"))
waraPast <- waraDF %>% filter(era == "past")
waraPres <- waraDF %>% filter(era == "present")
# Lottia digitalis
hexDF <- droplevels(filter(dat6, sp == "LODI"))
hexPast <- hexDF %>% filter(era == "past")
hexPres <- hexDF %>% filter(era == "present")
##### Chlorostoma #####
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 200))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red") +
ylim(0, 32)
set.seed(128)
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 200))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
ylim(0, 32)
set.seed(128)
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 200))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red") +
ylim(0, 32)
set.seed(118)
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 200))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red") +
ylim(0, 32)
set.seed(82)
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 200))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red") +
ylim(0, 32)
set.seed(82)
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 300))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red") +
ylim(0, 32)
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red")
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red") +
ylim(0, 38)
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red")
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red") +
ylim(0, 40)
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red")
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red") +
ylim(0, 42)
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red") +
ylim(0, 45)
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red") +
ylim(0, 50)
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red") +
ylim(0, 75)
set.seed(82)
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 250))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red")
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.15, stackratio = 1.1,
fill = "red")
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 300))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.15, stackratio = 1.1,
fill = "red")
set.seed(84)
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 300))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.15, stackratio = 1.1,
fill = "red") +
ylim(0, 75)
set.seed(12)
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 300))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.15, stackratio = 1.1,
fill = "red")
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 300))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.15, stackratio = 1.1,
fill = "red") +
ylim(0, 50)
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.16, stackratio = 1.1,
fill = "red") +
ylim(0, 50)
theme_set(theme_bw(base_size = 16))
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 300))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.16, stackratio = 1.1,
fill = "red") +
ylim(0, 50)
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 300))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.16, stackratio = 1.1,
fill = "red") +
ylim(0, 50) +
ylab("Size (mm)") +
xlab("Number of snails")
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.16, stackratio = 1.1,
fill = "red") +
ylim(0, 50) +
ylab("Size (mm)") +
xlab("Number of snails") +
scale_x_continuous(breaks = seq(0, 30, by = 2))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.16, stackratio = 1.1,
fill = "red") +
ylim(0, 50) +
xlab("Size (mm)") +
ylab("Number of snails") +
scale_x_continuous(breaks = seq(0, 30, by = 2))
ggsave("hms_open_house/chlorostoma_dotplot.png")
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.16, stackratio = 1,
fill = "red") +
ylim(0, 50) +
xlab("Size (mm)") +
ylab("Number of snails") +
scale_x_continuous(breaks = seq(0, 30, by = 2))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.16, stackratio = 1,
fill = "red", alpha = 0.8) +
ylim(0, 50) +
xlab("Size (mm)") +
ylab("Number of snails") +
scale_x_continuous(breaks = seq(0, 30, by = 2))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.16, stackratio = 1,
fill = "red", alpha = 0.5) +
ylim(0, 50) +
xlab("Size (mm)") +
ylab("Number of snails") +
scale_x_continuous(breaks = seq(0, 30, by = 2))
theme_set(theme_bw(base_size = 20))
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 300))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.16, stackratio = 1,
fill = "red", alpha = 0.5) +
ylim(0, 50) +
xlab("Size (mm)") +
ylab("Number of snails") +
scale_x_continuous(breaks = seq(0, 30, by = 2))
ggsave("hms_open_house/chlorostoma_dotplot.png")
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.16, stackratio = 1,
fill = "red", alpha = 0.8) +
ylim(0, 50) +
xlab("Size (mm)") +
ylab("Number of snails") +
scale_x_continuous(breaks = seq(0, 30, by = 2))
ggsave("hms_open_house/chlorostoma_dotplot.png")
source("03_identify_size_cutoff.R")
dat4
facet_panels <- dat4 %>% select(species, era) %>% distinct() %>%
arrange(species, era)
facet_panels
facet_panels <- facet_panels %>%
mutate(facet_labels = paste(LETTERS)[1:6]) %>%
arrange(facet_labels)
dat6 <- dat4 %>%
inner_join(., facet_panels, by = c("species", "era"))
childsDF <- droplevels(filter(dat6, sp == "LIKE"))
childsPast <- childsDF %>% filter(era == "past")
childsPres <- childsDF %>% filter(era == "present")
waraDF <- droplevels(filter(dat6, sp == "CHFU"))
waraPast <- waraDF %>% filter(era == "past")
waraPres <- waraDF %>% filter(era == "present")
hexDF <- droplevels(filter(dat6, sp == "LODI"))
hexPast <- hexDF %>% filter(era == "past")
hexPres <- hexDF %>% filter(era == "present")
set.seed(82)
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 200))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.18, stackratio = 1.1,
fill = "red") +
ylim(0, 32)
set.seed(12)
theme_set(theme_bw(base_size = 20))
wara_sample <- data.frame(size1mm = sample(waraPast$size1mm, size = 300))
wara_sample %>%
ggplot(aes(size1mm)) +
geom_dotplot(binwidth = 2, method = "histodot", dotsize = 0.16, stackratio = 1,
fill = "red", alpha = 0.8) +
ylim(0, 50) +
xlab("Size (mm)") +
ylab("Number of snails") +
scale_x_continuous(breaks = seq(0, 30, by = 2))
ggsave("hms_open_house/chlorostoma_dotplot.png")
?save
save(file = "hms_open_house/hms_open_house_script.RData")
save.image(file = "hms_open_house/hms_open_house_script.RData")
library(grid)
# load data
source("03_identify_size_cutoff.R")
# plotting functions
source("./R/multiplotF.R")
head(dat4)
##### TRY FACETTING #####
facet_panels <- dat4 %>% select(species, era) %>% distinct() %>%
arrange(species, era)
facet_panels
facet_panels <- facet_panels %>%
mutate(facet_labels = paste(LETTERS)[1:6]) %>%
arrange(facet_labels)
dat6 <- dat4 %>%
inner_join(., facet_panels, by = c("species", "era"))
dat6 %>%
ggplot(aes(size1mm)) +
geom_histogram(aes(y = ..density.. * 100), binwidth = 1,
color = "black", fill = "gray") +
facet_grid(era ~ species, switch = "y") +
geom_vline(aes(xintercept = size0.05), linetype = "dashed", color = "red") +
labs(x = "Size (mm)", y = "Frequency (%)") +
theme(strip.background = element_blank()) +
geom_text(data = facet_panels, aes(0.1, 18, label = facet_labels),
inherit.aes = FALSE)
#ggsave("figs/sbs_fig1.png", height = 3.5, width = 7)
##### SEPARATE PANEL WITH MULTIPLOT #####
## Make separate dataframes
# Littorina keenae
childsDF <- droplevels(filter(dat6, sp == "LIKE"))
childsPast <- childsDF %>% filter(era == "past")
childsPres <- childsDF %>% filter(era == "present")
# Chlorostoma funebralis
waraDF <- droplevels(filter(dat6, sp == "CHFU"))
waraPast <- waraDF %>% filter(era == "past")
waraPres <- waraDF %>% filter(era == "present")
# Lottia digitalis
hexDF <- droplevels(filter(dat6, sp == "LODI"))
hexPast <- hexDF %>% filter(era == "past")
hexPres <- hexDF %>% filter(era == "present")
# Basic function to plot histogram for any subset of data
plot_histo_panel <- function(df, bin_width = 1) {
p <- ggplot(df,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = bin_width,
color = "black", fill = "gray") +
xlab("Size (mm)") + ylab("Proportion") +
geom_vline(aes(xintercept = size0.05),
linetype = "dashed", color = "black", alpha = 0.65)
return(p)
}
# Need to customize for each panel:
theme_set(theme_bw(base_size = 10))
# theme_set(theme_bw(base_size = 10) +
#             theme(panel.grid = element_blank()))
fig1a <- plot_histo_panel(waraPast, bin_width = 2) +
scale_x_continuous(limits = c(2, 32)) +
scale_y_continuous(limits = c(0, 0.31)) +
annotate("text", label = "1963\nn = 817",
x = 32, y = 0.31, size = 2.2, vjust = 1, hjust = 1) +
annotate("text", label = "A",
x = 2, y = 0.31, vjust = 1, hjust = -0.05) +
ggtitle("Chlorostoma funebralis") +
theme(plot.title = element_text(size = 6, face = "italic",
hjust = 0.5, vjust = 0.9))
fig1b <- plot_histo_panel(waraPres, bin_width = 2) +
scale_x_continuous(limits = c(2, 32)) +
scale_y_continuous(limits = c(0, 0.31)) +
annotate("text", label = "2014\nn = 5995",
x = 32, y = 0.31, size = 2.2, vjust = 1, hjust = 1) +
annotate("text", label = "B",
x = 2, y = 0.31, vjust = 1, hjust = -0.05)
fig1c <- plot_histo_panel(hexPast) +
scale_x_continuous(limits = c(5, 25)) +
scale_y_continuous(limits = c(0, 0.2)) +
annotate("text", label = "1950\nn = 492",
x = 25, y = 0.2, size = 2.2, vjust = 1, hjust = 1) +
annotate("text", label = "C",
x = 5, y = 0.2, vjust = 1, hjust = -0.05) +
ggtitle("Lottia digitalis") +
theme(plot.title = element_text(size = 6, face = "italic",
hjust = 0.5, vjust = 0.9))
fig1d <- plot_histo_panel(hexPres) +
scale_x_continuous(limits = c(5, 25)) +
scale_y_continuous(limits = c(0, 0.2)) +
annotate("text", label = "2015\nn = 587",
x = 25, y = 0.2, size = 2.2, vjust = 1, hjust = 1) +
annotate("text", label = "D",
x = 5, y = 0.2, vjust = 1, hjust = -0.05)
fig1e <- plot_histo_panel(childsPast) +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
annotate("text", label = "1947\nn = 682",
x = 21, y = 0.2, size = 2.2, vjust = 1, hjust = 1) +
annotate("text", label = "E",
x = 1, y = 0.2, vjust = 1, hjust = -0.05) +
ggtitle("Littorina keenae") +
theme(plot.title = element_text(size = 6, face = "italic",
hjust = 0.5, vjust = 0.9))
fig1f <- plot_histo_panel(childsPres) +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
annotate("text", label = "2014\nn = 733",
x = 21, y = 0.2, size = 2.2, vjust = 1, hjust = 1) +
annotate("text", label = "F",
x = 1, y = 0.2, vjust = 1, hjust = -0.05)
###############################
# save as 7 x 3.5 pdf
pdf("./figs/sbs_fig1.pdf", 7, 3.5)
multiplot(fig1a, fig1b, fig1c, fig1d, fig1e, fig1f, cols = 3)
dev.off()
png("./figs/sbs_fig1.png", width = 7, height = 3.5, units = "in", res = 300)
multiplot(fig1a, fig1b, fig1c, fig1d, fig1e, fig1f, cols = 3)
dev.off()
glimpse(dm2)
source("05_summarise_size_data.R")
glimpse(dm2)
theme_set(theme_bw(base_size = 12))
size_change_text <- data.frame(x = rep(7.5, 3),
y = rep(20, 3),
text1 = c("A", "B", "C"),
species = c("Chlorostoma funebralis",
"Lottia digitalis",
"Littorina keenae"))
ggDat <- dm2 %>% filter(studySub == "subset")
ggDat_gray <- ggDat %>% select(- species)
dodge <- position_dodge(0.1)
ggDat %>%
ggplot(aes(tidalHeight, size_mean, color = era, shape = species)) +
geom_point(alpha = 0.6, size = 2) +
geom_errorbar(aes(ymax = size_mean + size_CI,
ymin = size_mean - size_CI), width = 0.1, alpha = 0.6) +
labs(x = "Tidal height (m)", y = "Size (mm)") +
theme(strip.background = element_blank(),
strip.text = element_text(face = "italic")) +
facet_wrap(~ species) +
guides(shape = FALSE) +
theme(legend.position = c(0, 0.0), legend.justification = c(0, 0)) +
theme(legend.title = element_blank()) +
scale_color_manual(values = c("darkgray", "black")) +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = size_change_text, size = 5, hjust = 1, show.legend = FALSE)
ggsave("figs/elahi_size_era_tidal_3panel.pdf", height = 3.5, width = 7)
ggDat %>%
ggplot(aes(tidalHeight, size_mean, color = era, shape = species)) +
geom_point(alpha = 0.8, size = 2) +
geom_errorbar(aes(ymax = size_mean + size_CI,
ymin = size_mean - size_CI), width = 0.1, alpha = 0.8) +
labs(x = "Tidal height (m)", y = "Size (mm)") +
theme(strip.background = element_blank(),
strip.text = element_text(face = "italic")) +
facet_wrap(~ species) +
guides(shape = FALSE) +
theme(legend.position = c(0.05, 0.05), legend.justification = c(0.05, 0.05)) +
theme(legend.title = element_blank()) +
scale_color_manual(values = c("darkgray", "black")) +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = size_change_text, size = 5, hjust = 1, show.legend = FALSE)
#ggsave("figs/elahi_size_era_tidal_3panel.png", height = 3.5, width = 7)
ggsave("figs/elahi_size_era_tidal_3panel.pdf", height = 3.5, width = 7)
ggDat %>%
ggplot(aes(tidalHeight, size_mean, color = era, shape = species)) +
geom_point(alpha = 0.8, size = 2) +
geom_errorbar(aes(ymax = size_mean + size_CI,
ymin = size_mean - size_CI), width = 0.1, alpha = 0.8) +
labs(x = "Tidal height (m)", y = "Size (mm)") +
theme(strip.background = element_blank(),
strip.text = element_text(face = "italic")) +
facet_wrap(~ species) +
guides(shape = FALSE) +
theme(legend.position = c(0.025, 0.025), legend.justification = c(0.025, 0.025)) +
theme(legend.title = element_blank()) +
scale_color_manual(values = c("darkgray", "black")) +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = size_change_text, size = 5, hjust = 1, show.legend = FALSE)
ggsave("figs/elahi_size_era_tidal_3panel.pdf", height = 3.5, width = 7)
glimpse(datMeans4)
theme_set(theme_bw(base_size = 12) +
theme(strip.background = element_blank(),
strip.text = element_text(face = "italic")))
source("05_summarise_size_density.R")
glimpse(datMeans4)
theme_set(theme_bw(base_size = 12) +
theme(strip.background = element_blank(),
strip.text = element_text(face = "italic")))
datMeans4 %>% filter(sp == "CHFU") %>%
ggplot(aes(density_m2, size_mm, color = era)) +
geom_point(alpha = 0.5) +
facet_wrap(~ site) +
geom_smooth(method = "lm") +
scale_x_log10()
datMeans4 %>%
ggplot(aes(tideHTm, size_mm, color = era)) +
geom_point(alpha = 0.5) +
facet_wrap(~ species) +
geom_smooth(method = "lm")
datMeans4 %>%
ggplot(aes(tideHTm, density_m2, color = era)) +
geom_point(alpha = 0.5) +
facet_wrap(~ species) +
geom_smooth(method = "lm")
give.n <- function(x){
return(c(y = 0, label = length(x)))
}
datMeans4 %>%
ggplot(aes(era, size_mm)) +
geom_boxplot() +
facet_wrap(~ species, scales = "free_y") +
stat_summary(fun.data = give.n, geom = "text")
give.n <- function(x){
return(c(y = 0, label = length(x)))
}
datMeans4 %>%
ggplot(aes(era, density_m2)) +
geom_boxplot(notch = FALSE) +
facet_wrap(~ species, scales = "free_y") +
stat_summary(fun.data = give.n, geom = "text")
datMeans4 %>% filter(sp == "CHFU") %>%
ggplot(aes(tideHTm, density_m2, color = era)) +
geom_point(alpha = 0.75, size = 2) +
facet_wrap(~ site, scales = "free") +
geom_line()
geom_smooth(fill = NA) +
geom_smooth(show.legend = FALSE)
size_dens_text <- data.frame(x = rep(1500, 3),
y = rep(3, 3),
text1 = c("A", "B", "C"),
species = c("Chlorostoma funebralis",
"Lottia digitalis",
"Littorina keenae"))
datMeans4 %>%
ggplot(aes(density_m2, size_mm, shape = species, color = era)) +
geom_point(alpha = 0.75, size = 2) +
facet_wrap(~ species) +
scale_x_log10() +
theme(legend.position = c(0, 0.0), legend.justification = c(0, 0)) +
theme(legend.title = element_blank()) +
theme(legend.key = element_rect(fill = "white")) +
xlab(expression(paste("Density (no. ", m^-2, ")"))) +
ylab("Mean size (mm)") +
guides(shape = FALSE) +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = size_dens_text, size = 5, hjust = 1, show.legend = FALSE)  +
scale_color_manual(values = c("darkgray", "black"))
ggsave("figs/elahi_size_era_density_3panel.pdf", height = 3.5, width = 7)
datMeans4 %>%
ggplot(aes(density_m2, size_mm, shape = species, color = era)) +
geom_point(alpha = 0.75, size = 2) +
facet_wrap(~ species) +
scale_x_log10() +
theme(legend.position = c(0.01, 0.01), legend.justification = c(0.01, 0.01)) +
theme(legend.title = element_blank()) +
theme(legend.key = element_rect(fill = "white")) +
xlab(expression(paste("Density (no. ", m^-2, ")"))) +
ylab("Mean size (mm)") +
guides(shape = FALSE) +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = size_dens_text, size = 5, hjust = 1, show.legend = FALSE)  +
scale_color_manual(values = c("darkgray", "black"))
ggsave("figs/elahi_size_era_density_3panel.pdf", height = 3.5, width = 7)
