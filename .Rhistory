site = c(rep("Wara.B", length(waraB)),
rep("Wara.D", length(waraD))))
waraPast <- data.frame(row = "",
species = "Chlorostoma.funebralis",
sp = "CHFU",
site = c(rep("Wara.B", length(waraB)),
rep("Wara.D", length(waraD))),
era = "past",
date = "6/1/63",
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = c(waraB, waraD),
habitat = NA,
tideHTm = NA,
lat = NA,
long = NA,
Shaw_hab = NA,
notes = "",
notes2 = ""
)
detach("package:mirt", unload = TRUE)
#################################################
# Combine all three
library(dplyr)
sbsMaster <- rbind(mod, childsPast, waraPast)
glimpse(sbsMaster)
summary(sbsMaster)
sbsMaster$row <- seq(1:length(sbsMaster$sp))
# Subset the three species with historical size-frequency distributions
sbsMaster2 <- filter(sbsMaster, sp == "LIKE" |
sp == "CHFU" |
sp == "LODI")
sbsMaster2 <- droplevels(sbsMaster2)
summary(sbsMaster2)
write.csv(sbsMaster2, './output/sbsMaster.csv')
unique(sbsMaster2$notes)
with(sbsMaster2, table(notes))
sbsMaster3 <- sbsMaster2 %>% filter(notes != "hermit crab")
sbsMaster3 <- sbsMaster2 %>% filter(notes != "hermit crab" &
notes ! = "brunnei")
sbsMaster3 <- sbsMaster2 %>% filter(notes != "hermit crab" &
notes != "brunnei")
summary(sbsMaster3)
sbsMaster3 <- sbsMaster2 %>% filter(notes != "hermit crab" &
notes != "brunnei"&
notes != "(hc)" &
notes != "2 snails - calliostoma and brunnei")
summary(sbsMaster3)
sbsMaster3 <- droplevels(sbsMaster3)
unique(sbsMaster3$notes)
with(sbsMaster3, table(notes))
write.csv(sbsMaster3, './output/sbsMaster.csv')
#######################################
library(ggplot2)
theme_set(theme_classic(base_size = 8))
library(dplyr)
rm(list=ls(all=TRUE))
# plotting functions
source("./R/multiplotF.R")
# load modern data
dat <- read.csv("./output/sbsMaster.csv", na.strings = "NA")
# Littorina keenae
childsDF <- droplevels(filter(dat, sp == "LIKE"))
summary(childsDF)
waraDF <- droplevels(filter(dat, sp == "CHFU"))
summary(waraDF)
# Lottia digitalis
hexDF <- droplevels(filter(dat, sp == "LODI"))
summary(waraDF)
waraPres <- droplevels(waraPres[complete.cases(waraPres$size1mm), ])
waraDF <- droplevels(waraDF[complete.cases(waraDF$size1mm), ])
summary(waraDF)
summary(hexDF)
hexSub <- hexDF %>% filter(size1mm > 5.95)
with(hexSub, table(era, nest1, site))
childsPast <- childsDF %>% filter(era == "past")
childsPres <- childsDF %>% filter(era == "present")
childsSub <- childsDF[childsDF$nest1 != "zoneD", ]
childsSub <- childsDF[childsDF$nest1 != "zoneD", ]
childsSubPres <- childsSub %>% filter(era == "present")
childsSubPast <- childsSub %>% filter(era == "past")
#################################################
# Author: Robin Elahi
# Date: 150717
# Analysis of historical and modern gastropod body sizes
# Hopkins Marine Station
# Data preparation
#################################################
library(dplyr)
rm(list=ls(all=TRUE))
# load modern data, along with historic data for Lottia (Hexter)
mod <- read.csv("./data/SBSmaster_150717.csv", na.strings = c("NA"))
summary(mod)
# load historic data
childs <- read.csv("./data/childs_raw.csv", na.strings = c("NA", ""))
wara <- read.csv("./data/wara_raw.csv", na.strings = c("NA", ""))
# need to expand these size-frequency tables
childs
wara # only resampled area B and area D
# use package "mirt"
# frequency column needs to be rightmost
library(mirt)
#################################################
# Childs - Littorina keenae
childsA <- childs %>% select(length_mm, count_A) %>% expand.table()
childsB <- childs %>% select(length_mm, count_B) %>% expand.table()
childsC <- childs %>% select(length_mm, count_C) %>% expand.table()
childsD <- childs %>% select(length_mm, count_D) %>% expand.table()
mod %>% filter(sp == "LIKE") %>% glimpse()
childsPast <- data.frame(row = "",
species = "Littorina.keenae",
sp = "LIKE",
site = "HighRock",
era = "past",
date = "6/14/47",
nest1 = c(rep("zoneA", length(childsA)),
rep("zoneB", length(childsB)),
rep("zoneC", length(childsC)),
rep("zoneD", length(childsD))),
nest2 = "area1",
nest3 = NA,
nest3note = NA,
sampleUnit = "",
size1mm = c(childsA, childsB, childsC, childsD),
habitat = "bare rock",
tideHTm = "",
lat = "36.62183N",
long = "121.90516W",
Shaw_hab = NA,
notes = "",
notes2 = ""
)
#################################################
### Wara - Chlorostoma funebralis
waraB <- wara %>% select(length_mm, count_B) %>% expand.table()
waraD <- wara %>% select(length_mm, count_D) %>% expand.table()
mod %>% filter(sp == "CHFU") %>% glimpse()
waraPast <- data.frame(size1mm = c(waraB, waraD),
site = c(rep("Wara.B", length(waraB)),
rep("Wara.D", length(waraD))))
waraPast <- data.frame(row = "",
species = "Chlorostoma.funebralis",
sp = "CHFU",
site = c(rep("Wara.B", length(waraB)),
rep("Wara.D", length(waraD))),
era = "past",
date = "6/1/63",
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = c(waraB, waraD),
habitat = NA,
tideHTm = NA,
lat = NA,
long = NA,
Shaw_hab = NA,
notes = "",
notes2 = ""
)
detach("package:mirt", unload = TRUE)
#################################################
# Combine all three
library(dplyr)
sbsMaster <- rbind(mod, childsPast, waraPast)
glimpse(sbsMaster)
summary(sbsMaster)
sbsMaster$row <- seq(1:length(sbsMaster$sp))
# Subset the three species with historical size-frequency distributions
sbsMaster2 <- filter(sbsMaster, sp == "LIKE" |
sp == "CHFU" |
sp == "LODI")
sbsMaster2 <- droplevels(sbsMaster2)
summary(sbsMaster2)
# remove CHFU that were hermit crabs or brunnei
unique(sbsMaster2$notes)
with(sbsMaster2, table(notes))
sbsMaster3 <- sbsMaster2 %>% filter(notes != "hermit crab" &
notes != "brunnei"&
notes != "(hc)" &
notes != "2 snails - calliostoma and brunnei")
sbsMaster3 <- droplevels(sbsMaster3)
unique(sbsMaster3$notes)
with(sbsMaster3, table(notes))
write.csv(sbsMaster3, './output/sbsMaster.csv')
#################################################
# Author: Robin Elahi
# Date: 150717
# Analysis of historical and modern gastropod body sizes
# Hopkins Marine Station
# Data preparation
#################################################
library(dplyr)
rm(list=ls(all=TRUE))
# load modern data, along with historic data for Lottia (Hexter)
mod <- read.csv("./data/SBSmaster_150717.csv", na.strings = c("NA"))
summary(mod)
# load historic data
childs <- read.csv("./data/childs_raw.csv", na.strings = c("NA", ""))
wara <- read.csv("./data/wara_raw.csv", na.strings = c("NA", ""))
# need to expand these size-frequency tables
childs
wara # only resampled area B and area D
# use package "mirt"
# frequency column needs to be rightmost
library(mirt)
#################################################
# Childs - Littorina keenae
childsA <- childs %>% select(length_mm, count_A) %>% expand.table()
childsB <- childs %>% select(length_mm, count_B) %>% expand.table()
childsC <- childs %>% select(length_mm, count_C) %>% expand.table()
childsD <- childs %>% select(length_mm, count_D) %>% expand.table()
mod %>% filter(sp == "LIKE") %>% glimpse()
childsPast <- data.frame(row = "",
species = "Littorina.keenae",
sp = "LIKE",
site = "HighRock",
era = "past",
date = "6/14/47",
nest1 = c(rep("zoneA", length(childsA)),
rep("zoneB", length(childsB)),
rep("zoneC", length(childsC)),
rep("zoneD", length(childsD))),
nest2 = "area1",
nest3 = NA,
nest3note = NA,
sampleUnit = "",
size1mm = c(childsA, childsB, childsC, childsD),
habitat = "bare rock",
tideHTm = "",
lat = "36.62183N",
long = "121.90516W",
Shaw_hab = NA,
notes = "",
notes2 = ""
)
#################################################
### Wara - Chlorostoma funebralis
waraB <- wara %>% select(length_mm, count_B) %>% expand.table()
waraD <- wara %>% select(length_mm, count_D) %>% expand.table()
mod %>% filter(sp == "CHFU") %>% glimpse()
waraPast <- data.frame(size1mm = c(waraB, waraD),
site = c(rep("Wara.B", length(waraB)),
rep("Wara.D", length(waraD))))
waraPast <- data.frame(row = "",
species = "Chlorostoma.funebralis",
sp = "CHFU",
site = c(rep("Wara.B", length(waraB)),
rep("Wara.D", length(waraD))),
era = "past",
date = "6/1/63",
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = c(waraB, waraD),
habitat = NA,
tideHTm = NA,
lat = NA,
long = NA,
Shaw_hab = NA,
notes = "",
notes2 = ""
)
detach("package:mirt", unload = TRUE)
#################################################
# Combine all three
library(dplyr)
sbsMaster <- rbind(mod, childsPast, waraPast)
glimpse(sbsMaster)
summary(sbsMaster)
sbsMaster$row <- seq(1:length(sbsMaster$sp))
# Subset the three species with historical size-frequency distributions
sbsMaster2 <- filter(sbsMaster, sp == "LIKE" |
sp == "CHFU" |
sp == "LODI")
sbsMaster2 <- droplevels(sbsMaster2)
summary(sbsMaster2)
# remove CHFU that were hermit crabs or brunnei
unique(sbsMaster2$notes)
with(sbsMaster2, table(notes))
sbsMaster3 <- sbsMaster2 %>% filter(notes != "hermit crab" &
notes != "brunnei"&
notes != "(hc)" &
notes != "2 snails - calliostoma and brunnei")
sbsMaster3 <- droplevels(sbsMaster3)
unique(sbsMaster3$notes)
with(sbsMaster3, table(notes))
write.csv(sbsMaster3, './output/sbsMaster.csv')
####################################
library(ggplot2)
theme_set(theme_classic(base_size = 8))
library(dplyr)
rm(list=ls(all=TRUE))
# plotting functions
source("./R/multiplotF.R")
# load modern data
dat <- read.csv("./output/sbsMaster.csv", na.strings = "NA")
###############################################################
# Littorina keenae
childsDF <- droplevels(filter(dat, sp == "LIKE"))
summary(childsDF)
childsPast <- childsDF %>% filter(era == "past")
childsPres <- childsDF %>% filter(era == "present")
# exclude zoneD
childsSub <- childsDF[childsDF$nest1 != "zoneD", ]
childsSubPres <- childsSub %>% filter(era == "present")
childsSubPast <- childsSub %>% filter(era == "past")
waraDF <- droplevels(filter(dat, sp == "CHFU"))
summary(waraDF)
waraDF <- droplevels(waraDF[complete.cases(waraDF$size1mm), ])
waraPast <- waraDF %>% filter(era == "past")
waraPres <- waraDF %>% filter(era == "present")
hexDF <- droplevels(filter(dat, sp == "LODI"))
summary(hexDF)
# truncate to > 5.95mm
hexSub <- hexDF %>% filter(size1mm > 5.95)
with(hexSub, table(era, nest1, site))
with(hexSub, table(era, site))
hexPast <- hexSub %>% filter(era == "past")
hexPres <- hexSub %>% filter(era == "present")
ULClabel <- theme(plot.title = element_text(hjust = -0.08, vjust = 1,
size = rel(1)))
no_legend <- theme(legend.position = "none")
axisLabels1 <- xlab("Size (mm)") + ylab("Frequency (%)")
fig1a <- ggplot(childsSubPast,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Littorina keenae\n1947\nn = 650",
x = 18, y = 0.16, size = 2.2)
fig1b <- ggplot(childsSubPres,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
labs(title = "B") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Littorina keenae\n2014\nn = 683",
x = 18, y = 0.16, size = 2.2)
fig1c <- ggplot(hexPast,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(5, 25)) +
scale_y_continuous(limits = c(0, 0.22)) +
labs(title = "C") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Lottia digitalis\n1950\nn = 390",
x = 20, y = 0.15, size = 2.2)
fig1d <- ggplot(hexPres,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(5, 25)) +
scale_y_continuous(limits = c(0, 0.22)) +
labs(title = "D") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Lottia digitalis\n2015\nn = 378",
x = 20, y = 0.15, size = 2.2)
fig1e <- ggplot(waraPast,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 2,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(2, 32)) +
scale_y_continuous(limits = c(0, 0.31)) +
labs(title = "E") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Chlorostoma funebralis\n1963\nn = 817",
x = 25, y = 0.25, size = 2.2)
summary(waraPres)
fig1f <- ggplot(waraPres,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 2,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(2, 32)) +
scale_y_continuous(limits = c(0, 0.31)) +
labs(title = "F") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Chlorostoma funebralis\n2014\nn = 5995",
x = 25, y = 0.25, size = 2.2)
# save as 7 x 3.5 pdf
pdf("./figs/sbs_fig1.pdf", 7, 3.5)
multiplot(fig1a, fig1b, fig1c, fig1d, fig1e, fig1f, cols = 3)
dev.off()
fig1c <- ggplot(hexPast,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(5, 25)) +
scale_y_continuous(limits = c(0, 0.20)) +
labs(title = "C") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Lottia digitalis\n1950\nn = 492",
x = 20, y = 0.15, size = 2.2)
fig1d <- ggplot(hexPres,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(5, 25)) +
scale_y_continuous(limits = c(0, 0.20)) +
labs(title = "D") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Lottia digitalis\n2015\nn = 587",
x = 20, y = 0.15, size = 2.2)
fig1e <- ggplot(waraPast,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 2,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(2, 32)) +
scale_y_continuous(limits = c(0, 0.31)) +
labs(title = "E") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Chlorostoma funebralis\n1963\nn = 817",
x = 25, y = 0.25, size = 2.2)
summary(waraPres)
fig1f <- ggplot(waraPres,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 2,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(2, 32)) +
scale_y_continuous(limits = c(0, 0.31)) +
labs(title = "F") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Chlorostoma funebralis\n2014\nn = 5995",
x = 25, y = 0.25, size = 2.2)
# multiplot(fig1a, fig1b, fig1c, fig1d, fig1e, fig1f, cols = 3)
###############################
# save as 7 x 3.5 pdf
pdf("./figs/sbs_fig1.pdf", 7, 3.5)
multiplot(fig1a, fig1b, fig1c, fig1d, fig1e, fig1f, cols = 3)
dev.off()
ggplot(childsPast,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Littorina keenae\n1947\nn = 650",
x = 18, y = 0.16, size = 2.2)
ggplot(childsPres,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
labs(title = "B") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Littorina keenae\n2014\nn = 683",
x = 18, y = 0.16, size = 2.2)
fig1aSub <- ggplot(childsSubPast,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Littorina keenae\n1947\nn = 650",
x = 18, y = 0.16, size = 2.2)
fig1a <- ggplot(childsPast,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Littorina keenae\n1947\nn = 682",
x = 18, y = 0.16, size = 2.2)
fig1bSub <- ggplot(childsSubPres,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
labs(title = "B") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Littorina keenae\n2014\nn = 683",
x = 18, y = 0.16, size = 2.2)
fig1b <- ggplot(childsPres,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
labs(title = "B") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Littorina keenae\n2014\nn = 733",
x = 18, y = 0.16, size = 2.2)
fig1c <- ggplot(hexPast,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(5, 25)) +
scale_y_continuous(limits = c(0, 0.20)) +
labs(title = "C") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Lottia digitalis\n1950\nn = 492",
x = 20, y = 0.15, size = 2.2)
fig1d <- ggplot(hexPres,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(5, 25)) +
scale_y_continuous(limits = c(0, 0.20)) +
labs(title = "D") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Lottia digitalis\n2015\nn = 587",
x = 20, y = 0.15, size = 2.2)
fig1e <- ggplot(waraPast,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 2,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(2, 32)) +
scale_y_continuous(limits = c(0, 0.31)) +
labs(title = "E") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Chlorostoma funebralis\n1963\nn = 817",
x = 25, y = 0.25, size = 2.2)
summary(waraPres)
fig1f <- ggplot(waraPres,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 2,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(2, 32)) +
scale_y_continuous(limits = c(0, 0.31)) +
labs(title = "F") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Chlorostoma funebralis\n2014\nn = 5995",
x = 25, y = 0.25, size = 2.2)
# multiplot(fig1a, fig1b, fig1c, fig1d, fig1e, fig1f, cols = 3)
###############################
# save as 7 x 3.5 pdf
pdf("./figs/sbs_fig1.pdf", 7, 3.5)
multiplot(fig1a, fig1b, fig1c, fig1d, fig1e, fig1f, cols = 3)
dev.off()
ks.test(waraPast$size1mm, waraPres$size1mm)
ks.test(childsPast$size1mm, childsPres$size1mm)
ks.test(hexPast$size1mm, hexPres$size1mm)
