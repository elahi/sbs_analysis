data = statDat)
anova(mod1)
summary(mod1)
datMeans4 %>%
ggplot(aes(era, density_m2, color = era)) +
geom_boxplot(notch = FALSE) +
facet_wrap(~ species, scales = "free_y") +
stat_summary(fun.data = give.n, geom = "text", show.legend = FALSE) +
ylab(expression(paste("Density (no. ", m^-2, ")"))) +
xlab("") +
theme(legend.position = "none")
datMeans4 %>%
ggplot(aes(era, density_m2, color = era)) +
geom_boxplot(notch = FALSE) +
facet_wrap(~ species, scales = "free_y") +
#stat_summary(fun.data = give.n, geom = "text", show.legend = FALSE) +
ylab(expression(paste("Density (no. ", m^-2, ")"))) +
xlab("") +
theme(legend.position = "none")
aic_table <- data.frame(cbind(data.frame(mod.aicctab)[1],
round(data.frame(mod.aicctab)[2:8], 3)))
print(mod.aicctab, digits=2, LL=TRUE)
x_range <- range(statDat$dens_log)
x_min <- min(statDat$dens_log)
x_max <- max(statDat$dens_log)
dens_log = seq(x_min, x_max, 0.01)
x_length = length(dens_log)
new.dat <- data.frame(dens_log = rep(dens_log, 3))
new.dat$species <- c(rep("Chlorostoma funebralis", 262),
rep("Littorina keenae", 262),
rep("Lottia digitalis", 262))
x_length
new.dat
786/2
new.dat$era <- c(rep("past", 786/2),
rep("present", 786/2))
plot(bestMod)
new.dat$pred <- predict(bestMod, newdata = new.dat, level=0)
new.dat$dens <- 10 ^ new.dat$dens_log
new.dat %>%
ggplot(aes(dens, pred)) +
#geom_point(size = 0.1) +
facet_wrap(~ species) +
geom_smooth(method = "lm")
new.dat %>%
ggplot(aes(dens, pred, color = era)) +
#geom_point(size = 0.1) +
facet_wrap(~ species) +
geom_smooth(method = "lm")
new.dat %>%
ggplot(aes(dens, pred, color = era)) +
#geom_point(size = 0.1) +
facet_wrap(~ species) +
geom_smooth(method = "lm") +
scale_x_log10()
"Littorina keenae"))
datMeans4 %>%
ggplot(aes(era, density_m2, color = era)) +
geom_boxplot(notch = FALSE) +
facet_wrap(~ species, scales = "free_y") +
#stat_summary(fun.data = give.n, geom = "text", show.legend = FALSE) +
ylab(expression(paste("Density (no. ", m^-2, ")"))) +
xlab("") +
theme(legend.position = "none")
datMeans4 %>%
ggplot(aes(density_m2, size_mm, shape = species, color = era)) +
geom_point(alpha = 0.75, size = 2) +
facet_wrap(~ species) +
scale_x_log10() +
theme(legend.position = c(0, 0.0), legend.justification = c(0, 0)) +
theme(legend.title = element_blank()) +
theme(legend.key = element_rect(fill = "white")) +
xlab(expression(paste("Density (no. ", m^-2, ")"))) +
ylab("Size (mm)") +
guides(shape = FALSE) +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = size_dens_text, size = 5, hjust = 1, show.legend = FALSE) +
geom_smooth(data = subset(datMeans4, sp == "CHFU" & era == "present" &
site == "Wara.B"),
method = "lm", linetype = "solid", fill = NA) +
geom_smooth(data = subset(datMeans4, sp == "CHFU" & era == "present" &
site == "Wara.B"),
method = "lm", linetype = "solid", show.legend = FALSE) +
geom_smooth(data = subset(datMeans4, sp == "CHFU" & era == "present" &
site == "Wara.D"),
method = "lm", linetype = "solid", fill = NA) +
geom_smooth(data = subset(datMeans4, sp == "CHFU" & era == "present" &
site == "Wara.D"),
method = "lm", linetype = "solid", show.legend = FALSE)
datMeans4 %>%
ggplot(aes(tideHTm, density_m2, color = era)) +
geom_point(alpha = 0.5) +
facet_wrap(~ species) +
geom_smooth(method = "lm")
datMeans4 %>%
ggplot(aes(tideHTm, size_mm, color = era)) +
geom_point(alpha = 0.5) +
facet_wrap(~ species) +
geom_smooth(method = "lm")
source("03_identify_size_cutoff.R")
dat4 # complete dataset
dat5 # subset without smallest size classes
# load size-density data from wara figs 2 and 5
wara <- read_csv("data/Wara_1963_fig2_fig6.csv")
wara_histo <- read_csv("data/wara_raw.csv")
wara_histo
dat4 %>% group_by(sp, site, era, year, nest1, nest2) %>% tally() %>% ungroup() %>% View()
wara_histo <- read_csv("data/wara_raw.csv") %>%
rename(Wara.B = count_A, Wara.D = count_D)
wara_histo
whl <- wara_histo %>%
select(length_mm, Wara.B, Wara.D) %>%
gather(key = site, value = snail_count, Wara.B:Wara.D)
whl
wara_histo
whl <- wara_histo %>%
select(length_mm, Wara.B, Wara.D) %>%
gather(key = length_mm, value = snail_count, Wara.B:Wara.D)
whl
whl <- wara_histo %>%
select(length_mm, Wara.B, Wara.D) %>%
gather(key = area, value = snail_count, Wara.B:Wara.D)
whl
wara_histo
wara_histo <- read_csv("data/wara_raw.csv") %>%
rename(Wara.B = count_B, Wara.D = count_D)
wara_histo
whl <- wara_histo %>%
select(length_mm, Wara.B, Wara.D) %>%
gather(key = area, value = snail_count, Wara.B:Wara.D)
whl
whl <- wara_histo %>%
select(length_mm, Wara.B, Wara.D) %>%
gather(key = site, value = snail_count, Wara.B:Wara.D)
whl %>%
ggplot(aes(length_mm, snail_count, color = site)) +
geom_line()
whl %>% group_by(site) %>%
summarise(total_snails = sum(snail_count))
total_snails <- whl %>% group_by(site) %>%
summarise(total_snails = sum(snail_count)) %>%
mutate(transect_length_m = c(14, 67))
total_snails
total_snails <- whl %>% group_by(site) %>%
summarise(total_snails = sum(snail_count)) %>%
mutate(transect_length_m = c(14, 67),
transect_area = transect_length_m * 2)
total_snails
total_snails <- whl %>% group_by(site) %>%
summarise(total_snails_m2 = sum(snail_count)) %>%
mutate(transect_length_m = c(14, 67),
transect_area = transect_length_m * 2,
transect_snail_count_total = total_snails_m2 * transect_area)
total_snails
total_snails
wara <- read_csv("data/Wara_1963_fig2_fig6.csv")
wara %>%
ggplot(aes(m_along_transect, density_m2)) +
facet_wrap(~ area, scales = "free", nrow = 2) +
geom_line()
wara
View(wara)
wara %>%
ggplot(aes(m_along_transect, density_m2)) +
facet_wrap(~ area, scales = "free", nrow = 2) +
geom_line()
wara_mean <- wara %>% group_by(area) %>%
summarise(dens_mean = mean(density_m2))
wara_area <- wara %>% group_by(area) %>%
summarise(start_m = min(m_along_transect),
end_m = max(m_along_transect)) %>%
mutate(transect_dist = end_m - start_m,
area_m2 = transect_dist * 2)
wara_area2 <- inner_join(wara_area, wara_mean, by = "area")
wara_area2 <- wara_area2 %>%
mutate(snail_number = area_m2 * dens_mean)
wara_area2
waraPast <- wara %>%
mutate(sp = "CHFU",
species = "Chlorostoma funebralis",
tideHTm = tide_ht_ft/3.28084,
site = ifelse(area == "areaB", "Wara.B", "Wara.D"),
era = "past") %>%
select(density_m2, size_mm, species, sp, tideHTm, site, era)
waraPast
wara_area2
wara <- read_csv("data/Wara_1963_fig2_fig6.csv")
wara
wara %>%
ggplot(aes(m_along_transect, density_m2)) +
facet_wrap(~ area, scales = "free", nrow = 2) +
geom_line()
wara %>%
ggplot(aes(m_along_transect, density_m2, color = area)) +
#facet_wrap(~ area, scales = "free", nrow = 2) +
geom_line()
wara_mean <- wara %>% group_by(area) %>%
summarise(dens_mean = mean(density_m2))
wara_area <- wara %>% group_by(area) %>%
summarise(start_m = min(m_along_transect),
end_m = max(m_along_transect)) %>%
mutate(transect_dist = end_m - start_m,
area_m2 = transect_dist * 2)
wara_area2 <- inner_join(wara_area, wara_mean, by = "area")
wara_area2 <- wara_area2 %>%
mutate(snail_number = area_m2 * dens_mean)
wara_area2
total_snails <- whl %>% group_by(site) %>%
summarise(total_snails_m2 = sum(snail_count)) %>%
mutate(transect_length_m = c(14, 68.75),
transect_area = transect_length_m * 2,
transect_snail_count_total = total_snails_m2 * transect_area)
total_snails
wara
wara <- wara %>%
mutate(snail_count = density_m2 * 2)
wara
wara <- wara %>%
mutate(snail_count = density_m2 * m_along_transect * 2)
wara
wara <- wara %>%
mutate(transect_interval = ifelse(area == "areaB", 1, 2.75),
snail_count = density_m2 * transect_interval * 2)
wara
wara_area2
wara %>% group_by(area) %>% summarise(total_snails = sum(snail_count))
total_snails
View(wara)
wara <- read_csv("data/Wara_1963_fig2_fig6.csv")
wara <- wara %>%
mutate(transect_interval = ifelse(area == "areaB", 1, 2.75),
snail_count = density_m2 * transect_interval * 2)
wara %>%
ggplot(aes(m_along_transect, density_m2, color = area)) +
#facet_wrap(~ area, scales = "free", nrow = 2) +
geom_line()
wara_mean <- wara %>% group_by(area) %>%
summarise(dens_mean = mean(density_m2))
wara_area <- wara %>% group_by(area) %>%
summarise(start_m = min(m_along_transect),
end_m = max(m_along_transect)) %>%
mutate(transect_dist = end_m - start_m,
area_m2 = transect_dist * 2)
wara_area2 <- inner_join(wara_area, wara_mean, by = "area")
wara_area2 <- wara_area2 %>%
mutate(snail_number = area_m2 * dens_mean)
wara_area2
total_snails <- whl %>% group_by(site) %>%
summarise(total_snails_m2 = sum(snail_count)) %>%
mutate(transect_length_m = c(14, 62.5),
transect_area = transect_length_m * 2,
transect_snail_count_total = total_snails_m2 * transect_area)
total_snails
wara <- read_csv("data/Wara_1963_fig2_fig6.csv")
wara <- wara %>%
mutate(transect_interval = ifelse(area == "areaB", 1, 2.75),
snail_count = density_m2 * transect_interval * 2)
wara %>%
ggplot(aes(m_along_transect, density_m2, color = area)) +
#facet_wrap(~ area, scales = "free", nrow = 2) +
geom_line()
wara_mean <- wara %>% group_by(area) %>%
summarise(dens_mean = mean(density_m2))
wara_area <- wara %>% group_by(area) %>%
summarise(start_m = min(m_along_transect),
end_m = max(m_along_transect)) %>%
mutate(transect_dist = end_m - start_m,
area_m2 = transect_dist * 2)
wara_area2 <- inner_join(wara_area, wara_mean, by = "area")
wara_area2 <- wara_area2 %>%
mutate(snail_number = area_m2 * dens_mean)
wara_area2
wara %>% group_by(area) %>% summarise(total_snails = sum(snail_count))
wara
wara <- read_csv("data/Wara_1963_fig2_fig6.csv")
wara <- wara %>%
mutate(transect_interval = ifelse(area == "areaB", 1, 2.5),
snail_count = density_m2 * transect_interval * 2)
wara %>%
ggplot(aes(m_along_transect, density_m2, color = area)) +
#facet_wrap(~ area, scales = "free", nrow = 2) +
geom_line()
wara_mean <- wara %>% group_by(area) %>%
summarise(dens_mean = mean(density_m2))
wara_area <- wara %>% group_by(area) %>%
summarise(start_m = min(m_along_transect),
end_m = max(m_along_transect)) %>%
mutate(transect_dist = end_m - start_m,
area_m2 = transect_dist * 2)
wara_area2 <- inner_join(wara_area, wara_mean, by = "area")
wara_area2 <- wara_area2 %>%
mutate(snail_number = area_m2 * dens_mean)
wara_area2
wara %>% group_by(area) %>% summarise(total_snails = sum(snail_count))
total_snails
waraPast <- wara %>%
mutate(sp = "CHFU",
species = "Chlorostoma funebralis",
tideHTm = tide_ht_ft/3.28084,
site = ifelse(area == "areaB", "Wara.B", "Wara.D"),
era = "past") %>%
select(density_m2, size_mm, species, sp, tideHTm, site, era)
waraPast
##### SUMMARISE SIZE-DENSITY DATA FOR ALL THREE SPECIES #####
dat4 %>% group_by(sp, site, era, year, nest1, nest2) %>% tally() %>% ungroup() %>% View()
unique(dat4$sampleArea)
datMeans <- dat4 %>% filter(!is.na(size1mm)) %>%
group_by(species, sp, site, era, year, nest1, nest2, sampleArea) %>%
summarise(size_mean = mean(size1mm),
size_med = median(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se,
tide_mean = mean(tideHTm)) %>%
ungroup()
# Turban snails sampled in 0.25m2 quadrats in present
waraPres <- datMeans %>% filter(sp == "CHFU" & era == "present") %>%
mutate(area_sampled = 0.25,
density_factor = 1/area_sampled,
density_m2 = size_n * density_factor)
# Ribbed limpets sampled in 0.25m2 quadrats in present
hexPres <- datMeans %>% filter(sp == "LODI" & era == "present") %>%
mutate(area_sampled = 0.25,
density_factor = 1/area_sampled,
density_m2 = size_n * density_factor)
# Ribbed limpets sampled in past:
# areaA = 0.61 x 0.61 m = 0.37m2
# areaB, C = 0.91 x 0.61 m = 0.55m2
hexPast <- datMeans %>% filter(sp == "LODI" & era == "past") %>%
mutate(area_sampled = ifelse(site == "areaA", 0.37, 0.55),
density_factor = 1/area_sampled,
density_m2 = size_n * density_factor)
# Periwinkles sampled in 2.3m2 quadrats in present and past
childsPres <- datMeans %>% filter(sp == "LIKE" & era == "present") %>%
mutate(area_sampled = 2.3,
density_factor = 1/area_sampled,
density_m2 = size_n * density_factor)
childs_tide <- childsPres %>% group_by(nest1) %>%
summarise(tide_mean = mean(tide_mean))
childsPast <- datMeans %>% filter(sp == "LIKE" & era == "past") %>%
mutate(area_sampled = 2.3,
density_factor = 1/area_sampled,
density_m2 = size_n * density_factor)
childsPast$tide_mean <- childs_tide$tide_mean
datMeans2 <- rbind(waraPres, hexPres, hexPast, childsPres, childsPast)
datMeans2
names(datMeans2)
datMeans3 <- datMeans2 %>%
select(species, sp, site, era, tide_mean, size_mean, density_m2,
sampleArea, nest1, nest2, size_n) %>%
rename(tideHTm = tide_mean,
size_mm = size_mean)
datMeans3
unique(datMeans3$sampleArea)
waraPast <- waraPast %>%
mutate(sampleArea = site,
nest1 = NA,
nest2 = NA,
size_n = NA)
datMeans4 <- datMeans3 %>% rbind(., waraPast)
# Reorder levels
species <- factor(datMeans4$species, levels = rev(c("Littorina keenae",
"Lottia digitalis",
"Chlorostoma funebralis")))
datMeans4$species <- species
glimpse(datMeans4)
theme_set(theme_bw(base_size = 12) +
theme(strip.background = element_blank(),
strip.text = element_text(face = "italic")))
##### PRELIM PLOTS #####
datMeans4 %>% filter(sp == "CHFU") %>%
ggplot(aes(density_m2, size_mm, color = era)) +
geom_point(alpha = 0.5) +
facet_wrap(~ site) +
geom_smooth(method = "lm") +
scale_x_log10()
datMeans4 %>%
ggplot(aes(tideHTm, size_mm, color = era)) +
geom_point(alpha = 0.5) +
facet_wrap(~ species) +
geom_smooth(method = "lm")
datMeans4 %>%
ggplot(aes(tideHTm, density_m2, color = era)) +
geom_point(alpha = 0.5) +
facet_wrap(~ species) +
geom_smooth(method = "lm")
give.n <- function(x){
return(c(y = 0, label = length(x)))
}
datMeans4 %>%
ggplot(aes(era, size_mm)) +
geom_boxplot() +
facet_wrap(~ species, scales = "free_y") +
stat_summary(fun.data = give.n, geom = "text")
give.n <- function(x){
return(c(y = 0, label = length(x)))
}
datMeans4 %>%
ggplot(aes(era, density_m2)) +
geom_boxplot(notch = FALSE) +
facet_wrap(~ species, scales = "free_y") +
stat_summary(fun.data = give.n, geom = "text")
datMeans4 %>% filter(sp == "CHFU") %>%
ggplot(aes(tideHTm, density_m2, color = era)) +
geom_point(alpha = 0.75, size = 2) +
facet_wrap(~ site, scales = "free") +
geom_line()
size_dens_text <- data.frame(x = rep(1500, 3),
y = rep(3, 3),
text1 = c("A", "B", "C"),
species = c("Chlorostoma funebralis",
"Lottia digitalis",
"Littorina keenae"))
datMeans4 %>%
ggplot(aes(density_m2, size_mm, shape = species, color = era)) +
geom_point(alpha = 0.75, size = 2) +
facet_wrap(~ species) +
scale_x_log10() +
theme(legend.position = c(0, 0.0), legend.justification = c(0, 0)) +
theme(legend.title = element_blank()) +
theme(legend.key = element_rect(fill = "white")) +
xlab(expression(paste("Density (no. ", m^-2, ")"))) +
ylab("Size (mm)") +
guides(shape = FALSE) +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = size_dens_text, size = 5, hjust = 1, show.legend = FALSE) +
geom_smooth(data = subset(datMeans4, sp == "CHFU" & era == "present" &
site == "Wara.B"),
method = "lm", linetype = "solid", fill = NA) +
geom_smooth(data = subset(datMeans4, sp == "CHFU" & era == "present" &
site == "Wara.B"),
method = "lm", linetype = "solid", show.legend = FALSE) +
geom_smooth(data = subset(datMeans4, sp == "CHFU" & era == "present" &
site == "Wara.D"),
method = "lm", linetype = "solid", fill = NA) +
geom_smooth(data = subset(datMeans4, sp == "CHFU" & era == "present" &
site == "Wara.D"),
method = "lm", linetype = "solid", show.legend = FALSE)
datMeans4 %>%
ggplot(aes(density_m2, size_mm, shape = species, color = era)) +
geom_point(alpha = 0.75, size = 2) +
facet_wrap(~ species) +
scale_x_log10() +
theme(legend.position = c(0, 0.0), legend.justification = c(0, 0)) +
theme(legend.title = element_blank()) +
theme(legend.key = element_rect(fill = "white")) +
xlab(expression(paste("Density (no. ", m^-2, ")"))) +
ylab("Size (mm)") +
guides(shape = FALSE) +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = size_dens_text, size = 5, hjust = 1, show.legend = FALSE)
ggplot(aes(dens_log, pred)) +
#geom_point(size = 0.1) +
facet_wrap(~ species) +
geom_smooth(method = "lm")
size_dens_box_text <- data.frame(x = rep(1500, 3),
y = rep(3, 3),
text1 = c("A", "B", "C"),
species = c("Chlorostoma funebralis",
"Lottia digitalis",
"Littorina keenae"))
datMeans4 %>%
ggplot(aes(era, density_m2, color = era)) +
geom_boxplot(notch = FALSE) +
facet_wrap(~ species, scales = "free_y") +
#stat_summary(fun.data = give.n, geom = "text", show.legend = FALSE) +
ylab(expression(paste("Density (no. ", m^-2, ")"))) +
xlab("") +
theme(legend.position = "none")
datMeans4 %>%
ggplot(aes(density_m2, size_mm, shape = species, color = era)) +
geom_point(alpha = 0.75, size = 2) +
facet_wrap(~ species) +
scale_x_log10() +
theme(legend.position = c(0, 0.0), legend.justification = c(0, 0)) +
theme(legend.title = element_blank()) +
theme(legend.key = element_rect(fill = "white")) +
xlab(expression(paste("Density (no. ", m^-2, ")"))) +
ylab("Mean size (mm)") +
guides(shape = FALSE) +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = size_dens_text, size = 5, hjust = 1, show.legend = FALSE)
datMeans4 %>%
ggplot(aes(density_m2, size_mm, shape = species, color = era)) +
geom_point(alpha = 0.75, size = 2) +
facet_wrap(~ species) +
scale_x_log10() +
theme(legend.position = c(0, 0.0), legend.justification = c(0, 0)) +
theme(legend.title = element_blank()) +
theme(legend.key = element_rect(fill = "white")) +
xlab(expression(paste("Density (no. ", m^-2, ")"))) +
ylab("Mean size (mm)") +
guides(shape = FALSE) +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = size_dens_text, size = 5, hjust = 1, show.legend = FALSE)  +
scale_color_manual(values = c("darkgray", "black"))
datMeans4 %>%
ggplot(aes(density_m2, size_mm, shape = species, color = era)) +
geom_point(alpha = 0.75, size = 2) +
facet_wrap(~ species) +
scale_x_log10() +
theme(legend.position = c(0, 0.0), legend.justification = c(0, 0)) +
theme(legend.title = element_blank()) +
theme(legend.key = element_rect(fill = "white")) +
xlab(expression(paste("Density (no. ", m^-2, ")"))) +
ylab("Mean size (mm)") +
guides(shape = FALSE) +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = size_dens_text, size = 5, hjust = 1, show.legend = FALSE)  +
scale_color_manual(values = c("darkgray", "black"))
ggsave("figs/elahi_size_era_density_3panel.png", height = 3.5, width = 7)
