fisherDat
sampleSizeDat <- siteDat %>% gather(key = "Collector", value = "sampleSize", Nc:Nf) %>%
group_by(Exposure, Collector) %>%
summarise(n_mean = mean(sampleSize),
n_sd = sd(sampleSize),
n_total = sum(sampleSize),
nSites = n())
sampleSizeDat
sampleSizeDat
fisherDat
?revalue
sampleSizeDat2 <- sampleSizeDat %>%
revalue(Exposure = c("Exposed coast" = "exposed"))
sampleSizeDat %>% rename(exposure = Exposure) %>%
mutate(exposure = gsub("Sheltered", "sheltered"))
sampleSizeDat %>% rename(exposure = Exposure) %>% ungroup() %>%
mutate(exposure = gsub("Sheltered", "sheltered"))
?gsub
sampleSizeDat %>% rename(exposure = Exposure) %>% ungroup() %>%
mutate(exposure = gsub(exposure, "Sheltered", "sheltered"))
head(sampleSizeDat)
exposure <- sampleSizeDat$Exposure
fisherDat$exposure
exposure2 <- gsub(exposure, "Exposed coast", "exposed")
exposure2 <- gsub(x = exposure, pattern = "Exposed coast", "exposed")
exposure <- gsub(x = exposure, pattern = "Semiexposed coast", "semi-exposed")
exposure <- gsub(x = exposure, pattern = "Sheltered cove", "sheltered")
unique(exposure)
exposure <- sampleSizeDat$Exposure
exposure <- gsub(x = exposure, pattern = "Exposed coast", "exposed")
exposure <- gsub(x = exposure, pattern = "Semiexposed coast", "semi-exposed")
exposure <- gsub(x = exposure, pattern = "Sheltered cove", "sheltered")
unique(exposure)
exposure <- gsub(x = exposure, pattern = "Semiexposed shore", "semi-exposed")
exposure <- gsub(x = exposure, pattern = "Sheltered cove", "sheltered")
unique(exposure)
fisherDat$exposure
sampleSizeDat$exposure <- exposure
View(sampleSizeDat)
head(siteDat)
exposure <- siteDat$Exposure
exposure <- gsub(x = exposure, pattern = "Exposed coast", "exposed")
exposure <- gsub(x = exposure, pattern = "Semiexposed shore", "semi-exposed")
exposure <- gsub(x = exposure, pattern = "Sheltered cove", "sheltered")
unique(exposure)
siteDat$exposure <- exposure
siteDat %>% summarise(meanLat = mean(lat), meanLong = mean(long))
sampleSizeDat <- siteDat %>% gather(key = "Collector", value = "sampleSize", Nc:Nf) %>%
group_by(exposure, Collector) %>%
summarise(n_mean = mean(sampleSize),
n_sd = sd(sampleSize),
n_total = sum(sampleSize),
nSites = n())
##### GET SITE DETAILS #####
head(dat)
site_details <- dat %>% select(point, exposure) %>% distinct()
fisherDat <- inner_join(fisherDat, site_details, by = "point")
fisherDat %>%
ggplot(aes(x = length_1915, y = length_2007, color = exposure)) +
geom_point() +
geom_errorbar(aes(ymin = length_2007 - CI_2007,
ymax = length_2007 + CI_2007)) +
geom_errorbarh(aes(xmin = length_1915 - CI_1915,
xmax = length_1915 + CI_1915)) +
coord_fixed(ratio = 1) +
scale_x_continuous(breaks = seq(18, 28, by = 2)) +
scale_y_continuous(breaks = seq(18, 36, by = 2)) +
geom_abline(slope = 1, intercept = 0, color = "black")
head(sampleSizeDat)
fisherDat$exposure
fisherDat$exposure
fisherDat
site_details
dat <- read_csv("sbs_meta/scraped/Fisher2009/Fisher_2009_fig1_r.csv")
head(dat)
##' x = length in 1915-1922 (mm)
##' y = length in 2007 (mm)
##' measurement = CI of x or y; mean
##' dimension = relevant era (x or y)
##### SUMMARIZE MEAN LENGTHS #####
# To extract the mean length in 1915, calculate mean x for the mean size and CI
xDat <- dat %>% filter(dimension != "y") %>%
group_by(point) %>%
summarise(length_1915 = mean(x))
# To extract the mean length in 2007, calculate mean y for the mean size and CI
yDat <- dat %>% filter(dimension != "x") %>%
group_by(point) %>%
summarise(length_2007 = mean(y))
lengthDat <- inner_join(xDat, yDat, by = "point")
lengthDat
##### SUMMARIZE CIs #####
head(dat)
# To extract the CI in 1915, calculate difference in x for the CI
xCI <- dat %>% filter(dimension != "x") %>% select(point, x, measurement) %>%
spread(key = measurement, value = x) %>%
mutate(CI_1915 = abs(CI_x_right - mean)) %>%
select(point, CI_1915)
# To extract the CI in 2007, calculate difference in y for the CI
yCI <- dat %>% filter(dimension != "y") %>% select(point, y, measurement) %>%
mutate(measurement = ifelse(measurement == "CI_y_lower",
"CI_y_upper",
measurement)) %>%
spread(key = measurement, value = y) %>%
mutate(CI_2007 = abs(CI_y_upper - mean)) %>%
select(point, CI_2007)
ciDat <- inner_join(xCI, yCI, by = "point")
##### COMBINE MEANS AND CIs #####
ciDat; lengthDat
fisherDat <- inner_join(lengthDat, ciDat, by = "point")
head(fisherDat)
##### GET LAT LONGS #####
siteDat <- read_csv("sbs_meta/scraped/Fisher2009/Fisher_2009_tableS1.csv")
head(siteDat)
exposure <- siteDat$Exposure
exposure <- gsub(x = exposure, pattern = "Exposed coast", "exposed")
exposure <- gsub(x = exposure, pattern = "Semiexposed shore", "semi-exposed")
exposure <- gsub(x = exposure, pattern = "Sheltered cove", "sheltered")
unique(exposure)
siteDat$exposure <- exposure
# mean lat long for study
siteDat %>% summarise(meanLat = mean(lat), meanLong = mean(long))
# mean sample sizes by exposure category
sampleSizeDat <- siteDat %>% gather(key = "Collector", value = "sampleSize", Nc:Nf) %>%
group_by(exposure, Collector) %>%
summarise(n_mean = mean(sampleSize),
n_sd = sd(sampleSize),
n_total = sum(sampleSize),
nSites = n())
##### GET SITE DETAILS #####
head(dat)
site_details <- dat %>% select(point, exposure) %>% distinct()
site_details
fisherDat <- inner_join(fisherDat, site_details, by = "point")
fisherDat %>%
ggplot(aes(x = length_1915, y = length_2007, color = exposure)) +
geom_point() +
geom_errorbar(aes(ymin = length_2007 - CI_2007,
ymax = length_2007 + CI_2007)) +
geom_errorbarh(aes(xmin = length_1915 - CI_1915,
xmax = length_1915 + CI_1915)) +
coord_fixed(ratio = 1) +
scale_x_continuous(breaks = seq(18, 28, by = 2)) +
scale_y_continuous(breaks = seq(18, 36, by = 2)) +
geom_abline(slope = 1, intercept = 0, color = "black")
##### DEAL WITH SAMPLE SIZES #####
### Fisher does not provide sample sizes for each point, so I have to calculate average number of samples per exposure category, and merge that with the body size data
head(sampleSizeDat)
fisherDat$exposure
View(fisherDat)
head(fisherDat)
ciDat; lengthDat
ciDat; lengthDat
ciDatL <- ciDat %>% gather(key = time_rep, value = length_mean, length_1915:length_2007)
lengthDatL <- lengthDat %>% gather(key = time_rep, value = length_mean, length_1915:length_2007)
View(lengthDatL)
ciDatL <- ciDat %>% gather(key = time_rep, value = length_CI, CI_1915:CI_2007)
ciDatL
fisherDatL <- inner_join(lengthDatL, ciDatL, by = "point")
fisherDatL
View(ciDatL)
View(fisherDatL)
fisherDatL <- cbind(ciDatL, fisherDatL)
fisherDatL <- cbind(lengthDatL, ciDatL)
head(fisherdatl)
head(fisherDatL)
fisherDatL <- cbind(lengthDatL, ciDatL$length_CI)
head(fisherDatL)
fisherDatL <- inner_join(fisherDatL, site_details, by = "point")
fisherDatL
names(fisherDatL)[4] <- "length_CI"
fisherDatL
head(site_details)
head(siteDat)
siteDat$Year
?mean
mean(siteDat$Year)
mean(siteDat$Year, na.rm = TRUE)
weighted.mean(siteDat$Year, siteDat$Nc, na.rm = TRUE)
fisherDatL$year <- c(rep(1918, 19), rep(2007, 19))
View(fisherDatL)
siteDat %>% group_by(exposure) %>%
summarise(yearMean = mean(Year))
siteDat %>% group_by(exposure) %>%
summarise(yearMean = mean(Year, na.rm = TRUE))
siteDat %>% group_by(exposure) %>%
summarise(yearMean = mean(Year, na.rm = TRUE),
yearMeanWt = weighted.mean(Year, Nc, na.rm = TRUE))
yearDat <- siteDat %>% group_by(exposure) %>%
summarise(yearMean = mean(Year, na.rm = TRUE),
yearMeanWt = weighted.mean(Year, Nc, na.rm = TRUE))
yearDat %>% select(-yearMean) %>% rename(year = yearMeanWt)
yearDat %>% select(-yearMean) %>% rename(year = yearMeanWt) %>%
inner_join(., fisherDatL, by = "exposure")
lengthDatL <- lengthDat %>% gather(key = time_rep, value = length_mean, length_1915:length_2007)
ciDatL <- ciDat %>% gather(key = time_rep, value = length_CI, CI_1915:CI_2007)
fisherDatL <- cbind(lengthDatL, ciDatL$length_CI)
fisherDatL <- inner_join(fisherDatL, site_details, by = "point")
fisherDatL
yearDat %>% select(-yearMean) %>% rename(year = yearMeanWt) %>%
inner_join(., fisherDatL, by = "exposure")
fisherDatL
names(fisherDatL)[4] <- "length_CI"
fisherDatL
head(fisherDatL)
yearDat <- siteDat %>% group_by(exposure) %>%
summarise(yearMean = mean(Year, na.rm = TRUE),
yearMeanWt = weighted.mean(Year, Nc, na.rm = TRUE))
yearDat %>% select(-yearMean) %>% rename(year = yearMeanWt) %>%
inner_join(., fisherDatL, by = "exposure")
fisherDatL <- yearDat %>% select(-yearMean) %>% rename(year = yearMeanWt) %>%
inner_join(., fisherDatL, by = "exposure")
fisherDatL <- yearDat %>% select(-yearMean) %>% rename(year = yearMeanWt) %>%
inner_join(., fisherDatL, by = "exposure")
df_final <- fisherDatL %>% arrange(exposure, point, year)
df_final <- fisherDatL %>% arrange(exposure, point, year)
head(fisherDatL)
# Get fisher data in long format
lengthDatL <- lengthDat %>% gather(key = time_rep, value = length_mean, length_1915:length_2007)
ciDatL <- ciDat %>% gather(key = time_rep, value = length_CI, CI_1915:CI_2007)
fisherDatL <- cbind(lengthDatL, ciDatL$length_CI)
fisherDatL <- inner_join(fisherDatL, site_details, by = "point")
names(fisherDatL)[4] <- "length_CI"
head(fisherDatL)
# Get year (weighted average), by exposure
mean(siteDat$Year, na.rm = TRUE)
weighted.mean(siteDat$Year, siteDat$Nc, na.rm = TRUE)
yearDat <- siteDat %>% group_by(exposure) %>%
summarise(yearMean = mean(Year, na.rm = TRUE),
yearMeanWt = weighted.mean(Year, Nc, na.rm = TRUE))
fisherDatL <- yearDat %>% select(-yearMean) %>% rename(year = yearMeanWt) %>%
inner_join(., fisherDatL, by = "exposure")
head(fisherDatL)
df_final <- fisherDatL %>% arrange(exposure, point, year)
head(df_final)
df_final$species <- "Nucella_lapillus"
head(df_final)
yearDat
head(fisherDatL)
fisherDatL <- cbind(lengthDatL, ciDatL$length_CI) %>%
inner_join(fisherDatL, site_details, by = "point")
names(fisherDatL)[4] <- "length_CI"
head(fisherDatL)
lengthDatL <- lengthDat %>% gather(key = time_rep, value = length_mean, length_1915:length_2007)
ciDatL <- ciDat %>% gather(key = time_rep, value = length_CI, CI_1915:CI_2007)
fisherDatL <- cbind(lengthDatL, ciDatL$length_CI)
head(fisherDatL)
fisherDatL <- inner_join(fisherDatL, site_details, by = "point")
head(fisherDatL)
names(fisherDatL)[4] <- "length_CI"
yearDat <- siteDat %>% group_by(exposure) %>%
summarise(yearColton = weighted.mean(Year, Nc, na.rm = TRUE))
yearDat
fisherDatL <- yearDat %>%
inner_join(., fisherDatL, by = "exposure")
head(fisherDatL)
fisherDatL <- cbind(lengthDatL, ciDatL$length_CI)
head(fisherDatL)
fisherDatL <- inner_join(fisherDatL, site_details, by = "point")
names(fisherDatL)[4] <- "length_CI"
head(fisherDatL)
View(fisherDatL)
fisherDatL$year <- c(rep(1915, 19), rep(2007, 19))
head(fisherDatL)
yearDat <- siteDat %>% group_by(exposure) %>%
summarise(yearColton = weighted.mean(Year, Nc, na.rm = TRUE))
fisherDatL <- yearDat %>%
inner_join(., fisherDatL, by = "exposure")
head(fisherDatL)
fisherDatL <- fisherDatL %>%
mutate(yearFinal = ifelse(year == 1915, yearColton, year))
View(fisherDatL)
names(fisherDatL)
fisherDatL <- fisherDatL %>%
mutate(yearFinal = ifelse(year == 1915, yearColton, year),
site = paste(exposure, point, sep = "_"))
names(fisherDatL)
head(siteDat)
df_final <- fisherDatL %>%
rename(size_rep = length_mean, size_error = length_CI)
head(df_final)
df_final <- fisherDatL %>% select(-c(exposure, yearColton, point, year))
rename(size_rep = length_mean, size_error = length_CI)
head(df_final)
df_final <- fisherDatL %>% select(-c(exposure, yearColton, point, year)) %>%
rename(size_rep = length_mean, size_error = length_CI)
head(df_final)
df_final <- fisherDatL %>% select(-c(exposure, yearColton, point, year)) %>%
rename(size_rep = length_mean, size_error = length_CI, year = yearFinal)
head(df_final)
df_final <- fisherDatL %>% select(-c(exposure, yearColton, point, year)) %>%
rename(size_rep = length_mean, size_error = length_CI, year = yearFinal) %>%
arrange(site, year)
head(df_final)
df_final <- fisherDatL %>% select(-c(exposure, yearColton, point, year)) %>%
rename(size_rep = length_mean, size_error = length_CI, year = yearFinal) %>%
mutate(species = "Nucella_lapillus")
arrange(site, year)
df_final <- fisherDatL %>% select(-c(exposure, yearColton, point, year)) %>%
rename(size_rep = length_mean, size_error = length_CI, year = yearFinal) %>%
mutate(species = "Nucella_lapillus") %>%
arrange(site, year)
head(df_final)
head(sampleSizeDat)
sampleSizeDat <- siteDat %>% gather(key = "Collector", value = "sampleSize", Nc:Nf) %>%
group_by(exposure, Collector) %>%
summarise(n_mean = mean(sampleSize),
n_sd = sd(sampleSize),
n_total = sum(sampleSize),
nSites = n()) %>%
ungroup()
sampleSizeDat
sampleSizeDat %>% select(exposure, n_mean) %>%
inner_join(fisherDatL, ., by = "exposure")
sampleSizeDat %>% select(exposure, n_mean) %>%
inner_join(fisherDatL, ., by = "exposure") %>%
rename(sample_size = n_mean) %>%
mutate(sample_size_units = "mean number of snails by exposure")
fisherDatL <- sampleSizeDat %>% select(exposure, n_mean) %>%
inner_join(fisherDatL, ., by = "exposure") %>%
rename(sample_size = n_mean) %>%
mutate(sample_size_units = "mean number of snails by exposure")
names(fisherDatL)
df_final <- fisherDatL %>% select(-c(exposure, yearColton, point, year)) %>%
rename(size_rep = length_mean, size_error = length_CI, year = yearFinal) %>%
mutate(species = "Nucella_lapillus") %>%
arrange(site, year)
head(df_final)
dfMeta <- data.frame(
study = "Fisher2009",
studySub = NA,
fig_table = "Figure_1",
species = df_final$species,
site = df_final$site,
size_rep = df_final$size_rep,
size_units = "mm",
size_error = df_final$size_error,
size_error_type = "CI",
time_rep = df_final$time_rep,
time_error = NA,
year = df_final$year,
year_error = NA,
year_error_type = NA,
sample_size = df_final$sample_size,
sample_size_units = df_final$sample_size_units
)
unique(dfMeta$species)
View(dfMeta)
head(df_final)
sampleSizeDat
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
dat <- read.csv("./output/sbsMaster.csv", na.strings = "NA")
summary(dat)
dat <- read.csv("./output/sbsMaster.csv", na.strings = "NA")
summary(dat)
head(dat)
range(dat$tideHTm, na.rm = TRUE)
dat$tideHTm <- dat$tideHTm/3.28084
dat$lat2 <- as.numeric(substr(dat$lat, 1, 8))
dat$long2 <- as.numeric(paste("-", substr(dat$long, 1, 9), sep = ""))
unique(dat$lat2)
unique(dat$long2)
dat$LL <- with(dat, paste(lat2, long2, sep = ","))
unique(dat$LL)
head(dat)
# change ft to meters
range(dat$tideHTm, na.rm = TRUE)
dat$tideHTm <- dat$tideHTm/3.28084
# create numeric lat-long columns
dat$lat2 <- as.numeric(substr(dat$lat, 1, 8))
dat$long2 <- as.numeric(paste("-", substr(dat$long, 1, 9), sep = ""))
unique(dat$lat2)
unique(dat$long2)
like_sampling <- c(1947,  2014, 2014-1947)
lodi_sampling <- c(1950,  2015, 2015-1950)
chfu_sampling <- c(1963,  2014, 2014-1963)
samplingDF <- data.frame(like_sampling, lodi_sampling, chfu_sampling)
samplingDF
apply(samplingDF[3,], 1, mean)
apply(samplingDF[3,], 1, sd)
head(dat)
dat %>% group_by(sp, sampleUnit, lat2, long2) %>%
distinct()
unique(dat$sampleUnit)
unique(dat$LL)
unique(dat$site)
View(dat)
dat %>% filter(era == "present") %>%
group_by(sp, sampleUnit, lat2, long2)
dat %>% filter(era == "present") %>%
group_by(sp, sampleUnit, lat2, long2) %>%
distinct()
group_by(sp, sampleUnit, lat2, long2, LL) %>%
distinct()
##' x = length in 1915-1922 (mm)
dat %>% filter(era == "present") %>%
group_by(sp, sampleUnit, lat2, long2, LL) %>%
distinct()
dat %>% filter(era == "present") %>%
select(sp, sampleUnit, lat2, long2, LL) %>%
distinct()
dat %>% filter(era == "present") %>%
select(sp, site, sampleUnit, lat2, long2, LL) %>%
distinct()
dat %>% filter(era == "present") %>%
select(sp, site, sampleUnit, lat2, long2) %>%
distinct()
dat %>% filter(era == "present") %>%
select(sp, site, lat2, long2) %>%
distinct()
dat %>% filter(era == "present") %>%
select(sp, site, lat2, long2, LL) %>%
distinct()
dat %>% filter(era == "present") %>%
select(sp, site, lat2, long2)
dat %>% filter(era == "present") %>%
select(sp, site, lat2, long2) %>% distinct()
library(ggmap)
datLL <- dat %>% filter(era == "present") %>%
select(sp, site, lat2, long2) %>% distinct()
datLL <- dat %>% filter(era == "present") %>%
select(sp, site, lat2, long2) %>% distinct()
datLL %>% group_by(sp) %>%
summarise(meanLat = mean(lat2, na.rm = TRUE),
meanLong = mean(long2, na.rm = TRUE))
hms1 <- get_map(location = c(lon = -121.9045, lat = 36.6218),
color = "color", source = "google",
maptype = "terrain", zoom = 8)
hmsMap <- ggmap(hms1, extent = "device",
ylab = "Latitude", xlab = "Longitude")
hmsMap
?ggmap
hms1 <- get_map(location = c(lon = -121.9045, lat = 36.6218),
color = "color", source = "google",
maptype = "terrain", zoom = 10)
hmsMap <- ggmap(hms1, extent = "device",
ylab = "Latitude", xlab = "Longitude")
hmsMap
##' x = length in 1915-1922 (mm)
hms1 <- get_map(location = c(lon = -121.9045, lat = 36.6218),
color = "color", source = "google",
maptype = "terrain", zoom = 14)
hmsMap <- ggmap(hms1, extent = "device",
ylab = "Latitude", xlab = "Longitude")
hmsMap
hms1 <- get_map(location = c(lon = -121.9045, lat = 36.6218),
color = "color", source = "google",
maptype = "terrain", zoom = 18)
hmsMap <- ggmap(hms1, extent = "device",
ylab = "Latitude", xlab = "Longitude")
hmsMap
datLL %>% group_by(sp) %>%
summarise(meanLat = mean(lat2, na.rm = TRUE),
meanLong = mean(long2, na.rm = TRUE))
llSummary <- datLL %>% group_by(sp) %>%
summarise(meanLat = mean(lat2, na.rm = TRUE),
meanLong = mean(long2, na.rm = TRUE))
datLL
llSummary <- datLL %>% group_by(site) %>%
summarise(meanLat = mean(lat2, na.rm = TRUE),
meanLong = mean(long2, na.rm = TRUE))
llSummary
hmsMap +
geom_point(aes(meanLat, meanLong, color = site), data = llSummary)
hmsMap +
geom_point(aes(meanLong, meanLat, color = site), data = llSummary)
##' x = length in 1915-1922 (mm)
hms1 <- get_map(location = c(lon = -121.9045, lat = 36.6218),
color = "color", source = "google",
maptype = "satellite", zoom = 20)
hmsMap <- ggmap(hms1, extent = "device",
ylab = "Latitude", xlab = "Longitude")
hmsMap +
geom_point(aes(meanLong, meanLat, color = site), data = llSummary)
hms1 <- get_map(location = c(lon = -121.9045, lat = 36.6218),
color = "color", source = "google",
maptype = "satellite", zoom = 19)
hmsMap <- ggmap(hms1, extent = "device",
ylab = "Latitude", xlab = "Longitude")
hmsMap +
geom_point(aes(meanLong, meanLat, color = site), data = llSummary)
hms1 <- get_map(location = c(lon = -121.9045, lat = 36.6218),
color = "color", source = "google",
maptype = "satellite", zoom = 18)
hmsMap <- ggmap(hms1, extent = "device",
ylab = "Latitude", xlab = "Longitude")
hmsMap +
geom_point(aes(meanLong, meanLat, color = site), data = llSummary)
llSummary <- datLL %>% group_by(code, site) %>%
summarise(meanLat = mean(lat2, na.rm = TRUE),
meanLong = mean(long2, na.rm = TRUE))
datLL
llSummary <- datLL %>% group_by(sp, site) %>%
summarise(meanLat = mean(lat2, na.rm = TRUE),
meanLong = mean(long2, na.rm = TRUE))
llSummary
hmsMap +
geom_point(aes(meanLong, meanLat, color = sp,
shape = sp), data = llSummary)
datLL
hmsMap +
geom_point(aes(long2, lat2, color = sp,
shape = sp), data = datLL)
llSummary
hmsMap +
geom_point(aes(meanLong, meanLat, color = sp,
shape = sp), data = llSummary)
llSummary %>% ungroup() %>%
summarise(grandLat = mean(meanLat),
grandLong = mean(meanLong))
