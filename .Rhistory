glimpse(sst_df)
glimpse(spYrs)
spYrs <- size_data %>% select(study, species, year, year2) %>%
distinct() %>%
mutate(hadYr1 = floor(year),
hadYr2 = floor(year2),
study = as.character(study)) %>%
group_by(study, species) %>% slice(1) %>%
ungroup() %>% filter(!is.na(hadYr2))
dat.i <- spYrs
sst.i <- inner_join(sst_df, dat.i, by = "study") %>%
mutate(species1 = ifelse(year >= hadYr1 & year <= hadYr2,
"keep", "remove")) %>%
filter(species1 == "keep") %>% select(-c(species1))
glimpse(sst_df)
glimpse(spYrs)
inner_join(sst_df, dat.i, by = "study") %>%
mutate(species1 = ifelse(year >= hadYr1 & year <= hadYr2,
"keep", "remove"))
glimpse(sst_df)
sst.i <- inner_join(sst_df, dat.i, by = "study")
glimpse(sst.i)
spYrs <- size_data %>% select(study, species, year, year2) %>%
distinct() %>%
mutate(hadYr1 = floor(year),
hadYr2 = floor(year2),
study = as.character(study)) %>%
group_by(study, species) %>% slice(1) %>%
ungroup() %>% filter(!is.na(hadYr2)) %>%
select(-c(year, year2))
dat.i <- spYrs
sst.i <- inner_join(sst_df, dat.i, by = "study") %>%
mutate(species1 = ifelse(year >= hadYr1 & year <= hadYr2,
"keep", "remove")) %>%
filter(species1 == "keep") %>% select(-c(species1))
glimpse(sst.i)
View(sst.i)
get_hms_had_series <- function(sst_df = sstDat3, size_data) {
spYrs <- size_data %>% select(study, species, year, year2) %>%
distinct() %>%
mutate(hadYr1 = floor(year),
hadYr2 = floor(year2),
study = as.character(study)) %>%
group_by(study, species) %>% slice(1) %>%
ungroup() %>% filter(!is.na(hadYr2)) %>%
select(-c(year, year2))
dat.i <- spYrs
sst.i <- inner_join(sst_df, dat.i, by = "study") %>%
mutate(species1 = ifelse(year >= hadYr1 & year <= hadYr2,
"keep", "remove")) %>%
filter(species1 == "keep") %>% select(-c(species1))
return(datHad.i)
}
test1 <- elahi_dat %>% group_by(species) %>%
do(get_hms_had_series(size_data = .))
get_hms_had_series <- function(sst_df = sstDat3, size_data) {
spYrs <- size_data %>% select(study, species, year, year2) %>%
distinct() %>%
mutate(hadYr1 = floor(year),
hadYr2 = floor(year2),
study = as.character(study)) %>%
group_by(study, species) %>% slice(1) %>%
ungroup() %>% filter(!is.na(hadYr2)) %>%
select(-c(year, year2))
dat.i <- spYrs
sst.i <- inner_join(sst_df, dat.i, by = "study") %>%
mutate(species1 = ifelse(year >= hadYr1 & year <= hadYr2,
"keep", "remove")) %>%
filter(species1 == "keep") %>% select(-c(species1))
return(sst.i)
}
test1 <- elahi_dat %>% group_by(species) %>%
do(get_hms_had_series(size_data = .))
elahi_dat
summary(test1)
glimpse(test1)
test1 %>%
ggplot(aes(date, runMean, color = tempSource)) +
geom_line() +
facet_wrap(~ species)
test1 %>% group_by(species, tempSource) %>% tally()
sstDat3
test1 <- elahi_dat %>% group_by(species) %>%
do(get_hms_had_series(size_data = .)) %>% ungroup()
summary(test1)
glimpse(test1)
test1 %>% group_by(species, tempSource) %>% tally()
test1 %>%
ggplot(aes(date, runMean, color = tempSource)) +
geom_line() +
facet_wrap(~ species)
test1
test1 %>%
ggplot(aes(dateR, runMean, color = tempSource)) +
geom_line() +
facet_wrap(~ species)
dfAnnual <- test1 %>% group_by(tempSource, study, species, year) %>%
summarise(mean_C = mean(tempC),
max_C = max(tempC),
min_C = min(tempC)) %>%
ungroup()
dfAnnual
dfAnnual %>%
ggplot(aes(year, mean_C, col = tempSource)) +
geom_line(alpha = 0.5) +
facet_wrap(~ species) +
geom_smooth(method = "lm")
duration = 10
nYrsPrior <- duration - 1
spYrs <- size_data %>% select(study, species, year, year2) %>%
distinct() %>%
mutate(hadPres1 = floor(year2 - nYrsPrior),
hadPres2 = floor(year2),
hadPast1 = floor(year - nYrsPrior),
hadPast2 = floor(year)) %>%
group_by(study, species) %>% slice(1) %>%
ungroup() %>% filter(!is.na(year))
dat.i <- spYrs # %>% filter(species == species.i)
datHad.i <- inner_join(sst_df, dat.i, by = "study") %>%
mutate(past_data = ifelse(year >= hadPast1 & year <= hadPast2,
"past", NA),
pres_data = ifelse(year >= hadPres1 & year <= hadPres2,
"pres", NA)) %>%
filter(!is.na(past_data) | !is.na(pres_data)) %>%
mutate(era = ifelse(is.na(past_data), "present", past_data))
spYrs <- size_data %>% select(study, species, year, year2) %>%
distinct() %>%
mutate(hadPres1 = floor(year2 - nYrsPrior),
hadPres2 = floor(year2),
hadPast1 = floor(year - nYrsPrior),
hadPast2 = floor(year),
study = as.character(study)) %>%
group_by(study, species) %>% slice(1) %>%
ungroup() %>% filter(!is.na(year))
dat.i <- spYrs
datHad.i <- inner_join(sst_df, dat.i, by = "study") %>%
mutate(past_data = ifelse(year >= hadPast1 & year <= hadPast2,
"past", NA),
pres_data = ifelse(year >= hadPres1 & year <= hadPres2,
"pres", NA)) %>%
filter(!is.na(past_data) | !is.na(pres_data)) %>%
mutate(era = ifelse(is.na(past_data), "present", past_data)) #%>%
dat.i
sst_df
spYrs <- size_data %>% select(study, species, year, year2) %>%
distinct() %>%
mutate(hadPres1 = floor(year2 - nYrsPrior),
hadPres2 = floor(year2),
hadPast1 = floor(year - nYrsPrior),
hadPast2 = floor(year),
study = as.character(study)) %>%
group_by(study, species) %>% slice(1) %>%
ungroup() %>% filter(!is.na(year)) %>%
select(-c(year, year2))
dat.i <- spYrs
sst.i <- inner_join(sst_df, dat.i, by = "study") %>%
mutate(past_data = ifelse(year >= hadPast1 & year <= hadPast2,
"past", NA),
pres_data = ifelse(year >= hadPres1 & year <= hadPres2,
"pres", NA)) %>%
filter(!is.na(past_data) | !is.na(pres_data)) %>%
mutate(era = ifelse(is.na(past_data), "present", past_data)) #%>%
select(-c(X, hadPres1:pres_data))
sst.i
sst.i <- inner_join(sst_df, dat.i, by = "study") %>%
mutate(past_data = ifelse(year >= hadPast1 & year <= hadPast2,
"past", NA),
pres_data = ifelse(year >= hadPres1 & year <= hadPres2,
"pres", NA)) %>%
filter(!is.na(past_data) | !is.na(pres_data)) %>%
mutate(era = ifelse(is.na(past_data), "present", past_data)) #%>%
select(-c(hadPres1:pres_data))
sst.i <- inner_join(sst_df, dat.i, by = "study") %>%
mutate(past_data = ifelse(year >= hadPast1 & year <= hadPast2,
"past", NA),
pres_data = ifelse(year >= hadPres1 & year <= hadPres2,
"pres", NA)) %>%
filter(!is.na(past_data) | !is.na(pres_data)) %>%
mutate(era = ifelse(is.na(past_data), "present", past_data)) %>%
select(-c(hadPres1:pres_data))
sst.i
get_hms_had_two_periods <- function(sst_df = sstDat3, size_data, duration = 10) {
nYrsPrior <- duration - 1
spYrs <- size_data %>% select(study, species, year, year2) %>%
distinct() %>%
mutate(hadPres1 = floor(year2 - nYrsPrior),
hadPres2 = floor(year2),
hadPast1 = floor(year - nYrsPrior),
hadPast2 = floor(year),
study = as.character(study)) %>%
group_by(study, species) %>% slice(1) %>%
ungroup() %>% filter(!is.na(year)) %>%
select(-c(year, year2))
dat.i <- spYrs
sst.i <- inner_join(sst_df, dat.i, by = "study") %>%
mutate(past_data = ifelse(year >= hadPast1 & year <= hadPast2,
"past", NA),
pres_data = ifelse(year >= hadPres1 & year <= hadPres2,
"pres", NA)) %>%
filter(!is.na(past_data) | !is.na(pres_data)) %>%
mutate(era = ifelse(is.na(past_data), "present", past_data)) %>%
select(-c(hadPres1:pres_data))
return(sst.i)
}
test2 <- elahi_dat %>% group_by(species) %>%
do(get_hms_had_two_periods(size_data = .)) %>% ungroup()
test2
test2 %>%
ggplot(aes(tempSource, runMean)) +
geom_boxplot() +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, runMean, color = era)) +
geom_boxplot() +
facet_wrap(~ species)
test2
dfAnnual2 <- test2 %>% group_by(era, tempSource, study, species, year) %>%
summarise(mean_C = mean(tempC),
max_C = max(tempC),
min_C = min(tempC)) %>%
ungroup()
dfAnnual2
dfAnnual2 %>%
ggplot(aes(year, mean_C, col = tempSource)) +
geom_line(alpha = 0.5) +
facet_wrap(~ species)
dfAnnual2 %>%
ggplot(aes(tempSource, mean_C, color = era)) +
geom_boxplot() +
facet_wrap(~ species)
dfAnnual2 %>%
ggplot(aes(tempSource, mean_C, color = era)) +
geom_violin() +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, runMean, color = era)) +
geom_violin() +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, runMean, color = era)) +
geom_violin() +
geom_boxplot(width = 0.5)
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, runMean, color = era)) +
geom_violin() +
geom_boxplot(size = 0.5)
facet_wrap(~ species)
?geom_boxplot
test2 %>%
ggplot(aes(tempSource, runMean, color = era)) +
geom_violin() +
geom_boxplot(width = 0.5)
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, runMean, color = era)) +
geom_violin() +
geom_boxplot(width = 0.5) +
facet_wrap(~ species)
test2
test2 %>%
ggplot(aes(tempSource, tempC, color = era)) +
geom_violin() +
geom_boxplot(width = 0.1) +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, tempC, color = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.1, position = dodge) +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge)
dodge <- position_dodge(width = 0.4)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.1, position = dodge) +
facet_wrap(~ species)
dodge <- position_dodge(width = 0.8)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.5, position = dodge) +
facet_wrap(~ species)
dodge <- position_dodge(width = 1)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.5, position = dodge) +
facet_wrap(~ species)
dodge <- position_dodge(width = 0.9)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.5, position = dodge) +
facet_wrap(~ species)
dodge <- position_dodge(width = 0.9)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.5, position = dodge, notch = TRUE) +
facet_wrap(~ species)
dodge <- position_dodge(width = 0.9)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.3, position = dodge, notch = TRUE) +
facet_wrap(~ species)
dfAnnual %>%
ggplot(aes(year, mean_C, col = tempSource)) +
geom_line(alpha = 0.5) +
facet_wrap(~ species) +
geom_smooth(method = "lm")
dfAnnual2 %>%
ggplot(aes(tempSource, mean_C, color = era)) +
geom_violin() +
facet_wrap(~ species)
dfAnnual2 %>%
ggplot(aes(tempSource, mean_C, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.3, position = dodge, notch = TRUE) +
facet_wrap(~ species)
dfAnnual2 %>%
ggplot(aes(tempSource, mean_C, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.3, position = dodge, notch = FALSE) +
facet_wrap(~ species)
dfAnnual2 %>%
ggplot(aes(tempSource, mean_C, fill = era)) +
# geom_violin(position = dodge) +
geom_boxplot(width = 0.3, position = dodge, notch = FALSE) +
facet_wrap(~ species)
dfAnnual2 %>%
ggplot(aes(tempSource, mean_C, fill = era)) +
# geom_violin(position = dodge) +
geom_boxplot(width = 1, position = dodge, notch = FALSE) +
facet_wrap(~ species)
dfAnnual2 %>%
ggplot(aes(tempSource, mean_C, fill = era)) +
geom_boxplot() + facet_wrap(~ species)
dfAnnual2 %>%
ggplot(aes(tempSource, mean_C, fill = era)) +
geom_boxplot(position = dodge) + facet_wrap(~ species)
dfAnnual2 %>%
ggplot(aes(tempSource, max_C, fill = era)) +
geom_boxplot(position = dodge) + facet_wrap(~ species)
dfAnnual2 %>%
ggplot(aes(tempSource, min_C, fill = era)) +
geom_boxplot(position = dodge) + facet_wrap(~ species)
dfAnnual2 %>%
ggplot(aes(tempSource, mean_C, fill = era)) +
geom_boxplot(position = dodge) + facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.3, position = dodge, notch = TRUE) +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, runMean, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.3, position = dodge, notch = TRUE) +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.3, position = dodge, notch = TRUE) +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.3, position = dodge, notch = TRUE, fill = NULL) +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(aes(fill = NULL), width = 0.3, position = dodge, notch = TRUE) +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(aes(fill = "white"), width = 0.3, position = dodge, notch = TRUE) +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(fill = "white", width = 0.3, position = dodge, notch = TRUE) +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(aes(group = era), fill = "white", width = 0.3, position = dodge, notch = TRUE) +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(aes(tempSource, tempC, group = era),
fill = "white", width = 0.3, position = dodge, notch = TRUE) +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.3, position = dodge, notch = TRUE) +
facet_wrap(~ species)
get_hms_had_two_periods <- function(sst_df = sstDat3, size_data, duration = 5) {
nYrsPrior <- duration - 1
spYrs <- size_data %>% select(study, species, year, year2) %>%
distinct() %>%
mutate(hadPres1 = floor(year2 - nYrsPrior),
hadPres2 = floor(year2),
hadPast1 = floor(year - nYrsPrior),
hadPast2 = floor(year),
study = as.character(study)) %>%
group_by(study, species) %>% slice(1) %>%
ungroup() %>% filter(!is.na(year)) %>%
select(-c(year, year2))
dat.i <- spYrs
sst.i <- inner_join(sst_df, dat.i, by = "study") %>%
mutate(past_data = ifelse(year >= hadPast1 & year <= hadPast2,
"past", NA),
pres_data = ifelse(year >= hadPres1 & year <= hadPres2,
"pres", NA)) %>%
filter(!is.na(past_data) | !is.na(pres_data)) %>%
mutate(era = ifelse(is.na(past_data), "present", past_data)) %>%
select(-c(hadPres1:pres_data))
return(sst.i)
}
test2 <- elahi_dat %>% group_by(species) %>%
do(get_hms_had_two_periods(size_data = .)) %>% ungroup()
dodge <- position_dodge(width = 0.9)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.3, position = dodge, notch = TRUE) +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_boxplot(position = dodge, notch = TRUE) +
facet_wrap(~ species)
dfAnnual %>%
ggplot(aes(year, mean_C, col = tempSource)) +
geom_line(alpha = 0.5) +
facet_wrap(~ species) +
geom_smooth(method = "lm")
ggsave("sbs_meta/meta_figs/elahi_tempC_v_time.png", width = 7, height = 3.5)
test1 %>%
ggplot(aes(dateR, runMean, color = tempSource)) +
geom_line() +
facet_wrap(~ species)
get_hms_had_two_periods <- function(sst_df = sstDat3, size_data, duration = 10) {
nYrsPrior <- duration - 1
spYrs <- size_data %>% select(study, species, year, year2) %>%
distinct() %>%
mutate(hadPres1 = floor(year2 - nYrsPrior),
hadPres2 = floor(year2),
hadPast1 = floor(year - nYrsPrior),
hadPast2 = floor(year),
study = as.character(study)) %>%
group_by(study, species) %>% slice(1) %>%
ungroup() %>% filter(!is.na(year)) %>%
select(-c(year, year2))
dat.i <- spYrs
sst.i <- inner_join(sst_df, dat.i, by = "study") %>%
mutate(past_data = ifelse(year >= hadPast1 & year <= hadPast2,
"past", NA),
pres_data = ifelse(year >= hadPres1 & year <= hadPres2,
"pres", NA)) %>%
filter(!is.na(past_data) | !is.na(pres_data)) %>%
mutate(era = ifelse(is.na(past_data), "present", past_data)) %>%
select(-c(hadPres1:pres_data))
return(sst.i)
}
test2 <- elahi_dat %>% group_by(species) %>%
do(get_hms_had_two_periods(size_data = .)) %>% ungroup()
dodge <- position_dodge(width = 0.9)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_violin(position = dodge) +
geom_boxplot(width = 0.3, position = dodge, notch = TRUE) +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_boxplot(position = dodge, notch = TRUE) +
facet_wrap(~ species)
test2 %>%
ggplot(aes(tempSource, tempC, fill = era)) +
geom_boxplot(position = dodge, notch = TRUE) +
facet_wrap(~ species)
ggsave("sbs_meta/meta_figs/elahi_tempC_v_era.png", width = 7, height = 3.5)
test2
test2 %>%
ggplot(aes(dateR, runMean, color = tempSource)) +
geom_line() +
facet_wrap(~ species + era)
test2 %>%
ggplot(aes(dateR, runMean, color = tempSource)) +
geom_line() +
facet_wrap(~ era + species)
test2 %>%
ggplot(aes(dateR, runMean, color = tempSource)) +
geom_line() +
facet_wrap(~ era + species, scales = "free_x")
test2 %>%
ggplot(aes(dateR, runMean, color = tempSource)) +
geom_line() +
facet_wrap(~ species + era, ncol = 2, scales = "free_x")
test2 %>%
ggplot(aes(dateR, tempC, color = tempSource)) +
geom_line() +
facet_wrap(~ species + era, ncol = 2, scales = "free_x")
ggsave("sbs_meta/meta_figs/elahi_tempC_v_time_era.png", width = 7, height = 5)
ggsave("sbs_meta/meta_figs/elahi_tempC_v_time_era.png", width = 7, height = 7)
