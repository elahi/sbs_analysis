position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
df %>%
ggplot(aes(size1mm_rand, fill = era, color = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
df %>%
ggplot(aes(size1mm_rand, fill = era, color = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d() +
scale_color_viridis()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
df %>%
ggplot(aes(size1mm_rand, fill = era, color = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d() +
scale_color_viridis_c()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
?scale_color_viridis
?scale_color_viridis_c
df %>%
ggplot(aes(size1mm_rand, fill = era, color = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_color_viridis() +
scale_fill_viridis_d() +
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
df %>%
ggplot(aes(size1mm_rand, fill = era, color = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_color_viridis() +
scale_fill_viridis_d()
df %>%
ggplot(aes(size1mm_rand, fill = era), color = 'black') +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black',
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.5,
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.25,
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.1,
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.2,
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.2,
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, #scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.2,
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.2,
position = "identity") +
geom_rect(data = subset(df, museum == "museum"), aes(fill = museum),
xmin = -Inf,xmax = Inf,
ymin = -Inf,ymax = Inf, alpha = 0.3) +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
df
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.2,
position = "identity") +
geom_rect(data = subset(df, study == "Roy"), aes(fill = study),
xmin = -Inf,xmax = Inf,
ymin = -Inf,ymax = Inf, alpha = 0.3) +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
df_plot
museum_dat <- rbind(hay_king, hay_elahi, gall_frank) %>% mutate(museum = "field")
## Field surveys
hay_king <- read_csv("sbs_meta/scraped/HayfordKing_2017/Hayford-King_raw.csv")
hay_elahi <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Hayford-Elahi_raw.csv")
# Select one year for Hayford-Elahi past
hay_elahi %>% count(era, year)
hay_elahi <- hay_elahi %>% filter(year == 1969 | year == 2018)
gall_frank <- read_csv("sbs_meta/scraped/Galloway_2017/Galloway-Frank_raw.csv")
## Museum collections
sag <- read_csv("sbs_meta/scraped/Sagarin_2010/Sagarin_raw.csv")
wilson <- read_csv("sbs_meta/scraped/Wilson-Brodie_2017/Wilson-Brodie_raw.csv")
fisher <- read_csv("sbs_meta/scraped/Fisher2009_raw/Fisher_raw.csv")
roy <- read_csv("sbs_meta/scraped/Roy2003_raw/Roy_raw.csv")
roy %>% count(species, era)
roy <- roy %>% filter(!is.na(era))
## Compile
museum_dat <- rbind(sag, wilson, fisher, roy) %>% mutate(museum = "museum")
field_dat <- rbind(hay_king, hay_elahi, gall_frank) %>% mutate(museum = "field")
master <- rbind(museum_dat, field_dat) %>%
mutate(lat = as.numeric(lat))
master %>% count(study, era)
str(master)
# Function to load cleaned data
source("R/choose_size_data.R")
# load data - approximated sizes
dat <- choose_size_data(method = "uniform")
# Function to load cleaned data
source("R/choose_size_data.R")
# load data - approximated sizes
dat <- choose_size_data(method = "uniform")
dat <- dat %>%
mutate(species = gsub(x = species, pattern = "\\.", replacement = " ")) %>%
mutate(species = ifelse(species == "Chlorostoma funebralis", "Tegula funebralis", species))
unique(dat$species)
dat2 <- dat %>%
select(-c(habitat, tideHTm_orig, sample_area_tidal_ht,
size_prop, LL, Shaw_hab)) %>%
mutate(study = "Elahi2015",
studySub = NA,
size1mm_rand = size1mm,
museum = "field")
unique(dat2$lat)
master2 <- master %>%
mutate(year = lubridate::year(mdy(date)),
sampleArea = NA) %>%
select(-c(X1, habitat, Shaw_hab))
df <- rbind(master2, dat2)
## Get latitude of study x species, create labels for plotting
df_plot <- df %>%
group_by(study, species, museum) %>%
summarise(lat_study_sp = round(mean(lat, na.rm = TRUE), 2)) %>%
ungroup() %>%
arrange(desc(lat_study_sp)) %>%
mutate(fig_legend = letters[seq(1:13)])
df_plot
## Get latitude of study x species, create labels for plotting
df_plot <- df %>%
group_by(study, species) %>%
summarise(lat_study_sp = round(mean(lat, na.rm = TRUE), 2)) %>%
ungroup() %>%
arrange(desc(lat_study_sp)) %>%
mutate(fig_legend = letters[seq(1:13)])
## Combine with df
df <- df %>% left_join(., df_plot, by = c("study", "species"))
df
source("sbs_meta/01_assemble_raw_data.R")
theme_set(theme_bw(base_size = 10) +
theme(panel.grid = element_blank(),
strip.background = element_blank()))
library(viridis)
##### HISTO PLOTS #####
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.2,
position = "identity") +
geom_rect(data = subset(df, museum == "museum"), aes(fill = museum),
xmin = -Inf,xmax = Inf,
ymin = -Inf,ymax = Inf, alpha = 0.3) +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.2,
position = "identity") +
geom_rect(data = subset(df, museum == "museum"), fill = "gray",
xmin = -Inf,xmax = Inf,
ymin = -Inf,ymax = Inf, alpha = 0.3) +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
geom_rect(data = subset(df, museum == "museum"), fill = "gray",
xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = Inf, alpha = 0.3) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.2,
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
geom_rect(data = subset(df, museum == "museum"), fill = "gray10",
xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = Inf, alpha = 0.3) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.2,
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
geom_rect(data = subset(df, museum == "museum"), fill = "gray90",
xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = Inf, alpha = 0.3) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.2,
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
geom_rect(data = subset(df, museum == "museum"), fill = "gray99",
xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = Inf, alpha = 0.3) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.2,
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
geom_rect(data = subset(df, museum == "museum"), fill = "gray95",
xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = Inf, alpha = 0.3) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.2,
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
df %>%
ggplot(aes(size1mm_rand, fill = era)) +
geom_rect(data = subset(df, museum == "museum"), fill = "gray90",
xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = Inf, alpha = 0.3) +
#geom_density(alpha = 0.25, aes(fill = NULL, color = era)) +
geom_histogram(alpha = 0.75, center = 0,  bins = 25,
aes(y = ..density..),
color = 'black', size = 0.2,
position = "identity") +
facet_wrap(fig_legend ~ species, ncol = 3, scales = "free",
labeller = label_wrap_gen(multi_line = FALSE)) +
xlab("Size (mm)") +
ylab("Probability density") +
theme(legend.justification  = c(0.5, 0),
legend.position = c(0.5, 0),
legend.title = element_blank(),
strip.text = element_text(size = 8)) +
scale_fill_viridis_d()
ggsave("sbs_meta/meta_figs/meta_hist_era.pdf", height = 7, width = 5)
