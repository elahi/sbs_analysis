spight
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(Year, breeding_group, shell_length_mm)
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0))
spight %>% count(Year, breeding_group, size_bin) %>% print(n = 100)
# Breeding group is irrelevant, sum across size_bin
spight_sum <- spight %>%
group_by(Year, size_bin) %>%
summarise(count = sum(frequency_of_occurence)) %>%
ungroup()
past_size <- spight %>%
group_by(Year, breeding_group) %>%
do(., repeat_sizes(size_bin_vector = size_bin,
count_vector = frequency_of_occurence)) %>%
ungroup()
spight
past_size <- spight %>%
group_by(Year, breeding_group) %>%
do(., repeat_sizes(size_bin_vector = .$size_bin,
count_vector = frequency_of_occurence)) %>%
ungroup()
past_size <- spight %>%
group_by(Year, breeding_group) %>%
do(., repeat_sizes(size_bin_vector = .$size_bin,
count_vector = .$frequency_of_occurence)) %>%
ungroup()
# Use repeated sizes, because increments are in 1mm for both past and present
spight
Year_unique <- unique(spight$Year)
Year_unique
past_size <- vector()
past_size
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0),
yr_bg = paste(Year, breeding_group, sep = "_"))
# Size-frequency counts, Spight 1968 at Shady Cove
# Spight 1974, Ecology, Figure 2 Population IV
# Student digitized data
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(Year, breeding_group, shell_length_mm)
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0),
yr_bg = paste(Year, breeding_group, sep = "_"))
spight %>% count(Year, breeding_group, size_bin) %>% print(n = 100)
# Use repeated sizes, because increments are in 1mm for both past and present
yr_bg_unique <- unique(spight$yr_bg)
# Use repeated sizes, because increments are in 1mm for both past and present
yr_bg_unique <- unique(spight$yr_bg)
past_size <- vector()
past_size
i = 1
i = 1
# Use repeated sizes, because increments are in 1mm for both past and present
yr_bg_unique <- unique(spight$yr_bg)
past_size <- vector()
past_size
i = 1
dat_i <- spight %>% filter(yr_bg == yr_bg_unique[i])
dat_i
past_size_i <- repeat_sizes(size_bin_vector = dat_i$size_bin,
count_vector = dat_i$count)
past_size_i <- repeat_sizes(size_bin_vector = dat_i$size_bin,
count_vector = dat_i$frequency_of_occurence)
past_size_i
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
source("R/convert_histo_to_raw.R")
source("R/choose_size_threshold.R")
# Size-frequency raw data, Hayford-Elahi-FHL470, 2018
he <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Shady_Cove_shelllength_rawdata_2018.csv")
he
# Sampling began when the tide height was -0.15m below MLLW, I use 0 below.
he_present <- data.frame(
study = "Hayford-Elahi",
studySub = NA,
species = "Nucella lamellosa",
sp = "NULA",
site = "ShadyCove",
era = "present",
date = "4/19/2018",
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = he$shell_length_mm,
size1mm_rand = he$shell_length_mm,
habitat = NA,
tideHTm = 0,
lat = 48.552,
long = -123.006,
Shaw_hab = NA,
notes = "",
notes2 = ""
)
# Size-frequency counts, Spight 1968 at Shady Cove
# Spight 1974, Ecology, Figure 2 Population IV
# Student digitized data
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(Year, breeding_group, shell_length_mm)
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0),
yr_bg = paste(Year, breeding_group, sep = "_"))
spight %>% count(Year, breeding_group, size_bin) %>% print(n = 100)
# Breeding group is irrelevant, sum across size_bin
spight_sum <- spight %>%
group_by(Year, size_bin) %>%
summarise(count = sum(frequency_of_occurence)) %>%
ungroup()
# Use repeated sizes, because increments are in 1mm for both past and present
yr_bg_unique <- unique(spight$yr_bg)
past_size <- vector()
past_size
i = 1
dat_i <- spight %>% filter(yr_bg == yr_bg_unique[i])
past_size_i <- repeat_sizes(size_bin_vector = dat_i$size_bin,
count_vector = dat_i$frequency_of_occurence)
past_size_i
dat_i
repeat_sizes()
repeat_sizes
past_size_df <- data.frame(size1mm = past_size_i,
year = dat_i$Year,
breeding = dat_i$breeding_group)
year_i <- unique(dat_i$Year)
year_i
breeding_i <- unique(dat_i$breeding_group)
past_size_df <- data.frame(size1mm = past_size_i,
year = year_i,
breeding = breeding_i)
past_size_df
past_size_df <- data.frame(size1mm = NA,
year = NA,
breeding = NA)
past_size_df
past_size_df <- rbind(past_size_df, past_size_df_i)
past_size_df_i <- data.frame(size1mm = past_size_i,
year = year_i,
breeding = breeding_i)
past_size_df <- rbind(past_size_df, past_size_df_i)
past_size_df
# Use repeated sizes, because increments are in 1mm for both past and present
yr_bg_unique <- unique(spight$yr_bg)
past_size_df <- data.frame(size1mm = NA,
year = NA,
breeding = NA)
for(i in 1:length(yr_bg_unique)){
dat_i <- spight %>% filter(yr_bg == yr_bg_unique[i])
year_i <- unique(dat_i$Year)
breeding_i <- unique(dat_i$breeding_group)
past_size_i <- repeat_sizes(size_bin_vector = dat_i$size_bin,
count_vector = dat_i$frequency_of_occurence)
past_size_df_i <- data.frame(size1mm = past_size_i,
year = year_i,
breeding = breeding_i)
past_size_df <- rbind(past_size_df, past_size_df_i)
}
past_size_df
past_size_df %>% count(breeding, year)
past_size_df <- past_size_df %>% filter(!is.na(breeding))
past_size_df %>% count(breeding, year)
he
# Size-frequency raw data, Hayford-Elahi-FHL470, 2018
he <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Shady_Cove_shelllength_rawdata_2018.csv")
he
he <- he %>% rename(size1mm = shell_length_mm, breeding = breeding_group, year = Year)
he
# Size-frequency counts, Spight 1968 at Shady Cove
# Spight 1974, Ecology, Figure 2 Population IV
# Student digitized data
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(Year, breeding_group, shell_length_mm)
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0),
yr_bg = paste(Year, breeding_group, sep = "_"))
spight %>% count(Year, breeding_group, size_bin) %>% print(n = 100)
# Use repeated sizes, because increments are in 1mm for both past and present
# Need a loop to cycle through each year and breeding group to repeat the observed sizes
yr_bg_unique <- unique(spight$yr_bg)
past_size_df <- data.frame(size1mm = NA,
year = NA,
breeding = NA)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
source("R/convert_histo_to_raw.R")
source("R/choose_size_threshold.R")
# Size-frequency raw data, Hayford-Elahi-FHL470, 2018
he <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Shady_Cove_shelllength_rawdata_2018.csv")
he <- he %>% rename(size1mm = shell_length_mm, breeding = breeding_group, year = Year)
# Size-frequency counts, Spight 1968 at Shady Cove
# Spight 1974, Ecology, Figure 2 Population IV
# Student digitized data
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(Year, breeding_group, shell_length_mm)
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0),
yr_bg = paste(Year, breeding_group, sep = "_"))
# Use repeated sizes, because increments are in 1mm for both past and present
# Need a loop to cycle through each year and breeding group to repeat the observed sizes
yr_bg_unique <- unique(spight$yr_bg)
past_size_df <- data.frame(size1mm = NA,
year = NA,
breeding = NA)
# Run loop
for(i in 1:length(yr_bg_unique)){
dat_i <- spight %>% filter(yr_bg == yr_bg_unique[i])
year_i <- unique(dat_i$Year)
breeding_i <- unique(dat_i$breeding_group)
past_size_i <- repeat_sizes(size_bin_vector = dat_i$size_bin,
count_vector = dat_i$frequency_of_occurence)
past_size_df_i <- data.frame(size1mm = past_size_i,
year = year_i,
breeding = breeding_i)
past_size_df <- rbind(past_size_df, past_size_df_i)
}
past_size_df %>% count(breeding, year)
past_size_df <- past_size_df %>% filter(!is.na(breeding))
# Combine past and present data
he2
# Combine past and present data
he2 <- rbind(past_size_df, he)
he2
# Combine past and present data
he2 <- rbind(past_size_df, he) %>% tbl_df()
he2
# Combine past and present data
he2 <- rbind(past_size_df, he) %>%
mutate(population = "V_VI",
province = "TS_SB_43S_UCV_CV") %>%
tbl_df()
he2
# Combine past and present data
he2 <- rbind(past_size_df, he) %>%
mutate(population = "V_VI",
province = "TS_SB_43S_UCV_CV",
figure = "Spight_1974_Ecology_Fig2") %>%
tbl_df()
he2
write.csv(he2, "sbs_meta/scraped/HayfordElahi_2018/Spight_snail_resurvey_180925.csv")
# Combine past and present data
he2 <- rbind(past_size_df, he) %>%
mutate(population = "V_VI",
province = "TS_SB_43S_UCV_CV",
figure = "Spight_1974_Ecology_Fig2")
head(he2)
write.csv(he2, "sbs_meta/scraped/HayfordElahi_2018/Spight_snail_resurvey_180925.csv")
head(he)
he <- he %>%
mutate(data = ifelse(year == 2018, "4/19/2018", paste("4/15", year, sep = "/")))
str(he)
he2 <- he %>%
mutate(date = ifelse(year == 2018, "4/19/2018", paste("4/15", year, sep = "/")))
unique(he2$date)
##### LOAD PACKAGES, DATA #####
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
source("R/convert_histo_to_raw.R")
source("R/choose_size_threshold.R")
# Size-frequency raw data, Hayford-Elahi-FHL470, 2018
he <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Shady_Cove_shelllength_rawdata_2018.csv")
he <- he %>% rename(size1mm = shell_length_mm, breeding = breeding_group, year = Year)
# Size-frequency counts, Spight 1968 at Shady Cove
# Spight 1974, Ecology, Figure 2 Population IV
# Student digitized data
spight <- read_csv("sbs_meta/scraped/HayfordElahi_2018/Spight_rawdata_fig1968_breedinggroup.csv")
spight <- spight %>% arrange(Year, breeding_group, shell_length_mm)
# Format Spight data
spight <- spight %>%
mutate(size_bin = round(shell_length_mm, 0),
frequency_of_occurence = round(frequency_of_occurence, 0),
yr_bg = paste(Year, breeding_group, sep = "_"))
# Use repeated sizes, because increments are in 1mm for both past and present
# Need a loop to cycle through each year and breeding group to repeat the observed sizes
yr_bg_unique <- unique(spight$yr_bg)
past_size_df <- data.frame(size1mm = NA,
year = NA,
breeding = NA)
# Run loop
for(i in 1:length(yr_bg_unique)){
dat_i <- spight %>% filter(yr_bg == yr_bg_unique[i])
year_i <- unique(dat_i$Year)
breeding_i <- unique(dat_i$breeding_group)
past_size_i <- repeat_sizes(size_bin_vector = dat_i$size_bin,
count_vector = dat_i$frequency_of_occurence)
past_size_df_i <- data.frame(size1mm = past_size_i,
year = year_i,
breeding = breeding_i)
past_size_df <- rbind(past_size_df, past_size_df_i)
}
past_size_df %>% count(breeding, year)
past_size_df <- past_size_df %>% filter(!is.na(breeding))
# Combine past and present data
he <- rbind(past_size_df, he) %>%
mutate(population = "V_VI",
province = "TS_SB_43S_UCV_CV",
figure = "Spight_1974_Ecology_Fig2")
head(he)
write.csv(he, "sbs_meta/scraped/HayfordElahi_2018/Spight_snail_resurvey_180925.csv")
he2 <- he %>%
mutate(date = ifelse(year == 2018, "4/19/2018", paste("4/15", year, sep = "/")))
unique(he2$date)
he2 <- he %>%
mutate(date = ifelse(year == 2018, "4/19/2018", paste("4/15", year, sep = "/")),
notes = ifelse(year == 2018, NA, "day is unknown"))
unique(he2$date)
unique(he2$notes)
he2
he2 <- he %>%
mutate(date = ifelse(year == 2018, "4/19/2018", paste("4/15", year, sep = "/")),
notes = ifelse(year == 2018, NA, "day is unknown")) %>%
tbl_df()
unique(he2$date)
unique(he2$notes)
he2
he2 <- he %>%
mutate(date = ifelse(year == 2018, "4/19/2018", paste("4/15", year, sep = "/")),
notes = ifelse(year == 2018, NA, "day is unknown"),
era = ifelse(year > 2017, "present", "past")) %>%
tbl_df()
unique(he2$date)
unique(he2$notes)
he2
he_3 <- data.frame(
study = "Hayford-Elahi",
studySub = NA,
species = "Nucella lamellosa",
sp = "NULA",
site = "ShadyCove",
era = he2$era,
date = he2$date,
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = he2$size1mm,
size1mm_rand = he2$size1mm,
habitat = NA,
tideHTm = 0,
lat = 48.552,
long = -123.006,
Shaw_hab = NA,
notes = he2$notes,
notes2 = ""
)
he3
he3 <- data.frame(
study = "Hayford-Elahi",
studySub = NA,
species = "Nucella lamellosa",
sp = "NULA",
site = "ShadyCove",
era = he2$era,
date = he2$date,
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = he2$size1mm,
size1mm_rand = he2$size1mm,
habitat = NA,
tideHTm = 0,
lat = 48.552,
long = -123.006,
Shaw_hab = NA,
notes = he2$notes,
notes2 = ""
)
he3
he3 <- data.frame(
study = "Hayford-Elahi",
studySub = NA,
species = "Nucella lamellosa",
sp = "NULA",
site = "ShadyCove",
era = he2$era,
date = he2$date,
nest1 = NA,
nest2 = NA,
nest3 = NA,
nest3note = NA,
sampleUnit = NA,
size1mm = he2$size1mm,
size1mm_rand = he2$size1mm,
habitat = NA,
tideHTm = 0,
lat = 48.552,
long = -123.006,
Shaw_hab = NA,
notes = he2$notes,
notes2 = "",
year = he2$year
)
head(he3)
# Save this file
write.csv(he3, "sbs_meta/scraped/HayfordElahi_2018/Hayford-Elahi_raw.csv")
# Select years to analyze
he3 %>% count(year)
dat <- he3 %>% filter(year == 1969 | year == 2018)
# Size threshold for museum comparison
dat <- dat %>% mutate(size_threshold = 0)
dat_sub <- choose_size_threshold_general(dat, era = "combined", my_quantile = 0.5)
dat %>% count(species, era)
dat_sub %>% count(species, era)
## Summarise
dat_summary_all <- dat %>%
group_by(species, sp, year, era, size_threshold) %>%
summarise(size1mm_mean = mean(size1mm, na.rm = TRUE),
size1mm_sd = sd(size1mm, na.rm = TRUE),
sample_size = n()) %>%
ungroup() %>%
mutate(studySub = "threshold_none",
museum = FALSE)
dat_summary_sub <- dat_sub %>%
group_by(species, sp, year, era, size_threshold) %>%
summarise(size1mm_mean = mean(size1mm, na.rm = TRUE),
size1mm_sd = sd(size1mm, na.rm = TRUE),
sample_size = n()) %>%
ungroup() %>%
mutate(studySub = "threshold_median",
museum = TRUE)
dat_summary <- rbind(dat_summary_all, dat_summary_sub)
dat_summary
dat
head(dat)
##### FORMAT TABLE FOR META-ANALYSIS #####
df_final <- dat_summary %>%
mutate(size_rep = size1mm_mean,
size_error = size1mm_sd,
size_original = "raw",
species = "Nucella lamellosa",
time_rep = NA,
sample_size_units = "total number of snails",
lat = unique(dat$lat),
long = unique(dat$long),
site = "Shady Cove") %>%
arrange(species, year)
names(df_final)
View(df_final)
dfMeta <- data.frame(
study = "Hayford-Elahi_2018",
studySub = df_final$studySub,
fig_table = "Figure 2",
species = df_final$species,
site = df_final$site,
size_original = df_final$size_original,
size_rep = df_final$size_rep,
size_units = "mm",
size_error = df_final$size_error,
size_error_type = "SD",
time_rep = df_final$time_rep,
time_error = NA,
era = df_final$era,
year = df_final$year,
year_error = NA,
year_error_type = NA,
sample_size = df_final$sample_size,
sample_size_units = df_final$sample_size_units,
museum = df_final$museum,
size_threshold_mm = df_final$size_threshold,
latitude = df_final$lat,
longitude = df_final$long
)
dfMeta
dfMeta <- data.frame(
study = "Hayford-Elahi_2018",
studySub = df_final$studySub,
fig_table = "Figure 2",
species = df_final$species,
site = df_final$site,
size_original = df_final$size_original,
size_rep = df_final$size_rep,
size_units = "mm",
size_error = df_final$size_error,
size_error_type = "SD",
time_rep = df_final$time_rep,
time_error = NA,
era = df_final$era,
year = df_final$year,
year_error = NA,
year_error_type = NA,
sample_size = df_final$sample_size,
sample_size_units = df_final$sample_size_units,
museum = FALSE,
size_threshold_mm = df_final$size_threshold,
latitude = df_final$lat,
longitude = df_final$long
)
dfMeta
write.csv(dfMeta, "sbs_meta/output/dfMeta_Hayford-Elahi.csv")
write.csv(dfMeta, "sbs_meta/output/dfMeta_Hayford-Elahi.csv")
write.csv(dfMeta, "sbs_meta/output/dfMeta_Hayford-Elahi_2018.csv")
