maximum = max(tempC),
minimum = min(tempC))
mutate(dateR = ymd(paste(year, month, 15, sep = "-"))) %>%
ungroup()
sst_monthly <- sst %>% group_by(year, month) %>%
summarise(median = median(tempC),
maximum = max(tempC),
minimum = min(tempC)) %>%
mutate(dateR = ymd(paste(year, month, 15, sep = "-"))) %>%
ungroup()
sst_monthly
sst
sst <- sst_hms %>% filter(year > 1936 & year < 2016)
sst %>% group_by(month) %>%
summarise(meanTemp = mean(tempC)) %>% ungroup() %>%
arrange(meanTemp)
sst_monthly <- sst %>% group_by(year, month) %>%
summarise(median = median(tempC),
maximum = max(tempC),
minimum = min(tempC)) %>%
mutate(dateR = ymd(paste(year, month, 15, sep = "-"))) %>%
ungroup()
sst_monthly
sst_monthly_species <- temp_series_dat %>% group_by(species, year, month) %>%
summarise(monthly_mean = mean(tempC),
monthly_median = median(tempC),
monthly_max = max(tempC),
monthly_min = min(tempC),
monthly_sd = sd(tempC),
monthly_cv = monthly_sd/monthly_mean * 100) %>%
mutate(dateR = ymd(paste(year, month, 15, sep = "-"))) %>%
ungroup()
# Get in long format
sst_monthly_species_L <- sst_monthly_species %>%
gather(key = metric, value = tempC, monthly_mean:monthly_cv)
monthly_sstL <- elahi_sst_monthly %>%
gather(key = metric, value = tempC, monthly_mean:monthly_cv)
monthly_sstL <- sst_monthly %>%
gather(key = metric, value = tempC, monthly_mean:monthly_cv)
sst_monthly
monthly_sstL <- sst_monthly %>%
gather(key = metric, value = tempC, median:minimum)
monthly_sstL
sst_monthly
sst_monthly %>%
filter(month == 7 & month == 8 & month == 9)
sst_monthly %>%
filter(month == 7 | month == 8 | month == 9)
sst_monthly_max <- sst_monthly %>%
filter(month == 7 | month == 8 | month == 9) %>%
group_by(year) %>%
summarise(maximum = mean(maximumum)) %>% ungroup()
sst_monthly_max <- sst_monthly %>%
filter(month == 7 | month == 8 | month == 9) %>%
group_by(year) %>%
summarise(maximum = mean(maximum)) %>% ungroup()
sst_monthly_max
sst_monthly_min <- sst_monthly %>%
filter(month == 12 | month == 1 | month == 2) %>%
group_by(year) %>%
summarise(minimum = mean(minimum)) %>% ungroup()
sst_monthly_min
sst_monthly_med <- sst_monthly %>%
group_by(year) %>%
summarise(median = mean(median)) %>% ungroup()
sst_monthly_med
sst_annual <- inner_join(sst_monthly_max, sst_monthly_min,
by = "year") %>%
inner_join(., sst_monthly_med, by = "year")
sst_annual
sst_annual_long <- sst_annual %>%
gather(key = metric, value = tempC, maximum:median)
sst_annual_long
gls_annual_summary <- sst_annual_long %>% group_by(metric) %>%
do(get_gls_results(df = ., dep_var = "tempC", ind_var = "year")) %>%
ungroup()
df = species_sst_annual %>% filter(species == "Littorina keenae")
dep_var = "max_C"
ind_var = "year"
get_gls_results <- function(df, dep_var, ind_var) {
nYrs <- dim(df)[1]
# Run gls model
gls.i <- gls(as.formula(paste(dep_var, "~", ind_var, sep = " ")),
data = df, correlation = corAR1())
# Get dataframe
gls_results.i <- as.data.frame(summary(gls.i)$tTable)
names(gls_results.i) <- c("value", "std_error", "t_value", "p_value")
# Estimate the total change in temperature over the study duration
gls_results.i <- gls_results.i %>%
mutate(coef_name = c("intercept", "slope"),
duration_yrs = nYrs,
change_temp_C = ifelse(coef_name == "slope",
round(value * duration_yrs, 3),
NA))
return(gls_results.i)
}
gls_annual_summary <- sst_annual_long %>% group_by(metric) %>%
do(get_gls_results(df = ., dep_var = "tempC", ind_var = "year")) %>%
ungroup()
gls_monthly_summary2 <- gls_monthly_summary %>%
filter(coef_name == "slope") %>%
select(-coef_name, -t_value) %>%
rename(slope = value)
gls_annual_summary
sst_annual_long %>% filter(metric == "maximum") %>%
ggplot(aes(dateR, tempC)) +
geom_line(alpha = 0.5) +
ylab(expression(paste("Sea surface temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "top") +
geom_smooth()
sst_annual_long %>% filter(metric == "maximum") %>%
ggplot(aes(year, tempC)) +
geom_line(alpha = 0.5) +
ylab(expression(paste("Sea surface temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "top") +
geom_smooth()
sst_annual_long
sst_annual_long %>% #filter(metric == "maximum") %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 0.5) +
ylab(expression(paste("Sea surface temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "top") +
geom_smooth()
sst_annual_long %>% #filter(metric == "maximum") %>%
ggplot(aes(year, tempC, color = metric)) +
geom_point(alpha = 0.5) +
ylab(expression(paste("Sea surface temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "top") +
geom_smooth(method = "lm")
gls_annual_summary
sst_annual_long %>% #filter(metric == "maximum") %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 0.1) +
ylab(expression(paste("Sea surface temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "top") +
geom_smooth(method = "lm")
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 0.25) +
geom_point(alpha = 0.25) +
ylab(expression(paste("Sea surface temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "top") +
geom_smooth(method = "lm")
sst_annual_long %>% #filter(metric == "maximum") %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 0.25) +
geom_point(alpha = 0.25) +
ylab(expression(paste("Sea surface temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "top") +
geom_smooth(method = "lm")
sst_annual_long %>% #filter(metric == "maximum") %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line(alpha = 0.25) +
geom_point(alpha = 0.25, size = 1) +
ylab(expression(paste("Sea surface temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "top") +
geom_smooth(method = "lm")
rm(list=ls(all=TRUE))
source("05_summarise_hms_sst.R")
library(nlme)
library(broom)
sst_annual_long
get_gls_results <- function(df, dep_var, ind_var) {
nYrs <- dim(df)[1]
# Run gls model
gls.i <- gls(as.formula(paste(dep_var, "~", ind_var, sep = " ")),
data = df, correlation = corAR1())
# Get dataframe
gls_results.i <- as.data.frame(summary(gls.i)$tTable)
names(gls_results.i) <- c("value", "std_error", "t_value", "p_value")
# Estimate the total change in temperature over the study duration
gls_results.i <- gls_results.i %>%
mutate(coef_name = c("intercept", "slope"),
duration_yrs = nYrs,
change_temp_C = ifelse(coef_name == "slope",
round(value * duration_yrs, 3),
NA))
return(gls_results.i)
}
gls_annual_summary <- sp_sst_ann_L %>% group_by(metric) %>%
do(get_gls_results(df = ., dep_var = "tempC", ind_var = "year")) %>%
ungroup()
gls_annual_summary <- sst_annual_long %>% group_by(metric) %>%
do(get_gls_results(df = ., dep_var = "tempC", ind_var = "year")) %>%
ungroup()
gls_annual_summary
gls_annual_summary2 <- gls_annual_summary %>%
filter(coef_name == "slope") %>%
select(-coef_name, -t_value) %>%
rename(slope = value)
gls_annual_summary2
sst_annual_long
get_gls_results
sst <- sst_hms %>% filter(year > 1937 & year < 2016)
# What are the warmest and coldest months?
sst %>% group_by(month) %>%
summarise(meanTemp = mean(tempC)) %>% ungroup() %>%
arrange(meanTemp)
# Coldest == Dec, Jan, Feb
# Warmest == July, Aug, Sep
##### SUMMARISE MONTHLY #####
sst_monthly <- sst %>% group_by(year, month) %>%
summarise(median = median(tempC),
maximum = max(tempC),
minimum = min(tempC)) %>%
mutate(dateR = ymd(paste(year, month, 15, sep = "-"))) %>%
ungroup()
##### GET ANNUAL TIME SERIES #####
# Calculate mean of hottest months for maximum per year
sst_monthly_max <- sst_monthly %>%
filter(month == 7 | month == 8 | month == 9) %>%
group_by(year) %>%
summarise(maximum = mean(maximum)) %>% ungroup()
# Calculate mean of coldest months for minimum per year
sst_monthly_min <- sst_monthly %>%
filter(month == 12 | month == 1 | month == 2) %>%
group_by(year) %>%
summarise(minimum = mean(minimum)) %>% ungroup()
# Calculate mean of median temperatures for median per year
sst_monthly_med <- sst_monthly %>%
group_by(year) %>%
summarise(median = mean(median)) %>% ungroup()
sst_annual <- inner_join(sst_monthly_max, sst_monthly_min,
by = "year") %>%
inner_join(., sst_monthly_med, by = "year")
sst_annual
# Get in long format
sst_annual_long <- sst_annual %>%
gather(key = metric, value = tempC, maximum:median)
gls_annual_summary <- sst_annual_long %>% group_by(metric) %>%
do(get_gls_results(df = ., dep_var = "tempC", ind_var = "year")) %>%
ungroup()
gls_annual_summary
gls_annual_summary2 <- gls_annual_summary %>%
filter(coef_name == "slope") %>%
select(-coef_name, -t_value) %>%
rename(slope = value)
write.csv(gls_annual_summary2, "output/gls_annual_summary2.csv")
gls_annual_summary2
sst_annual
sst_annual_long
library(dplyr)
library(tidyr)
library(ggplot2)
theme_set(theme_bw(base_size = 12))
library(lubridate)
weather <- read.csv(file = "data/climate_monterey/monterey_weather.txt",
skip = 53, header = TRUE, stringsAsFactors = FALSE)
head(weather)
tail(weather)
summary(weather)
unique(weather$Wx)
weather2 <- weather %>% select(dateR, month, year, precip, air_max:air_obs)
head(weather2)
weather <- weather %>% select(Station:Wx) %>%
mutate(dateR = ymd(Date),
month = month(dateR),
year = year(dateR)) %>%
rename(precip = Precip, air_max = Air.max, air_min = min, air_obs = obs)
glimpse(weather)
unique(weather$Wx)
weather2 <- weather %>% select(dateR, month, year, precip, air_max:air_obs)
head(weather2)
wL <- weather2 %>% gather(., key = climate_var, value = value, precip:air_obs)
wL %>%
ggplot(aes(climate_var, value)) +
geom_boxplot() +
facet_wrap(~ climate_var, scales = "free", ncol = 4)
weather2
tail(weather3)
weather3 <- weather2 %>% filter(!is.na(air_obs))
tail(weather3)
tail(weather2)
wL <- weather2 %>% gather(., key = climate_var, value = value, air_max:air_obs)
wL %>%
ggplot(aes(climate_var, value)) +
geom_boxplot() +
facet_wrap(~ climate_var, scales = "free", ncol = 4)
wL
head(wL)
wL
tail(wL)
wL <- weather2 %>% gather(., key = climate_var, value = value, air_max:air_obs) %>%
filter(year < 2016)
tail(wL)
wL %>%
ggplot(aes(climate_var, value)) +
geom_boxplot() +
facet_wrap(~ climate_var, scales = "free", ncol = 4)
wL %>%
ggplot(aes(climate_var, value)) +
geom_boxplot() +
facet_wrap(~ climate_var)
wL %>%
ggplot(aes(climate_var, value)) +
geom_boxplot()
wL
tail(wL)
glimpse(wL)
wL %>% group_by(month, climate_var) %>%
summarise(meanTemp = mean(tempC)) %>% ungroup() %>%
arrange(meanTemp)
wL %>% group_by(month, climate_var) %>%
summarise(meanTemp = mean(value)) %>% ungroup() %>%
arrange(meanTemp)
wL %>% group_by(month, climate_var) %>%
summarise(meanTemp = mean(value)) %>% ungroup() %>%
arrange(meanTemp) %>% View()
wL %>% group_by(month, climate_var) %>%
summarise(meanTemp = mean(value, na.rm = TRUE)) %>% ungroup() %>%
arrange(meanTemp) %>% View()
wL %>% group_by(month, climate_var) %>%
summarise(meanTemp = mean(value, na.rm = TRUE)) %>% ungroup() %>%
arrange(climate_var, meanTemp) %>% View()
head(wL)
wL_monthly_max <- wL %>%
filter(month == 10 | month == 8 | month == 9) %>%
group_by(year) %>%
summarise(maximum = mean(value)) %>% ungroup()
wL_monthly_max
wL_monthly_max <- wL %>% filter(!is.na(value)) %>%
filter(month == 10 | month == 8 | month == 9) %>%
group_by(year) %>%
summarise(maximum = mean(value)) %>% ungroup()
wL_monthly_max
tail(wL_monthly_max)
wL
head(wL)
wL_monthly_max <- wL %>% filter(!is.na(value)) %>%
filter(climate_var == "air_max")
filter(month == 10 | month == 8 | month == 9) %>%
group_by(year) %>%
summarise(maximum = mean(value)) %>% ungroup()
wL_monthly_max <- wL %>% filter(!is.na(value)) %>%
filter(climate_var == "air_max") %>%
filter(month == 10 | month == 8 | month == 9) %>%
group_by(year) %>%
summarise(maximum = mean(value)) %>% ungroup()
wL_monthly_max
tail(wL_monthly_max)
wL_monthly_min <- wL %>% filter(!is.na(value)) %>%
filter(climate_var == "air_min") %>%
filter(month == 12 | month == 1 | month == 2) %>%
group_by(year) %>%
summarise(minimum = mean(value)) %>% ungroup()
wL_monthly_min
wL_monthly_med <- wL %>% filter(!is.na(value)) %>%
filter(climate_var == "air_obs") %>%
group_by(year) %>%
summarise(median = mean(value)) %>% ungroup()
wL_monthly_med
air_annual <- inner_join(wL_monthly_max, wL_monthly_min,
by = "year") %>%
inner_join(., wL_monthly_med, by = "year")
air_annual
air_annual_long <- air_annual %>%
gather(key = metric, value = tempC, maximum:median)
air_annual_long
gls_annual_summary <- air_annual_long %>% group_by(metric) %>%
do(get_gls_results(df = ., dep_var = "tempC", ind_var = "year")) %>%
ungroup()
gls_annual_summary
gls_annual_summary2 <- gls_annual_summary %>%
filter(coef_name == "slope") %>%
select(-coef_name, -t_value) %>%
rename(slope = value)
gls_annual_summary2
wL_monthly_max <- wL %>% filter(!is.na(value)) %>%
filter(climate_var == "air_max") %>%
#filter(month == 10 | month == 8 | month == 9) %>%
group_by(year) %>%
summarise(maximum = mean(value)) %>% ungroup()
# Calculate mean of coldest months for minimum per year
wL_monthly_min <- wL %>% filter(!is.na(value)) %>%
filter(climate_var == "air_min") %>%
#filter(month == 12 | month == 1 | month == 2) %>%
group_by(year) %>%
summarise(minimum = mean(value)) %>% ungroup()
# Calculate mean of observed temperatures for median per year
wL_monthly_med <- wL %>% filter(!is.na(value)) %>%
filter(climate_var == "air_obs") %>%
group_by(year) %>%
summarise(median = mean(value)) %>% ungroup()
air_annual <- inner_join(wL_monthly_max, wL_monthly_min,
by = "year") %>%
inner_join(., wL_monthly_med, by = "year")
air_annual
# Get in long format
air_annual_long <- air_annual %>%
gather(key = metric, value = tempC, maximum:median)
gls_annual_summary <- air_annual_long %>% group_by(metric) %>%
do(get_gls_results(df = ., dep_var = "tempC", ind_var = "year")) %>%
ungroup()
gls_annual_summary
gls_annual_summary2 <- gls_annual_summary %>%
filter(coef_name == "slope") %>%
select(-coef_name, -t_value) %>%
rename(slope = value)
gls_annual_summary2
rm(list=ls(all=TRUE))
source("05_summarise_monterey_weather.R")
library(nlme)
library(broom)
air_annual_long
get_gls_results <- function(df, dep_var, ind_var) {
nYrs <- dim(df)[1]
# Run gls model
gls.i <- gls(as.formula(paste(dep_var, "~", ind_var, sep = " ")),
data = df, correlation = corAR1())
# Get dataframe
gls_results.i <- as.data.frame(summary(gls.i)$tTable)
names(gls_results.i) <- c("value", "std_error", "t_value", "p_value")
# Estimate the total change in temperature over the study duration
gls_results.i <- gls_results.i %>%
mutate(coef_name = c("intercept", "slope"),
duration_yrs = nYrs,
change_temp_C = ifelse(coef_name == "slope",
round(value * duration_yrs, 3),
NA))
return(gls_results.i)
}
gls_annual_summary <- air_annual_long %>% group_by(metric) %>%
do(get_gls_results(df = ., dep_var = "tempC", ind_var = "year")) %>%
ungroup()
gls_annual_summary
gls_annual_summary2 <- gls_annual_summary %>%
filter(coef_name == "slope") %>%
select(-coef_name, -t_value) %>%
rename(slope = value)
gls_annual_summary2
air_annual_long
air_annual_long %>%
ggplot(aes(year, value, color = metric)) +
geom_point(alpha = 0.5) +
scale_color_manual(values = c("red", "black", "blue")) +
ylab(expression(paste("Air temperature (", degree, "C)"))) +
xlab("Year")
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_point(alpha = 0.5) +
scale_color_manual(values = c("red", "black", "blue")) +
ylab(expression(paste("Air temperature (", degree, "C)"))) +
xlab("Year")
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_point(alpha = 0.5) +
scale_color_manual(values = c("red", "black", "blue")) +
ylab(expression(paste("Air temperature (", degree, "C)"))) +
xlab("Year") +
geom_point(aes(x = year, y = 5.5, shape = genus, color = NULL), data = spYrs,
alpha = 0.5, size = 3)
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_point(alpha = 0.5) +
scale_color_manual(values = c("red", "black", "blue")) +
ylab(expression(paste("Air temperature (", degree, "C)"))) +
xlab("Year") +
guides(color = FALSE) +
theme(legend.title = element_blank()) +
theme(legend.position = "top") +
geom_smooth(data = subset(air_annual_long,  metric == "minimum"),
aes(year, tempC),
method = "lm")
head(wL)
unique(wL$climate_var)
wL %>% filter(!is.na(value)) %>%
filter(climate_var == "air_max") %>%
filter(month == 10 | month == 8 | month == 9) %>%
group_by(year)
wL
wL %>% filter(!is.na(value)) %>%
filter(climate_var == "air_max")
wL %>% group_by(month, year, climate_var) %>% tally()
wL %>% group_by(month, year, climate_var) %>% tally() %>%
filter(n < 30)
wL %>% group_by(month, year, climate_var) %>% tally() %>%
filter(n < 28)
wL %>% filter(!is.na(value)) %>%
group_by(month, year, climate_var) %>% tally() %>%
filter(n < 28)
wL
head(wL)
wL <- weather2 %>% select(-precip) %>%
gather(., key = climate_var, value = value, air_max:air_obs) %>%
filter(year < 2016)
tail(wL)
glimpse(wL)
wL %>%
ggplot(aes(climate_var, value)) +
geom_boxplot()
# What are the warmest and coldest months?
wL %>% group_by(month, climate_var) %>%
summarise(meanTemp = mean(value, na.rm = TRUE)) %>% ungroup() %>%
arrange(climate_var, meanTemp) %>% View()
wL %>% group_by(month, climate_var) %>%
summarise(meanTemp = median(value, na.rm = TRUE)) %>% ungroup() %>%
arrange(climate_var, meanTemp) %>% View()
