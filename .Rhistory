#                             metric == "maximum"), method = "lm",
#             color = "darkgray", linetype = "dashed") +
geom_smooth(data = subset(temp_records, dataset == "Air" &
metric == "minimum"), method = "lm",
color = "darkgray", linetype = "dashed") +
geom_line(alpha = 1) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "top") +
guides(color = FALSE) +
guides(shape =
guide_legend(title = "SAMPLING EVENT", title.position = "top",
title.hjust = 0.5,
title.theme =
element_text(size = 10, face = "bold", angle = 0),
direction = "horizontal",
label.theme = element_text(angle = 0, size = 8,
face =  "italic"))) +
facet_wrap(~ dataset) +
theme(strip.background = element_blank()) +
geom_line(data = lim_for_sst,
aes(year, tempC), alpha = 0.25, size = 1.5) +
geom_line(data = lim_for_air,
aes(year, tempC), alpha = 0.25, size = 1.5) +
geom_line(data = lim_for_sst,
aes(year, tempC, group = metric), alpha = 1, size = 0.25, color = "black") +
geom_line(data = lim_for_air,
aes(year, tempC, group = metric), alpha = 1, size = 0.25, color = "black") +
geom_text(aes(x, y, label = text1), data = text_df, size = 3,
hjust = 0, fontface = "bold") +
geom_point(aes(x = year, y = 5, shape = species, color = NULL), data = spYrs,
alpha = 0.6, size = 2) +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = facet_label_text, size = 5, hjust = 0.25, vjust = 0.75,
show.legend = FALSE)
air_annual_long
# Get monterey air summary
source("2_summarise_data/summarise_monterey_weather.R")
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)
theme_set(theme_bw(base_size = 12))
library(lubridate)
source("R/process_weather_data.R")
path_to_weather_data <- "data/uc_ipm/"
# Need a list of file names
fileNames <- dir(path = path_to_weather_data, recursive = TRUE,
pattern = ".txt")
monterey <- format_weather_data(path = path_to_weather_data,
weather_file = fileNames[3],
lines_to_skip = 55)
# Are some months poorly sampled?
# Remove months that have fewer than 15 samples
monterey %>% filter(!is.na(air_max)) %>%
group_by(year, month) %>% tally() %>% ungroup() %>%
filter(n < 15)
monterey2 <- monterey %>% filter(!is.na(air_max)) %>%
group_by(year, month) %>%
mutate(n = n()) %>% ungroup()
monterey3 <- monterey2 %>% filter(n > 15)
weather <- monterey3
head(weather)
tail(weather)
summary(weather)
glimpse(weather)
#### GET WARMEST AND COLDEST MONTHS #####
wL <- weather %>%
gather(., key = climate_var, value = value, air_max:air_obs)
tail(wL)
glimpse(wL)
# What are the warmest and coldest months?
wL %>% group_by(month, climate_var) %>%
summarise(meanTemp = mean(value, na.rm = TRUE)) %>% ungroup() %>%
arrange(climate_var, meanTemp) %>%
filter(climate_var == "air_obs") %>% View()
##### SUMMARISE MONTHLY #####
# Use air_obs, air_max, air_min
wM <- weather %>% group_by(Station, year, month) %>%
summarise(median = median(air_obs, na.rm = TRUE),
maximum = median(air_max, na.rm = TRUE),
minimum = median(air_min, na.rm = TRUE)) %>%
mutate(dateR = ymd(paste(year, month, 15, sep = "-"))) %>%
ungroup()
wM
tail(wM)
summary(wM)
# Calculate mean of hottest months for maximum per year
monthly_max <- wM %>% filter(!is.na(maximum)) %>%
filter(month == 10 | month == 8 | month == 9) %>%
group_by(year) %>%
summarise(maximum = mean(maximum)) %>% ungroup()
# Calculate mean of coldest months for minimum per year
monthly_min <- wM %>% filter(!is.na(minimum)) %>%
filter(month == 12 | month == 1 | month == 2) %>%
group_by(year) %>%
summarise(minimum = mean(minimum)) %>% ungroup()
# Calculate mean of observed temperatures for median per year
monthly_med <- wM %>% filter(!is.na(median)) %>%
group_by(year) %>%
summarise(median = mean(median)) %>% ungroup()
air_annual <- inner_join(monthly_max, monthly_min,
by = "year") %>%
inner_join(., monthly_med, by = "year")
air_annual
tail(air_annual)
# Get in long format
air_annual_long <- air_annual %>%
gather(key = metric, value = tempC, maximum:median) %>%
filter(!is.na(tempC))
tail(air_annual_long)
air_annual_long
weather2 <- weather %>%
mutate(era = ifelse(year < 1961, "past",
ifelse(year > 2000, "present", "between"))) %>%
filter(era != "between")
decade_max <- weather2 %>% group_by(era, month) %>%
summarise(mean = mean(air_max, na.rm = TRUE),
sd = sd(air_max, na.rm = TRUE),
n = n(),
se = sd/sqrt(n),
CI = qt(0.975, df = n - 1) * se,
upper = mean + CI,
lower = mean - CI)
decade_max_long <- decade_max %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(summary_stat == "mean", "average", "ci"),
metric = "maximum")
decade_min <- weather2 %>% group_by(era, month) %>%
summarise(mean = mean(air_min, na.rm = TRUE),
sd = sd(air_min, na.rm = TRUE),
n = n(),
se = sd/sqrt(n),
CI = qt(0.975, df = n - 1) * se,
upper = mean + CI,
lower = mean - CI)
decade_min_long <- decade_min %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(summary_stat == "mean", "average", "ci"),
metric = "minimum")
decade_obs <- weather2 %>% group_by(era, month) %>%
summarise(mean = mean(air_obs, na.rm = TRUE),
sd = sd(air_obs, na.rm = TRUE),
n = n(),
se = sd/sqrt(n),
CI = qt(0.975, df = n - 1) * se,
upper = mean + CI,
lower = mean - CI)
decade_obs_long <- decade_obs %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(summary_stat == "mean", "average", "ci"),
metric = "median")
decade_dat <- rbind(decade_max_long, decade_min_long, decade_obs_long)
decade_dat
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat, metric))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
#facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(0.75, 0.25)) +
theme(strip.background = element_blank()) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Month") +
ggtitle("Air") +
scale_x_continuous(breaks = seq(1, 12, 1)) +
guides(linetype = FALSE, size = FALSE) +
theme(legend.position = c(0, 1), legend.justification = c(0, 1)) +
theme(legend.title = element_blank())
air_annual_long <- air_annual_long %>%
mutate(dataset = "Air")
################################################################################
##' @title Summarise SST data from HMS website
##'
##' @author Robin Elahi
##' @contact elahi.robin@gmail.com
##' @contributor
##'
##' @date 2016-08-12
##'
##' @log Add a log here
################################################################################
#rm(list=ls(all=TRUE))
##### LOAD PACKAGES, DATA #####
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)
theme_set(theme_bw(base_size = 12))
library(lubridate)
# Get hms temperature data
#source("R/get_hms_sst.R")
sst_hms <- read_csv("output/sst_hms.csv")[-1]
glimpse(sst_hms)
# Get snail size data
source("05_summarise_size_data.R")
# Get hms temperature functions
source("R/hms_sst_functions.R")
# Original data were single, daily measurements
glimpse(sst_hms)
sst_hms %>%
ggplot(aes(as.factor(month), tempC)) + geom_boxplot()
# I want a time-series starting 10 years prior to the first historic sampling year
# Childs sampled Littorina in 1947
# So, start year is 1938
sst <- sst_hms %>% filter(year > 1937 & year < 2016)
# What are the warmest and coldest months?
sst %>% group_by(month) %>%
summarise(meanTemp = mean(tempC)) %>% ungroup() %>%
arrange(meanTemp)
# Coldest == Dec, Jan, Feb
# Warmest == July, Aug, Sep
##### SUMMARISE MONTHLY #####
sst_monthly <- sst %>% group_by(year, month) %>%
summarise(median = median(tempC),
maximum = max(tempC),
minimum = min(tempC)) %>%
mutate(dateR = ymd(paste(year, month, 15, sep = "-"))) %>%
ungroup()
##### GET ANNUAL TIME SERIES #####
# Calculate mean of hottest months for maximum per year
sst_monthly_max <- sst_monthly %>%
filter(month == 7 | month == 8 | month == 9) %>%
group_by(year) %>%
summarise(maximum = mean(maximum)) %>% ungroup()
# Calculate mean of coldest months for minimum per year
sst_monthly_min <- sst_monthly %>%
filter(month == 12 | month == 1 | month == 2) %>%
group_by(year) %>%
summarise(minimum = mean(minimum)) %>% ungroup()
# Calculate mean of median temperatures for median per year
sst_monthly_med <- sst_monthly %>%
group_by(year) %>%
summarise(median = mean(median)) %>% ungroup()
sst_annual <- inner_join(sst_monthly_max, sst_monthly_min,
by = "year") %>%
inner_join(., sst_monthly_med, by = "year")
sst_annual
# Get in long format
sst_annual_long <- sst_annual %>%
gather(key = metric, value = tempC, maximum:median)
theme_set(theme_bw(base_size = 12))
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)
theme_set(theme_bw(base_size = 12))
library(lubridate)
source("R/process_weather_data.R")
path_to_weather_data <- "data/uc_ipm/"
# Need a list of file names
fileNames <- dir(path = path_to_weather_data, recursive = TRUE,
pattern = ".txt")
monterey <- format_weather_data(path = path_to_weather_data,
weather_file = fileNames[3],
lines_to_skip = 55)
unique(monterey$backup_status)
unique(monterey$Station)
dat <- monterey %>% rename(tempC = air_obs) %>%
select(dateR, month, year, tempC) %>% tbl_df()
# I will use the top 25th percentile of summer temps and bottom 25th percentile of winter temps
remove_data = T
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = remove_data)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = remove_data)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)
theme_set(theme_bw(base_size = 12))
library(lubridate)
source("R/temperature_functions.R")
# Get hms temperature data
#source("R/get_hms_sst.R")
sst_hms <- read_csv("output/sst_hms.csv")[-1]
glimpse(sst_hms)
source("R/temperature_functions.R")
# Get hms temperature data
#source("R/get_hms_sst.R")
sst_hms <- read_csv("output/sst_hms.csv")[-1]
glimpse(sst_hms)
# I want a time-series starting 10 years prior to the first historic sampling year
# Childs sampled Littorina in 1947
# So, start year is 1938
dat <- sst_hms %>% filter(year > 1937 & year < 2016)
# What are the warmest and coldest months?
dat %>% group_by(month) %>%
summarise(meanTemp = mean(tempC)) %>% ungroup() %>%
arrange(meanTemp)
# I will use the top 25th percentile of summer temps and bottom 25th percentile of winter temps
remove_data = F
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = remove_data)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = remove_data)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
sst_annual_long <- annual_df_long %>%
mutate(dataset = "Seawater")
# Plot
sst_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)
theme_set(theme_bw(base_size = 12))
library(lubridate)
source("R/temperature_functions.R")
source("R/process_weather_data.R")
## Get HMS temperature data
sst_hms <- read_csv("output/sst_hms.csv")[-1]
glimpse(sst_hms)
## Get Monterey weather data
path_to_weather_data <- "data/uc_ipm/"
# Need a list of file names
fileNames <- dir(path = path_to_weather_data, recursive = TRUE,
pattern = ".txt")
monterey <- format_weather_data(path = path_to_weather_data,
weather_file = fileNames[3],
lines_to_skip = 55)
unique(monterey$backup_status)
unique(monterey$Station)
dat <- monterey %>% rename(tempC = air_obs) %>%
select(dateR, month, year, tempC) %>% tbl_df()
dat
sst_hms
head(monterey)
dat
sst_hms
read_csv("output/sst_hms.csv")
## Get HMS temperature data - one measurement per day
sst_hms <- read_csv("output/sst_hms.csv") %>%
select(-c(X1, time))
sst_hms
## Get HMS temperature data - one measurement per day
sst <- read_csv("output/sst_hms.csv") %>%
select(-c(X1, time))
## Get Monterey weather data
path_to_weather_data <- "data/uc_ipm/"
# Need a list of file names
fileNames <- dir(path = path_to_weather_data, recursive = TRUE,
pattern = ".txt")
monterey <- format_weather_data(path = path_to_weather_data,
weather_file = fileNames[3],
lines_to_skip = 55)
unique(monterey$backup_status)
unique(monterey$Station)
# I use air_obs - one measurement per day
air <- monterey %>% rename(tempC = air_obs) %>%
select(dateR, month, year, tempC) %>% tbl_df()
air
# I use air_obs - one measurement per day
air <- monterey %>% rename(tempC = air_obs) %>%
select(dateR, month, year, tempC) %>% tbl_df() %>%
mutate(dataset = "Air")
## Get HMS temperature data - one measurement per day
sst <- read_csv("output/sst_hms.csv") %>%
select(-c(X1, time)) %>%
mutate(dataset = "Seawater")
## Get Monterey weather data
path_to_weather_data <- "data/uc_ipm/"
# Need a list of file names
fileNames <- dir(path = path_to_weather_data, recursive = TRUE,
pattern = ".txt")
monterey <- format_weather_data(path = path_to_weather_data,
weather_file = fileNames[3],
lines_to_skip = 55)
unique(monterey$backup_status)
unique(monterey$Station)
# I use air_obs - one measurement per day
air <- monterey %>% rename(tempC = air_obs) %>%
select(dateR, month, year, tempC) %>% tbl_df() %>%
mutate(dataset = "Air")
dat <- rbind(sst, air)
start_year <- 1922
dat <- dat %>% filter(year > start_year & year < 2016)
start_year <- 1922
dat <- dat %>% filter(year > start_year & year < 2016)
# What are the warmest and coldest months?
dat %>% group_by(dataset, month) %>%
summarise(meanTemp = mean(tempC)) %>% ungroup() %>%
arrange(meanTemp)
# What are the warmest and coldest months?
dat %>% group_by(dataset, month) %>%
summarise(meanTemp = mean(tempC)) %>% ungroup() %>%
arrange(dataset, meanTemp)
# What are the warmest and coldest months?
dat %>% group_by(dataset, month) %>%
summarise(meanTemp = mean(tempC, na.rm = TRUE)) %>% ungroup() %>%
arrange(dataset, meanTemp)
# What are the warmest and coldest months?
dat %>% group_by(dataset, month) %>%
summarise(meanTemp = mean(tempC, na.rm = TRUE)) %>% ungroup() %>%
arrange(dataset, meanTemp) %>% View()
# What are the warmest and coldest months?
dat %>% group_by(dataset, month) %>%
summarise(meanTemp = mean(tempC, na.rm = TRUE)) %>% ungroup() %>%
arrange(dataset, meanTemp) %>% print(1:24)
# What are the warmest and coldest months?
dat %>% group_by(dataset, month) %>%
summarise(meanTemp = mean(tempC, na.rm = TRUE)) %>% ungroup() %>%
arrange(dataset, meanTemp) %>% View()
# I will use the top 25th percentile of summer temps and bottom 25th percentile of winter temps
remove_data = F
summer_annual <- dat %>% group_by(dataset) %>%
do(get_summer_annual_means(., my_quant = 0.75, remove = remove_data)) %>% ungroup()
summer_annual
winter_annual <- dat %>% group_by(dataset) %>%
do(get_winter_annual_means(., my_quant = 0.25, remove = remove_data)) %>% ungroup()
annual_mean <- dat %>% group_by(dataset, year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
summer_annual
annual_df
annual_mean
start_year <- 1922
dat <- dat %>% filter(year > start_year & year < 2016)
# What are the warmest and coldest months?
dat %>% group_by(dataset, month) %>%
summarise(meanTemp = mean(tempC, na.rm = TRUE)) %>% ungroup() %>%
arrange(dataset, meanTemp) %>% View()
# I will use the top 25th percentile of summer temps and bottom 25th percentile of winter temps
remove_data = F
summer_annual <- dat %>% group_by(dataset) %>%
do(get_summer_annual_means(., my_quant = 0.75, remove = remove_data)) %>% ungroup()
winter_annual <- dat %>% group_by(dataset) %>%
do(get_winter_annual_means(., my_quant = 0.25, remove = remove_data)) %>% ungroup()
annual_mean <- dat %>% group_by(dataset, year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup()
## Collate annual data
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
annual_df
View(annual_df)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
annual_df_long
# Plot
annual_df_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm") +
facet_wrap(~ dataset)
# Plot
annual_df_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm", linetype = "dashed") +
facet_wrap(~ dataset)
# Plot
annual_df_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm", linetype = "dashed", color = "black") +
facet_wrap(~ dataset)
# Plot
annual_df_long %>%
ggplot(aes(year, tempC, color = metric, group = metric)) +
geom_line() +
geom_smooth(method = "lm", linetype = "dashed", color = "black") +
facet_wrap(~ dataset)
source("2_summarise_data/summarise_temperature.R")
annual_df_long
##### GET YEARS OF SNAIL SAMPLES #####
head(dat4)
ggsave("figs_ms/plot_temp_timeseries.pdf", height = 3.5, width = 7)
# Plot
annual_df_long %>%
ggplot(aes(year, tempC, color = metric, group = metric)) +
geom_line() +
geom_smooth(method = "lm", linetype = "dashed", color = "black") +
facet_wrap(~ dataset)
ggsave("figs_ms/plot_temp_timeseries.pdf", height = 3.5, width = 7)
# Plot
annual_df_long %>%
ggplot(aes(year, tempC, color = metric, group = metric)) +
geom_line() +
#geom_smooth(method = "lm", linetype = "dashed", color = "black") +
facet_wrap(~ dataset)
ggsave("figs_ms/plot_temp_timeseries.pdf", height = 3.5, width = 7)
# Plot
annual_df_long %>%
ggplot(aes(year, tempC, color = metric, group = metric)) +
geom_line() +
#geom_smooth(method = "lm", linetype = "dashed", color = "black") +
facet_wrap(~ dataset) +
theme(legend.position = "bottom")
ggsave("figs_ms/plot_temp_timeseries.pdf", height = 3.5, width = 7)
