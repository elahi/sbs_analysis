write.csv(gls_time_series_sst, "output/gls_time_series_sst.csv")
air_annual_long <- air_annual_long %>%
mutate(dataset = "Air")
sst_annual_long <- sst_annual_long %>%
mutate(dataset = "Seawater")
### Load limpet hindcasts (15 yrs of modeled body temperatures)
source("05_summarise_limpet_temps.R")
lim_annual_seasons_long2
theme_set(theme_bw(base_size = 12))
# theme_set(theme_bw(base_size = 12) +
#             theme(panel.grid = element_blank()))
### Combine data
temp_records <- rbind(sst_annual_long, air_annual_long)
##### GET YEARS OF SNAIL SAMPLES #####
head(dat4)
spYrs <- dat4 %>% ungroup() %>% select(species, year) %>% distinct() %>%
arrange(species, year) %>%
group_by(species) %>%
mutate(genus = unlist(strsplit(as.character(species), split = " +"))[1]) %>%
ungroup()
spYrs
spYrs$genus <- factor(spYrs$genus, levels = c("Chlorostoma", "Lottia", "Littorina"))
##### TWO-PANEL PLOT #####
sort(unique(lim_annual_seasons_long2$tidalHT))
lim_for_sst <- lim_annual_seasons_long2 %>%
filter(tidalHT == 1.1) %>%
mutate(dataset = "Seawater")
lim_for_air <- lim_annual_seasons_long2 %>%
filter(tidalHT == 7.55) %>%
mutate(dataset = "Air")
text_df <- data.frame(x = c(rep(1940, 3)),
y = c(6.5, 13, 21),
text1 = c("Min", "Median", "Max"),
dataset = rep("Air", 3),
metric = c("minimum", "median", "maximum"))
facet_label_text <- data.frame(x = rep(1938, 2),
y = rep(23.3, 2),
text1 = c("A", "B"),
dataset = c("Air", "Seawater"))
temp_records %>%
ggplot(aes(year, tempC, color = metric)) +
geom_smooth(data = subset(temp_records, dataset == "Seawater" &
metric == "maximum"), method = "lm",
color = "darkgray", linetype = "dashed") +
# geom_smooth(data = subset(temp_records, dataset == "Air" &
#                             metric == "maximum"), method = "lm",
#             color = "darkgray", linetype = "dashed") +
geom_smooth(data = subset(temp_records, dataset == "Air" &
metric == "minimum"), method = "lm",
color = "darkgray", linetype = "dashed") +
geom_line(alpha = 1) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "top") +
guides(color = FALSE) +
guides(shape =
guide_legend(title = "SAMPLING EVENT", title.position = "top",
title.hjust = 0.5,
title.theme =
element_text(size = 10, face = "bold", angle = 0),
direction = "horizontal",
label.theme = element_text(angle = 0, size = 8,
face =  "italic"))) +
facet_wrap(~ dataset) +
theme(strip.background = element_blank()) +
geom_line(data = lim_for_sst,
aes(year, tempC), alpha = 0.25, size = 1.5) +
geom_line(data = lim_for_air,
aes(year, tempC), alpha = 0.25, size = 1.5) +
geom_line(data = lim_for_sst,
aes(year, tempC, group = metric), alpha = 1, size = 0.25, color = "black") +
geom_line(data = lim_for_air,
aes(year, tempC, group = metric), alpha = 1, size = 0.25, color = "black") +
geom_text(aes(x, y, label = text1), data = text_df, size = 3,
hjust = 0, fontface = "bold") +
geom_point(aes(x = year, y = 5, shape = species, color = NULL), data = spYrs,
alpha = 0.6, size = 2) +
geom_text(aes(x, y, label = text1, color = NULL, shape = NULL),
data = facet_label_text, size = 5, hjust = 0.25, vjust = 0.75,
show.legend = FALSE)
ggsave("figs/temp_timeseries.png", height = 4.5, width = 7)
sort(unique(lim_annual_seasons_long2$tidalHT))
lim_for_sst <- lim_annual_seasons_long2 %>%
filter(tidalHT == 1.1) %>%
mutate(dataset = "Seawater")
lim_for_air <- lim_annual_seasons_long2 %>%
filter(tidalHT == 7.55) %>%
mutate(dataset = "Air")
text_df <- data.frame(x = c(rep(1940, 3)),
y = c(6.5, 13, 21),
text1 = c("Min", "Median", "Max"),
dataset = rep("Air", 3),
metric = c("minimum", "median", "maximum"))
facet_label_text <- data.frame(x = rep(1938, 2),
y = rep(23.3, 2),
text1 = c("A", "B"),
dataset = c("Air", "Seawater"))
temp_records %>%
ggplot(aes(year, tempC, color = metric)) +
geom_smooth(data = subset(temp_records, dataset == "Seawater" &
metric == "maximum"), method = "lm",
color = "darkgray", linetype = "dashed") +
# geom_smooth(data = subset(temp_records, dataset == "Air" &
#                             metric == "maximum"), method = "lm",
#             color = "darkgray", linetype = "dashed") +
geom_smooth(data = subset(temp_records, dataset == "Air" &
metric == "minimum"), method = "lm",
color = "darkgray", linetype = "dashed") +
geom_line(alpha = 1) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Year") +
theme(legend.title = element_blank()) +
theme(legend.position = "top") +
guides(color = FALSE) +
guides(shape =
guide_legend(title = "SAMPLING EVENT", title.position = "top",
title.hjust = 0.5,
title.theme =
element_text(size = 10, face = "bold", angle = 0),
direction = "horizontal",
label.theme = element_text(angle = 0, size = 8,
face =  "italic"))) +
facet_wrap(~ dataset) +
theme(strip.background = element_blank()) +
geom_text(aes(x, y, label = text1), data = text_df, size = 3,
hjust = 0, fontface = "bold")
ggsave("figs/temp_timeseries_ppt.png", height = 3.5, width = 7)
wM
tail(wM)
historic <- wM %>% filter(year < 1960)
unique(historic$year)
historic <- wM %>% filter(year < 1961)
unique(historic$year)
modern <- wM %>% filter(year < 2000) # 2001 - 2010
unique(modern$year)
modern <- wM %>% filter(year > 2000) # 2001 - 2010
unique(modern$year)
historic <- wM %>% filter(year < 1961) %>%
mutate(era = "past") # 1951 - 1960
modern <- wM %>% filter(year > 2000) %>%
mutate(era = "present") # 2001 - 2010
decade1 <- rbind(historic, modern)
decade1
head(weather)
weather
weather2 <- weather %>%
mutate(era = ifelse(year < 1961, "past",
ifelse(year > 2000, "present", "between")))
weather2
weather2 %>% group_by(era) %>% tally()
weather2 <- weather %>%
mutate(era = ifelse(year < 1961, "past",
ifelse(year > 2000, "present", "between"))) %>%
filter(era != "between")
weather2
decade_max <- weather2 %>% group_by(month) %>%
summarise(mean = mean(air_max, na.rm = TRUE))
decade_max
decade_max <- weather2 %>% group_by(era, month) %>%
summarise(mean = mean(air_max, na.rm = TRUE))
decade_max
decade_max %>%
ggplot(aes(month, mean, color = era)) %>%
geom_line()
decade_max %>%
ggplot(aes(month, mean, color = era)) +
geom_line()
decade_max <- weather2 %>% group_by(era, month) %>%
summarise(mean = mean(air_max, na.rm = TRUE),
sd = sd(air_max, na.rm = TRUE),
upper = mean + sd,
lower = mean - sd)
decade_max
decade_max <- weather2 %>% group_by(era, month) %>%
summarise(mean = mean(air_max, na.rm = TRUE),
sd = sd(air_max, na.rm = TRUE),
n = n(),
se = size_sd/sqrt(n),
CI = qt(0.975, df = n - 1) * se,
upper = mean + CI,
lower = mean - CI)
decade_max <- weather2 %>% group_by(era, month) %>%
summarise(mean = mean(air_max, na.rm = TRUE),
sd = sd(air_max, na.rm = TRUE),
n = n(),
se = sd/sqrt(n),
CI = qt(0.975, df = n - 1) * se,
upper = mean + CI,
lower = mean - CI)
decade_max
decade_max
decade_max_long <- decade_max %>%
select(era, month, mean, upper, lower) %>%
gather(key = metric, value = tempC, mean:lower)
decade_max_long
decade_max_long %>%
ggplot(aes(month, tempC, color = era, linetype = metric)) +
geom_line()
decade_max_long <- decade_max %>%
select(era, month, mean, upper, lower) %>%
gather(key = metric, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(metric == "mean", "solid", "dashed"))
decade_max_long %>%
ggplot(aes(month, tempC, color = era, group = metric)) +
geom_line(linetype = line_type)
decade_max_long
decade_max_long %>%
ggplot(aes(month, tempC, group = interaction(era, metric))) +
geom_line()
decade_max_long %>%
ggplot(aes(month, tempC, group = interaction(era, metric))) +
geom_line(aes(linetype = line_type))
decade_max_long %>%
ggplot(aes(month, tempC, group = interaction(era, metric))) +
geom_line(aes(linetype = line_type, color = era))
decade_max_long
decade_max_long <- decade_max %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(metric == "mean", "solid", "dashed"),
metric = "air_max")
decade_max_long %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era))
decade_max_long <- decade_max %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(metric == "mean", "solid", "dashed"),
metric = "air_max")
decade_max_long %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era))
decade_max_long <- decade_max %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(summary_stat == "mean", "solid", "dashed"),
metric = "air_max")
decade_max_long %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era))
decade_min <- weather2 %>% group_by(era, month) %>%
summarise(mean = mean(air_min, na.rm = TRUE),
sd = sd(air_min, na.rm = TRUE),
n = n(),
se = sd/sqrt(n),
CI = qt(0.975, df = n - 1) * se,
upper = mean + CI,
lower = mean - CI)
decade_min_long <- decade_min %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(summary_stat == "mean", "solid", "dashed"),
metric = "air_min")
decade_obs_long <- decade_obs %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(summary_stat == "mean", "solid", "dashed"),
metric = "air_obs")
weather2 <- weather %>%
mutate(era = ifelse(year < 1961, "past",
ifelse(year > 2000, "present", "between"))) %>%
filter(era != "between")
decade_max <- weather2 %>% group_by(era, month) %>%
summarise(mean = mean(air_max, na.rm = TRUE),
sd = sd(air_max, na.rm = TRUE),
n = n(),
se = sd/sqrt(n),
CI = qt(0.975, df = n - 1) * se,
upper = mean + CI,
lower = mean - CI)
decade_max_long <- decade_max %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(summary_stat == "mean", "solid", "dashed"),
metric = "maximum")
decade_min <- weather2 %>% group_by(era, month) %>%
summarise(mean = mean(air_min, na.rm = TRUE),
sd = sd(air_min, na.rm = TRUE),
n = n(),
se = sd/sqrt(n),
CI = qt(0.975, df = n - 1) * se,
upper = mean + CI,
lower = mean - CI)
decade_min_long <- decade_min %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(summary_stat == "mean", "solid", "dashed"),
metric = "minimum")
decade_obs <- weather2 %>% group_by(era, month) %>%
summarise(mean = mean(air_obs, na.rm = TRUE),
sd = sd(air_obs, na.rm = TRUE),
n = n(),
se = sd/sqrt(n),
CI = qt(0.975, df = n - 1) * se,
upper = mean + CI,
lower = mean - CI)
decade_obs_long <- decade_obs %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(summary_stat == "mean", "solid", "dashed"),
metric = "median")
decade_dat <- rbind(decade_max_long, decade_min_long, decade_obs_long)
decade_dat
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era)) +
facet_wrap(~ metric, nrow = 3)
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era)) +
facet_wrap(~ metric, ncol = 3)
decade_obs_long <- decade_obs %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(summary_stat == "mean", "average", "ci"),
metric = "median")
decade_max_long <- decade_max %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(summary_stat == "mean", "average", "ci"),
metric = "maximum")
decade_min <- weather2 %>% group_by(era, month) %>%
summarise(mean = mean(air_min, na.rm = TRUE),
sd = sd(air_min, na.rm = TRUE),
n = n(),
se = sd/sqrt(n),
CI = qt(0.975, df = n - 1) * se,
upper = mean + CI,
lower = mean - CI)
decade_min_long <- decade_min %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(summary_stat == "mean", "average", "ci"),
metric = "minimum")
decade_obs <- weather2 %>% group_by(era, month) %>%
summarise(mean = mean(air_obs, na.rm = TRUE),
sd = sd(air_obs, na.rm = TRUE),
n = n(),
se = sd/sqrt(n),
CI = qt(0.975, df = n - 1) * se,
upper = mean + CI,
lower = mean - CI)
decade_obs_long <- decade_obs %>%
select(era, month, mean, upper, lower) %>%
gather(key = summary_stat, value = tempC, mean:lower) %>%
mutate(line_type = ifelse(summary_stat == "mean", "average", "ci"),
metric = "median")
decade_dat <- rbind(decade_max_long, decade_min_long, decade_obs_long)
decade_dat
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era)) +
facet_wrap(~ metric, ncol = 3)
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
facet_wrap(~ metric, ncol = 3)
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era)) +
facet_wrap(~ metric, ncol = 3)
?scale_color_manual
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era)) +
facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("black", "darkgray"))
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era)) +
facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black"))
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black"))
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(1, 2))
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(1, 0.5))
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(0.8, 0.4))
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(1, 0.5))
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(1, 0.5)) +
theme(strip.background = element_blank())
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat, metric))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
#facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(1, 0.5)) +
theme(strip.background = element_blank())
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(1, 0.5)) +
theme(strip.background = element_blank())
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat, metric))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
#facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(1, 0.5)) +
theme(strip.background = element_blank()) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Month")
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat, metric))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
#facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(1, 0.5)) +
theme(strip.background = element_blank()) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Month") +
ggtitle("Air") +
scale_x_continuous(breaks = seq(1, 12, 1))
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat, metric))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
#facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(1, 0.5)) +
theme(strip.background = element_blank()) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Month") +
ggtitle("Air") +
scale_x_continuous(breaks = seq(1, 12, 1)) +
guides(linetype = FALSE)
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat, metric))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
#facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(1, 0.5)) +
theme(strip.background = element_blank()) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Month") +
ggtitle("Air") +
scale_x_continuous(breaks = seq(1, 12, 1)) +
guides(linetype = FALSE, size = FALSE)
ggsave("figs/seasonal_era_temp_air.png", height = 3.5, width = 3.5)
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat, metric))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
#facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(1, 0.5)) +
theme(strip.background = element_blank()) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Month") +
ggtitle("Air") +
scale_x_continuous(breaks = seq(1, 12, 1)) +
guides(linetype = FALSE, size = FALSE) +
theme(legend.position = "top") +
theme(legend.title = element_blank())
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat, metric))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
#facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(1, 0.5)) +
theme(strip.background = element_blank()) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Month") +
ggtitle("Air") +
scale_x_continuous(breaks = seq(1, 12, 1)) +
guides(linetype = FALSE, size = FALSE) +
theme(legend.position = c(0, 1), legend.justification = c(0, 1)) +
theme(legend.title = element_blank())
ggsave("figs/seasonal_era_temp_air.png", height = 3.5, width = 3.5)
decade_dat %>%
ggplot(aes(month, tempC, group = interaction(era, summary_stat, metric))) +
geom_line(aes(linetype = line_type, color = era, size = line_type)) +
#facet_wrap(~ metric, ncol = 3) +
scale_color_manual(values = c("darkgray", "black")) +
scale_size_manual(values = c(0.75, 0.25)) +
theme(strip.background = element_blank()) +
ylab(expression(paste("Temperature (", degree, "C)"))) +
xlab("Month") +
ggtitle("Air") +
scale_x_continuous(breaks = seq(1, 12, 1)) +
guides(linetype = FALSE, size = FALSE) +
theme(legend.position = c(0, 1), legend.justification = c(0, 1)) +
theme(legend.title = element_blank())
ggsave("figs/seasonal_era_temp_air.png", height = 3.5, width = 3.5)
