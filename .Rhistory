gt <- ggplot_gtable(ggplot_build(p))
gt$layout$clip[gt$layout$name == "panel"] <- "off"
grid.draw(gt)
ggsave("sbs_meta/meta_figs/meta_lrr.pdf", height = 5, width = 7)
datM
View(datM)
spp_df
datM <- dat2 %>%
gather(key = temp, value = value, starts_with("size")) %>%
unite(col = temp1, era, temp, sep = "_") %>%
spread(temp1, value) %>%
arrange(desc(latitude))
datM
View(datM)
datM <- dat2 %>%
gather(key = temp, value = value, starts_with("size")) %>%
unite(col = temp1, era, temp, sep = "_") %>%
spread(temp1, value) %>%
arrange(desc(latitude))
datM
## Try metafor
library(metafor)
names(datM)
names(datM) <- c("study","species", "museum", "latitude", "sd2i", "n2i", "m2i", "sd1i", "n1i", "m1i")
datM
### calculate log ratio of means and corresponding sampling variances
datM <- escalc(measure = "ROM", m1i = m1i, sd1i = sd1i, n1i = n1i,
m2i = m2i, sd2i = sd2i, n2i = n2i, data = datM)
datM
### Get standard error (following Vuorre)
datM <- datM %>%
mutate(sei = as.numeric(sqrt(vi)),
upper = yi + 2*sei,
lower = yi - 2*sei)
### Re-order by latitude
datM <- datM %>%
mutate(species = reorder(species, latitude))
### Plot this
my_dodge <- 0.5
datM
### Plot this
my_dodge <- 0.5
spp_df <- datM %>% distinct(species, study)
spp_df
spp_df <- spp_df %>%
mutate(my_text = c(rep("Central California", 3),
seq(1:14)))
glimpse(spp_df)
p <- datM %>%
ggplot(aes(species, yi, fill = study, shape = museum)) +
geom_point(position = position_dodge(my_dodge), size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper),
position = position_dodge(my_dodge),
width = 0) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
labs(y = "Proportional change in body size",
x = "") +
scale_shape_manual(values = c(21, 22)) +
geom_text(data = spp_df, aes(label = my_text, y = Inf, x = species),
inherit.aes = FALSE, hjust = -1) +
theme(legend.position = "none")
p
datM
p <- datM %>%
ggplot(aes(species, yi, fill = study, shape = museum)) +
geom_point(position = position_dodge(my_dodge), size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper),
position = position_dodge(my_dodge),
width = 0) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
labs(y = "Proportional change in body size",
x = "") +
scale_shape_manual(values = c(21, 22)) +
geom_text(data = spp_df, aes(label = my_text, y = Inf, x = species),
inherit.aes = FALSE, hjust = -1) +
theme(legend.position = "none") +
theme(axis.text.y = element_text(face = "italic"))
p
?scale_x_discrete
p <- datM %>%
ggplot(aes(species, yi, fill = study, shape = museum)) +
geom_point(position = position_dodge(my_dodge), size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper),
position = position_dodge(my_dodge),
width = 0) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
labs(y = "Proportional change in body size",
x = "") +
scale_shape_manual(values = c(21, 22)) +
geom_text(data = spp_df, aes(label = my_text, y = Inf, x = species),
inherit.aes = FALSE, hjust = -1) +
theme(legend.position = "none") +
theme(axis.text.y = element_text(face = "italic")) +
scale_x_discrete("species", labels = expression(Quebec, italic(Mississippi)))
p
p
### New species column
datM$species
### New species column
datM %>% select(species)
### New species column
datM %>% select(species, study)
datM <- datM %>%
mutate(species2 = ifelse(species == "Wilson-Brodie 2017",
paste(species, "(UK)", sep = " ")))
datM <- datM %>%
mutate(species2 = ifelse(species == "Wilson-Brodie 2017",
paste(species, "(UK)", species, sep = " ")))
datM <- datM %>%
mutate(species2 = ifelse(species == "Wilson-Brodie 2017",
paste(species, "(UK)", sep = " "), species))
### New species column
datM %>% select(species, study)
datM %>% select(species, species2, study)
datM <- dat2 %>%
gather(key = temp, value = value, starts_with("size")) %>%
unite(col = temp1, era, temp, sep = "_") %>%
spread(temp1, value) %>%
arrange(desc(latitude))
datM
### New species column
datM %>% select(species, study)
datM <- datM %>%
mutate(species2 = ifelse(species == "Wilson-Brodie 2017",
paste(species, "(UK)", sep = " "), species))
datM %>% select(species, species2, study)
datM <- datM %>%
mutate(species2 = ifelse(species == "Wilson-Brodie 2017",
paste(species, "(UK)", sep = " "), species))
datM %>% select(species, species2, study)
datM <- datM %>%
mutate(species2 = ifelse(species == "Wilson-Brodie 2017", "a", species))
datM %>% select(species, species2, study)
datM <- datM %>%
mutate(species2 = ifelse(study == "Wilson-Brodie 2017", "a", species))
datM %>% select(species, species2, study)
datM <- datM %>%
mutate(species2 = ifelse(study == "Wilson-Brodie 2017",
paste(species, "(UK)", sep = " "), species))
datM %>% select(species, species2, study)
### Re-order by latitude
datM <- datM %>%
mutate(species2 = reorder(species, latitude))
## Try metafor
library(metafor)
names(datM)
names(datM) <- c("study","species", "museum", "latitude", "sd2i", "n2i", "m2i", "sd1i", "n1i", "m1i")
datM
### calculate log ratio of means and corresponding sampling variances
datM <- escalc(measure = "ROM", m1i = m1i, sd1i = sd1i, n1i = n1i,
m2i = m2i, sd2i = sd2i, n2i = n2i, data = datM)
datM
### Get standard error (following Vuorre)
datM <- datM %>%
mutate(sei = as.numeric(sqrt(vi)),
upper = yi + 2*sei,
lower = yi - 2*sei)
### Plot this
my_dodge <- 0
p <- datM %>%
ggplot(aes(species2, yi, fill = study, shape = museum)) +
geom_point(position = position_dodge(my_dodge), size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper),
position = position_dodge(my_dodge),
width = 0) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
labs(y = "Proportional change in body size",
x = "") +
scale_shape_manual(values = c(21, 22)) +
geom_text(data = spp_df, aes(label = my_text, y = Inf, x = species2),
inherit.aes = FALSE, hjust = -1) +
theme(legend.position = "none") +
theme(axis.text.y = element_text(face = "italic"))
p
spp_df <- datM %>% distinct(species2, study)
spp_df
spp_df <- spp_df %>%
mutate(my_text = c(rep("Central California", 3),
seq(1:14)))
spp_df <- spp_df %>%
mutate(my_text = c(rep("Central California", 3),
seq(1:15)))
spp_df <- spp_df %>%
mutate(my_text = c(rep("Central California", 3),
seq(1:13)))
spp_df <- datM %>% distinct(species2, study)
spp_df
p <- datM %>%
ggplot(aes(species2, yi, fill = study, shape = museum)) +
geom_point(position = position_dodge(my_dodge), size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper),
position = position_dodge(my_dodge),
width = 0) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
labs(y = "Proportional change in body size",
x = "") +
scale_shape_manual(values = c(21, 22)) +
theme(legend.position = "none") +
theme(axis.text.y = element_text(face = "italic"))
p
datM
## Compile
dat <- rbind(elahi, gall_frank, gall_tren, hay_king, fisher, wilson, roy_present, roy_presentCNM)
### Add UK to lapillus
dat <- dat %>%
mutate(species2 = ifelse(study == "Wilson-Brodie 2017",
paste(species, "(UK)", sep = " "), species))
View(dat)
## For metafor, I want the data in wide format
names(dat)
dat2 <- dat %>%
select(study, species, species2, museum, latitude, era, size_rep, size_error, sample_size) %>%
rename(size_n = sample_size)
dat2
datM <- dat2 %>%
gather(key = temp, value = value, starts_with("size")) %>%
unite(col = temp1, era, temp, sep = "_") %>%
spread(temp1, value) %>%
arrange(desc(latitude))
datM
datM
### Re-order by latitude
datM <- datM %>%
mutate(species2 = reorder(species, latitude))
## Try metafor
library(metafor)
names(datM)
names(datM) <- c("study", "species", "species2", "museum", "latitude",
"sd2i", "n2i", "m2i", "sd1i", "n1i", "m1i")
datM
### calculate log ratio of means and corresponding sampling variances
datM <- escalc(measure = "ROM", m1i = m1i, sd1i = sd1i, n1i = n1i,
m2i = m2i, sd2i = sd2i, n2i = n2i, data = datM)
datM
### Get standard error (following Vuorre)
datM <- datM %>%
mutate(sei = as.numeric(sqrt(vi)),
upper = yi + 2*sei,
lower = yi - 2*sei)
### Plot this
my_dodge <- 0
spp_df <- datM %>% distinct(species2, study)
spp_df
spp_df <- spp_df %>%
mutate(my_text = c(rep("Central California", 3),
seq(1:13)))
glimpse(spp_df)
p <- datM %>%
ggplot(aes(species2, yi, fill = study, shape = museum)) +
geom_point(position = position_dodge(my_dodge), size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper),
position = position_dodge(my_dodge),
width = 0) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
labs(y = "Proportional change in body size",
x = "") +
scale_shape_manual(values = c(21, 22)) +
theme(legend.position = "none") +
theme(axis.text.y = element_text(face = "italic"))
p
datM
datM <- dat2 %>%
gather(key = temp, value = value, starts_with("size")) %>%
unite(col = temp1, era, temp, sep = "_") %>%
spread(temp1, value) %>%
arrange(desc(latitude))
datM
### Re-order by latitude
datM <- datM %>%
mutate(species2 = reorder(species2, latitude))
## Try metafor
library(metafor)
names(datM)
names(datM) <- c("study", "species", "species2", "museum", "latitude",
"sd2i", "n2i", "m2i", "sd1i", "n1i", "m1i")
datM
### calculate log ratio of means and corresponding sampling variances
datM <- escalc(measure = "ROM", m1i = m1i, sd1i = sd1i, n1i = n1i,
m2i = m2i, sd2i = sd2i, n2i = n2i, data = datM)
datM
### Get standard error (following Vuorre)
datM <- datM %>%
mutate(sei = as.numeric(sqrt(vi)),
upper = yi + 2*sei,
lower = yi - 2*sei)
### Plot this
my_dodge <- 0
spp_df <- datM %>% distinct(species2, study)
spp_df
spp_df <- spp_df %>%
mutate(my_text = c(rep("Central California", 3),
seq(1:13)))
glimpse(spp_df)
p <- datM %>%
ggplot(aes(species2, yi, fill = study, shape = museum)) +
geom_point(position = position_dodge(my_dodge), size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper),
position = position_dodge(my_dodge),
width = 0) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
labs(y = "Proportional change in body size",
x = "") +
scale_shape_manual(values = c(21, 22)) +
theme(legend.position = "none") +
theme(axis.text.y = element_text(face = "italic"))
p
ggsave("sbs_meta/meta_figs/meta_lrr.pdf", height = 5, width = 7)
### Add UK to lapillus
dat <- dat %>%
mutate(species2 = ifelse(study == "Wilson-Brodie 2017",
paste(species, "(UK)", sep = " "), species),
species2 = ifelse(study == "Galloway-Frank_2017",
paste(species, "(OR)", sep = " "), species))
## Compile
dat <- rbind(elahi, gall_frank, gall_tren, hay_king, fisher, wilson, roy_present, roy_presentCNM)
### Add UK to lapillus
dat <- dat %>%
mutate(species2 = ifelse(study == "Wilson-Brodie 2017",
paste(species, "(UK)", sep = " "), species),
species2 = ifelse(study == "Galloway-Frank_2017",
paste(species, "(OR)", sep = " "), species))
## For metafor, I want the data in wide format
names(dat)
dat2 <- dat %>%
select(study, species, species2, museum, latitude, era, size_rep, size_error, sample_size) %>%
rename(size_n = sample_size)
dat2
datM <- dat2 %>%
gather(key = temp, value = value, starts_with("size")) %>%
unite(col = temp1, era, temp, sep = "_") %>%
spread(temp1, value) %>%
arrange(desc(latitude))
datM
### Re-order by latitude
datM <- datM %>%
mutate(species2 = reorder(species2, latitude))
## Try metafor
library(metafor)
names(datM)
names(datM) <- c("study", "species", "species2", "museum", "latitude",
"sd2i", "n2i", "m2i", "sd1i", "n1i", "m1i")
datM
### calculate log ratio of means and corresponding sampling variances
datM <- escalc(measure = "ROM", m1i = m1i, sd1i = sd1i, n1i = n1i,
m2i = m2i, sd2i = sd2i, n2i = n2i, data = datM)
datM
### Get standard error (following Vuorre)
datM <- datM %>%
mutate(sei = as.numeric(sqrt(vi)),
upper = yi + 2*sei,
lower = yi - 2*sei)
### Plot this
my_dodge <- 0
spp_df <- datM %>% distinct(species2, study)
spp_df
spp_df <- spp_df %>%
mutate(my_text = c(rep("Central California", 3),
seq(1:13)))
glimpse(spp_df)
p <- datM %>%
ggplot(aes(species2, yi, fill = study, shape = museum)) +
geom_point(position = position_dodge(my_dodge), size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper),
position = position_dodge(my_dodge),
width = 0) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
labs(y = "Proportional change in body size",
x = "") +
scale_shape_manual(values = c(21, 22)) +
theme(legend.position = "none") +
theme(axis.text.y = element_text(face = "italic"))
p
## Compile
dat <- rbind(elahi, gall_frank, gall_tren, hay_king, fisher, wilson, roy_present, roy_presentCNM)
### Add UK to lapillus
dat <- dat %>%
mutate(species2 = ifelse(study == "Wilson-Brodie 2017",
paste(species, "(UK)", sep = " "), species),
species2 = ifelse(study == "Galloway-Frank_2017",
paste(species, "(OR)", sep = " "), species2))
## For metafor, I want the data in wide format
names(dat)
dat2 <- dat %>%
select(study, species, species2, museum, latitude, era, size_rep, size_error, sample_size) %>%
rename(size_n = sample_size)
dat2
datM <- dat2 %>%
gather(key = temp, value = value, starts_with("size")) %>%
unite(col = temp1, era, temp, sep = "_") %>%
spread(temp1, value) %>%
arrange(desc(latitude))
datM
### Re-order by latitude
datM <- datM %>%
mutate(species2 = reorder(species2, latitude))
## Try metafor
library(metafor)
names(datM)
names(datM) <- c("study", "species", "species2", "museum", "latitude",
"sd2i", "n2i", "m2i", "sd1i", "n1i", "m1i")
datM
### calculate log ratio of means and corresponding sampling variances
datM <- escalc(measure = "ROM", m1i = m1i, sd1i = sd1i, n1i = n1i,
m2i = m2i, sd2i = sd2i, n2i = n2i, data = datM)
datM
### Get standard error (following Vuorre)
datM <- datM %>%
mutate(sei = as.numeric(sqrt(vi)),
upper = yi + 2*sei,
lower = yi - 2*sei)
### Plot this
my_dodge <- 0
spp_df <- datM %>% distinct(species2, study)
spp_df
spp_df <- spp_df %>%
mutate(my_text = c(rep("Central California", 3),
seq(1:13)))
glimpse(spp_df)
p <- datM %>%
ggplot(aes(species2, yi, fill = study, shape = museum)) +
geom_point(position = position_dodge(my_dodge), size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper),
position = position_dodge(my_dodge),
width = 0) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
labs(y = "Proportional change in body size",
x = "") +
scale_shape_manual(values = c(21, 22)) +
theme(legend.position = "none") +
theme(axis.text.y = element_text(face = "italic"))
p
my_axis_labels <- paste(datM$species)
my_axis_labels
p <- datM %>%
ggplot(aes(species2, yi, fill = study, shape = museum)) +
geom_point(position = position_dodge(my_dodge), size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper),
position = position_dodge(my_dodge),
width = 0) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
labs(y = "Proportional change in body size",
x = "") +
scale_shape_manual(values = c(21, 22)) +
theme(legend.position = "none") +
theme(axis.text.y = element_text(face = "italic")) +
scale_x_discrete("", position = my_axis_labels)
?scale_x_discrete
p <- datM %>%
ggplot(aes(species2, yi, fill = study, shape = museum)) +
geom_point(position = position_dodge(my_dodge), size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper),
position = position_dodge(my_dodge),
width = 0) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
labs(y = "Proportional change in body size",
x = "") +
scale_shape_manual(values = c(21, 22)) +
theme(legend.position = "none") +
theme(axis.text.y = element_text(face = "italic")) +
scale_x_discrete("", labels = my_axis_labels)
p
p <- datM %>%
ggplot(aes(species2, yi, fill = study, shape = museum)) +
geom_point(position = position_dodge(my_dodge), size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper),
position = position_dodge(my_dodge),
width = 0) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
labs(y = "Proportional change in body size",
x = "") +
scale_shape_manual(values = c(21, 22)) +
theme(legend.position = "none") +
theme(axis.text.y = element_text(face = "italic")) +
scale_x_discrete("", labels = rev(my_axis_labels))
p
my_axis_labels
my_axis_labels <- paste(datM$species)
my_axis_labels
rev(my_axis_labels)
p <- datM %>%
ggplot(aes(species2, yi, fill = study, shape = museum)) +
geom_point(position = position_dodge(my_dodge), size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper),
position = position_dodge(my_dodge),
width = 0) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
labs(y = "Proportional change in body size",
x = "") +
scale_shape_manual(values = c(21, 22)) +
theme(legend.position = "none") +
#scale_x_discrete("", labels = rev(my_axis_labels)) +
theme(axis.text.y = element_text(face = "italic"))
p
ggsave("sbs_meta/meta_figs/meta_lrr.pdf", height = 5, width = 7)
### meta-analysis of log ratio of means using a random-effects model
res <- rma(yi, vi, method = "DL", data = datM)
res
forest(res)
ggsave("sbs_meta/meta_figs/meta_lrr.pdf", height = 5, width = 7)
