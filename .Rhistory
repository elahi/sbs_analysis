# Create new column called 'sampleArea' based on
dat$sampleArea <- as.factor(ifelse(dat$sp == "CHFU",
paste(dat$site),
paste(dat$site, dat$nest1, sep = "_")))
##### SIMPLIFY DATAFRAME #####
names(dat)
head(dat)
unique(dat$sampleUnit)
unique(dat$site)
unique(dat$sampleArea)
dat <- dat %>%
select(-c(lat, long)) %>% rename(lat = lat2, long = long2)
rm(list=ls(all=TRUE))
##### LOAD PACKAGES, DATA #####
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
library(lubridate)
# load cleaned up data
source("sbs_size_dataPrep2.R")
head(dat)
dat2 <- dat %>%
group_by(species:era, sampleArea) %>%
summarise(size_mean = mean(size1mm, na.rm = TRUE),
size_sd = sd(size1mm, na.rm = TRUE),
size_n = n(),
size_se = size_sd/sqrt(size_n))
dat2 <- dat %>%
group_by(species, sampleArea) %>%
summarise(size_mean = mean(size1mm, na.rm = TRUE),
size_sd = sd(size1mm, na.rm = TRUE),
size_n = n(),
size_se = size_sd/sqrt(size_n))
View(dat2)
dat2 <- dat %>%
group_by(species, era, sampleArea) %>%
summarise(size_mean = mean(size1mm, na.rm = TRUE),
size_sd = sd(size1mm, na.rm = TRUE),
size_n = n(),
size_se = size_sd/sqrt(size_n))
View(dat2)
dat2 <- dat %>%
group_by(species, era, sampleArea) %>%
summarise(size_mean = mean(size1mm, na.rm = TRUE),
size_sd = sd(size1mm, na.rm = TRUE),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se)
dat2
View(dat2)
library(MASS)
survey
head(survey)
survey %>%
summarise(size_mean = mean(Height, na.rm = TRUE),
size_sd = sd(Height, na.rm = TRUE),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se)
dim(survey)
summary(survey)
dplyr::n
survey %>%
summarise(size_mean = mean(Height, na.rm = TRUE),
size_sd = sd(Height, na.rm = TRUE),
size_n = n(na.rm = TRUE),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se)
summary(dat)
dat %>% filter(na.omit())
dat2 <- dat %>% filter(na.omit(size1mm))
dat2 <- dat %>% filter(!is.na(size1mm))
survey %>% filter(!is.na(Height))
summarise(size_mean = mean(Height, na.rm = TRUE),
size_sd = sd(Height, na.rm = TRUE),
size_n = n(na.rm = TRUE),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se)
survey %>% filter(!is.na(Height))
summarise(size_mean = mean(Height, na.rm = TRUE),
size_sd = sd(Height, na.rm = TRUE),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se)
survey %>% filter(!is.na(Height)) %>%
summarise(size_mean = mean(Height, na.rm = TRUE),
size_sd = sd(Height, na.rm = TRUE),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se)
dat2 <- dat %>% filter(!is.na(size1mm)) %>%
group_by(species, era, sampleArea) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se)
dat2
View(dat2)
library(dplyr)
summary(dat)
dat2 <- dat %>% filter(!is.na(size1mm)) %>%
group_by(species, era, sampleArea) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se)
dat2
dat2 <- dat %>% filter(!is.na(size1mm)) %>%
group_by(species, era, sampleArea) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se) %>%
ungroup()
like_sampling <- c(1947,  2014, 2014-1947)
lodi_sampling <- c(1950,  2015, 2015-1950)
chfu_sampling <- c(1963,  2014, 2014-1963)
samplingDF <- data.frame(like_sampling, lodi_sampling, chfu_sampling)
samplingDF
summary(dat)
dat2 <- dat %>% filter(!is.na(size1mm)) %>%
group_by(species, code, era, sampleArea) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se) %>%
ungroup()
dat2
head(dat)
dat2 <- dat %>% filter(!is.na(size1mm)) %>%
group_by(species, sp, era, sampleArea) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se) %>%
ungroup()
dat2
head(dat)
dat <- dat %>%
select(-c(lat, long)) %>% rename(lat = lat2, long = long2) %>%
mutate(year = lubridate::year(date))
##### LOAD PACKAGES, DATA #####
library(dplyr)
library(tidyr)
library(readr)
library(lubridate)
# load modern data
dat <- read.csv("./output/sbsMaster.csv", na.strings = "NA",
stringsAsFactors = FALSE) %>%
select(-c(X, row))
##### PREPARE DATA #####
# change ft to meters
dat$tideHTm <- dat$tideHTm/3.28084
# create numeric lat-long columns
dat$lat2 <- as.numeric(substr(dat$lat, 1, 8))
dat$long2 <- as.numeric(paste("-", substr(dat$long, 1, 9), sep = ""))
dat$LL <- with(dat, paste(lat2, long2, sep = ","))
##### DEFINE SAMPLING AREAS #####
### Need to define 'sampling areas' for each species,
### that were sampled in historic and modern studies
# Littorina keenae = nest1 (zoneA, zoneB, zoneC, zoneD)
dat %>% filter(sp == "LIKE") %>% distinct(nest1)
# Lottia digitalis = site (areaA, areaB, areaC) and nest1 (zone1, zone2, zone3)
dat %>% filter(sp == "LODI") %>% distinct(site, nest1)
# Chlorostoma funebralis = site (Wara.B, Wara.D)
dat %>% filter(sp == "CHFU") %>% distinct(site)
# Create new column called 'sampleArea' based on
# the areas that were resampled in modern surveys
unique(dat$site)
unique(dat$nest1)
dat$sampleArea <- as.factor(ifelse(dat$sp == "CHFU",
paste(dat$site),
paste(dat$site, dat$nest1, sep = "_")))
dat2 <- dat %>%
select(-c(lat, long)) %>% rename(lat = lat2, long = long2) %>%
mutate(year = lubridate::year(date))
dat
head(dat)
dat <- read.csv("./output/sbsMaster.csv", na.strings = "NA",
stringsAsFactors = FALSE) %>%
select(-c(X, row))
dat <- read.csv("./output/sbsMaster.csv", na.strings = "NA",
stringsAsFactors = FALSE)
detach("package:MASS", unload = TRUE)
dat <- read.csv("./output/sbsMaster.csv", na.strings = "NA",
stringsAsFactors = FALSE) %>%
select(-c(X, row))
# change ft to meters
dat$tideHTm <- dat$tideHTm/3.28084
# create numeric lat-long columns
dat$lat2 <- as.numeric(substr(dat$lat, 1, 8))
dat$long2 <- as.numeric(paste("-", substr(dat$long, 1, 9), sep = ""))
dat$LL <- with(dat, paste(lat2, long2, sep = ","))
##### DEFINE SAMPLING AREAS #####
### Need to define 'sampling areas' for each species,
### that were sampled in historic and modern studies
# Littorina keenae = nest1 (zoneA, zoneB, zoneC, zoneD)
dat %>% filter(sp == "LIKE") %>% distinct(nest1)
# Lottia digitalis = site (areaA, areaB, areaC) and nest1 (zone1, zone2, zone3)
dat %>% filter(sp == "LODI") %>% distinct(site, nest1)
# Chlorostoma funebralis = site (Wara.B, Wara.D)
dat %>% filter(sp == "CHFU") %>% distinct(site)
# Create new column called 'sampleArea' based on
# the areas that were resampled in modern surveys
unique(dat$site)
unique(dat$nest1)
dat$sampleArea <- as.factor(ifelse(dat$sp == "CHFU",
paste(dat$site),
paste(dat$site, dat$nest1, sep = "_")))
##### SIMPLIFY DATAFRAME #####
dat2 <- dat %>%
select(-c(lat, long)) %>%
rename(lat = lat2, long = long2) %>%
mutate(year = lubridate::year(date))
head(dat2)
dat2 <- dat %>%
select(-c(lat, long)) %>%
rename(lat = lat2, long = long2) %>%
mutate(year = lubridate::year(dmy(date)))
head(dat2)
head(dat2)
unique(dat2$year)
head(dat2)
summary(dat2)
datMeans <- dat2 %>% filter(!is.na(size1mm)) %>%
group_by(species, sp, era, year, sampleArea) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se) %>%
ungroup()
datMeans
View(datMeans)
names(dat2)
datMeans <- dat2 %>% filter(!is.na(size1mm)) %>%
group_by(species, sp, site, era, year, sampleArea) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se) %>%
ungroup()
datMeans <- dat2 %>% filter(!is.na(size1mm)) %>%
group_by(species, sp, site, era, year, tideHTm, sampleArea) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se) %>%
ungroup()
datMeans <- dat2 %>% filter(!is.na(size1mm)) %>%
group_by(species, sp, site, era, year, sampleArea) %>%
summarise(size_mean = mean(size1mm),
size_sd = sd(size1mm),
size_n = n(),
size_se = size_sd/sqrt(size_n),
size_CI = qt(0.975, df = size_n - 1) * size_se) %>%
ungroup()
datMeans
View(datMeans)
envDat <- dat2 %>% filter(era == "present")
summary(envDat)
envDat <- dat2 %>% filter(era == "present") %>%
group_by(species, site, era, sampleArea) %>%
summarise(lat_mean = mean(lat),
long_mean = mean(long),
tidalHeight = mean(tideHTm))
envDat <- dat2 %>% filter(era == "present") %>%
group_by(species, site, era, sampleArea) %>%
summarise(lat_mean = mean(lat),
long_mean = mean(long),
tidalHeight = mean(tideHTm)) %>%
ungroup()
envDat
datMeans
names(envDat)
names(datMeans)
envDat %>% select(sampleArea, lat_mean:tidalHeight)
dm2 <- envDat %>% select(sampleArea, lat_mean:tidalHeight) %>%
inner_join(., datMeans)
dm2 <- envDat %>% select(sampleArea, lat_mean:tidalHeight) %>%
inner_join(., datMeans, by = "sampleArea")
dm2
View(dm2)
dm2 <- envDat %>% select(sampleArea, lat_mean:tidalHeight) %>%
inner_join(datMeans, .,  by = "sampleArea")
dm2
names(dm2)
df_final <- dm2 %>% select(-c(exposure, yearColton, point, year)) %>%
rename(size_rep = size_mean, size_error = size_CI,
sample_size = size_n) %>%
arrange(species, site, year)
df_final <- dm2  %>%
rename(size_rep = size_mean, size_error = size_CI,
sample_size = size_n) %>%
arrange(species, site, year)
head(df_final)
View(df_final)
dfMeta <- data.frame(
study = "Elahi2015",
studySub = NA,
fig_table = "raw_data",
species = df_final$species,
site = df_final$sampleArea,
size_rep = df_final$size_rep,
size_units = "mm",
size_error = df_final$size_error,
size_error_type = "CI",
time_rep = NA,
time_error = NA,
year = df_final$year,
year_error = NA,
year_error_type = NA,
sample_size = df_final$sample_size,
sample_size_units = "number of snails"
)
write.csv(dfMeta, "sbs_meta/output/dfMeta_Elahi2015.csv")
?gsub
gsub(".", "_", dm2$species)
dm2$species
gsub("[.]", "_", dm2$species)
dm2$species <- gsub("[.]", "_", dm2$species)
dm2
names(dm2)
df_final <- dm2  %>%
rename(size_rep = size_mean, size_error = size_CI,
sample_size = size_n) %>%
arrange(species, site, year)
head(df_final)
dfMeta <- data.frame(
study = "Elahi2015",
studySub = NA,
fig_table = "raw_data",
species = df_final$species,
site = df_final$sampleArea,
size_rep = df_final$size_rep,
size_units = "mm",
size_error = df_final$size_error,
size_error_type = "CI",
time_rep = NA,
time_error = NA,
year = df_final$year,
year_error = NA,
year_error_type = NA,
sample_size = df_final$sample_size,
sample_size_units = "number of snails"
)
View(dfMeta)
write.csv(dfMeta, "sbs_meta/output/dfMeta_Elahi2015.csv")
unique(dfMeta$species)
elahi <- read.csv("sbs_meta/output/dfMeta_Elahi2015.csv")
fisher <- read.csv("sbs_meta/output/dfMeta_Fisher2009.csv")
roy <- read.csv("sbs_meta/output/dfMeta_Roy2003.csv")
View(elahi)
dat <- rbind(elahi, fisher, roy)
summary(dat)
dat %>%
ggplot(year, size_rep, color = species) +
geom_point() +
facet_wrap(~ study)
dat %>%
ggplot(aes(year, size_rep, color = species)) +
geom_point() +
facet_wrap(~ study)
dat %>%
ggplot(aes(year, size_rep, color = species)) +
geom_point() + geom_line() +
facet_wrap(~ study)
head(dat)
dat %>%
ggplot(aes(year, size_rep, color = species, group = site)) +
geom_point() + geom_line(group = site) +
facet_wrap(~ study)
dat %>%
ggplot(aes(year, size_rep, color = species, group = site)) +
geom_point() + geom_line(aes(group = site), data = dat) +
facet_wrap(~ study)
ggplot(aes(year, size_rep, color = species, group = c(species, site)) +
dat %>%
ggplot(aes(year, size_rep, color = species, group = c(species, site)) +
geom_point() + geom_line(aes(group = site), data = dat) +
facet_wrap(~ study)
dat %>%
ggplot(aes(year, size_rep, color = species, group = c(species, site))) +
geom_point() + geom_line(aes(group = c(species, site)), data = dat) +
facet_wrap(~ study)
unique(dat$site)
View(roy)
head(dat)
dat %>% filter(site != "CNM") %>%
ggplot(aes(year, size_rep)) +
geom_point() + geom_line(aes(species), data = dat) +
facet_wrap(~ species)
dat %>% filter(site != "CNM") %>%
ggplot(aes(year, size_rep)) +
geom_point() +
facet_wrap(~ species)
summary(dat)
View(dat)
dat %>% filter(site != "CNM") %>%
ggplot(aes(year, size_rep)) +
geom_point() +
facet_wrap(~ species, scales = "free_y")
dat %>% filter(site != "CNM", color = site) %>%
ggplot(aes(year, size_rep)) +
geom_point() +
facet_wrap(~ species, scales = "free_y")
dat %>% filter(site != "CNM") %>%
ggplot(aes(year, size_rep, color = site)) +
geom_point() +
facet_wrap(~ species, scales = "free_y")
dat %>% filter(site != "CNM") %>%
ggplot(aes(year, size_rep, color = site)) +
geom_point() +
facet_wrap(~ species, scales = "free_y") +
theme(legend.position = "none")
dat %>% filter(site != "CNM") %>%
ggplot(aes(year, size_rep, color = site)) +
geom_point() + geom_line() +
facet_wrap(~ species, scales = "free_y") +
theme(legend.position = "none") +
geom_errorbar(ymax = size_rep + size_ci, ymin = size_rep - size_ci)
dat %>% filter(site != "CNM") %>%
ggplot(aes(year, size_rep, color = site)) +
geom_point() + geom_line() +
facet_wrap(~ species, scales = "free_y") +
theme(legend.position = "none") +
geom_errorbar(aes(ymax = size_rep + size_ci, ymin = size_rep - size_ci))
head(dat)
dat %>% filter(site != "CNM") %>%
ggplot(aes(year, size_rep, color = site)) +
geom_point() + geom_line() +
facet_wrap(~ species, scales = "free_y") +
theme(legend.position = "none") +
geom_errorbar(aes(ymax = size_rep + size_error, ymin = size_rep - size_error))
dat %>% #filter(site != "CNM") %>%
ggplot(aes(year, size_rep, color = site)) +
geom_point() + geom_line() +
facet_wrap(~ species, scales = "free_y") +
theme(legend.position = "none") +
geom_errorbar(aes(ymax = size_rep + size_error, ymin = size_rep - size_error))
theme_set(theme_bw(base_size = 12))
dat %>% #filter(site != "CNM") %>%
ggplot(aes(year, size_rep, color = site)) +
geom_point() + geom_line() +
facet_wrap(~ species, scales = "free_y") +
theme(legend.position = "none") +
geom_errorbar(aes(ymax = size_rep + size_error, ymin = size_rep - size_error))
dat %>% #filter(site != "CNM") %>%
ggplot(aes(year, size_rep, color = site)) +
geom_point() + geom_line() +
facet_wrap(~ species + study, scales = "free_y") +
theme(legend.position = "none") +
geom_errorbar(aes(ymax = size_rep + size_error, ymin = size_rep - size_error))
ggsave("sbs_meta/meta_figs/size_change_by_spp.png")
ggsave("sbs_meta/meta_figs/size_change_by_spp.png", height = 7,width = 7)
?geom_errorbar
dat %>% #filter(site != "CNM") %>%
ggplot(aes(year, size_rep, color = site)) +
geom_point() + geom_line() +
facet_wrap(~ species + study, scales = "free_y") +
theme(legend.position = "none") +
geom_errorbar(aes(ymax = size_rep + size_error,
ymin = size_rep - size_error), width = 0.2)
dat %>% #filter(site != "CNM") %>%
ggplot(aes(year, size_rep, color = site)) +
geom_point() + geom_line() +
facet_wrap(~ species + study, scales = "free_y") +
theme(legend.position = "none") +
geom_errorbar(aes(ymax = size_rep + size_error,
ymin = size_rep - size_error), width = 1)
ggsave("sbs_meta/meta_figs/size_change_by_spp.png", height = 7,width = 7)
dat %>% #filter(site != "CNM") %>%
ggplot(aes(year, size_rep, color = site)) +
geom_point() + geom_line() +
facet_wrap(~ species + study, scales = "free_y") +
theme(legend.position = "none") +
geom_errorbar(aes(ymax = size_rep + size_error,
ymin = size_rep - size_error), width = 5)
ggsave("sbs_meta/meta_figs/size_change_by_spp.png", height = 7,width = 7)
dat %>% #filter(site != "CNM") %>%
ggplot(aes(year, size_rep, color = site)) +
geom_point() + geom_line() +
facet_wrap(~ species + study, scales = "free_y") +
theme(legend.position = "none") +
geom_errorbar(aes(ymax = size_rep + size_error,
ymin = size_rep - size_error), width = 3)
ggsave("sbs_meta/meta_figs/size_change_by_spp.png", height = 7,width = 7)
dat %>% #filter(site != "CNM") %>%
ggplot(aes(year, size_rep, color = site)) +
geom_point() + geom_line() +
facet_wrap(~ species, scales = "free_y") +
theme(legend.position = "none") +
geom_errorbar(aes(ymax = size_rep + size_error,
ymin = size_rep - size_error), width = 3)
source('~/github/sbs_analysis/sbs_meta/meta_analysis/assemble_scraped_data.R', echo=TRUE)
dat %>% #filter(site != "CNM") %>%
ggplot(aes(year, size_rep, color = site)) +
geom_point() + geom_line() +
facet_wrap(~ species + study, scales = "free_y") +
theme(legend.position = "none") +
geom_errorbar(aes(ymax = size_rep + size_error,
ymin = size_rep - size_error), width = 3)
ggsave("sbs_meta/meta_figs/size_change_by_spp.png", height = 7,width = 7)
View(roy)
