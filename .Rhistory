annual_mean
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = FALSE)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = FALSE)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
View(summer_annual)
## Collate annual data
summer_annual <- summer_annual %>% filter(year < 2011)
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
air_annual_long <- annual_df_long %>%
mutate(dataset = "Air")
# Plot
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = T)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = T)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
summer_annual <- summer_annual %>% filter(year < 2011)
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
air_annual_long <- annual_df_long %>%
mutate(dataset = "Air")
# Plot
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
winter_annual <- winter_annual %>% filter(year < 2011)
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
air_annual_long <- annual_df_long %>%
mutate(dataset = "Air")
# Plot
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = F)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = F)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
summer_annual <- summer_annual %>% filter(year < 2011)
winter_annual <- winter_annual %>% filter(year < 2011)
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
air_annual_long <- annual_df_long %>%
mutate(dataset = "Air")
# Plot
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = F)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = T)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
summer_annual <- summer_annual %>% filter(year < 2011)
winter_annual <- winter_annual %>% filter(year < 2011)
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
air_annual_long <- annual_df_long %>%
mutate(dataset = "Air")
# Plot
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
dat2 <- dat %>% filter(month == 12 | month == 1 | month == 2)
my_quant = 0.25
dat2 <- dat2 %>%
group_by(year, month) %>%
mutate(threshold = quantile(tempC, my_quant, na.rm = TRUE)) %>%
ungroup() %>%
filter(tempC <= threshold) # note less than
head(dat2)
get_summer_annual_means <- function(dat, my_quant = 0.75, remove = FALSE){
dat2 <- dat %>% filter(month == 7 | month == 8 | month == 9)
if(remove == TRUE){
dat2 <- dat2 %>%
group_by(year, month) %>%
mutate(threshold = quantile(tempC, my_quant, na.rm = TRUE)) %>%
ungroup() %>%
filter(tempC >= threshold) # note greater than
}
dat_annual <- dat2 %>% group_by(year) %>%
summarise(tempC = mean(tempC, na.rm = TRUE),
n = n()) %>%
ungroup()
return(dat_annual)
}
get_winter_annual_means <- function(dat, my_quant = 0.25, remove = FALSE){
dat2 <- dat %>% filter(month == 12 | month == 1 | month == 2)
if(remove == FALSE){
dat2 <- dat2 %>%
group_by(year, month) %>%
mutate(threshold = quantile(tempC, my_quant, na.rm = TRUE)) %>%
ungroup() %>%
filter(tempC <= threshold) # note less than
}
dat_annual <- dat2 %>% group_by(year) %>%
summarise(tempC = mean(tempC, na.rm = TRUE),
n = n()) %>%
ungroup()
return(dat_annual)
}
dat <- monterey %>%
rename(tempC = air_obs) %>%
select(dateR, month, year, tempC) %>% tbl_df()
dat
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = T)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = T)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
summer_annual <- summer_annual %>% filter(year < 2011)
winter_annual <- winter_annual %>% filter(year < 2011)
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
annual_df
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
air_annual_long <- annual_df_long %>%
mutate(dataset = "Air")
# Plot
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = F)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
summer_annual <- summer_annual %>% filter(year < 2011)
winter_annual <- winter_annual %>% filter(year < 2011)
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
air_annual_long <- annual_df_long %>%
mutate(dataset = "Air")
# Plot
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
dat2 <- dat %>% filter(month == 12 | month == 1 | month == 2)
dat2
summary(dat2)
my_quant = 0.25
dat2 <- dat2 %>%
group_by(year, month) %>%
mutate(threshold = quantile(tempC, my_quant, na.rm = TRUE)) %>%
ungroup() %>%
filter(tempC <= threshold) # note less than
summary(dat2)
dat_annual <- dat2 %>% group_by(year) %>%
summarise(tempC = mean(tempC, na.rm = TRUE),
n = n()) %>%
ungroup()
dat_annual
get_summer_annual_means <- function(dat, my_quant = 0.75, remove = FALSE){
dat2 <- dat %>% filter(month == 7 | month == 8 | month == 9)
if(remove == TRUE){
dat2 <- dat2 %>%
group_by(year, month) %>%
mutate(threshold = quantile(tempC, my_quant, na.rm = TRUE)) %>%
ungroup() %>%
filter(tempC >= threshold) # note greater than
}
dat_annual <- dat2 %>% group_by(year) %>%
summarise(tempC = mean(tempC, na.rm = TRUE),
n = n()) %>%
ungroup()
return(dat_annual)
}
get_winter_annual_means <- function(dat, my_quant = 0.25, remove = FALSE){
dat2 <- dat %>% filter(month == 12 | month == 1 | month == 2)
if(remove == FALSE){
dat2 <- dat2 %>%
group_by(year, month) %>%
mutate(threshold = quantile(tempC, my_quant, na.rm = TRUE)) %>%
ungroup() %>%
filter(tempC <= threshold) # note less than
}
dat_annual <- dat2 %>% group_by(year) %>%
summarise(tempC = mean(tempC, na.rm = TRUE),
n = n()) %>%
ungroup()
return(dat_annual)
}
get_winter_annual_means <- function(dat, my_quant = 0.25, remove = FALSE){
dat2 <- dat %>% filter(month == 12 | month == 1 | month == 2)
if(remove == TRUE){
dat2 <- dat2 %>%
group_by(year, month) %>%
mutate(threshold = quantile(tempC, my_quant, na.rm = TRUE)) %>%
ungroup() %>%
filter(tempC <= threshold) # note less than
}
dat_annual <- dat2 %>% group_by(year) %>%
summarise(tempC = mean(tempC, na.rm = TRUE),
n = n()) %>%
ungroup()
return(dat_annual)
}
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = F)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = F)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
summer_annual <- summer_annual %>% filter(year < 2011)
winter_annual <- winter_annual %>% filter(year < 2011)
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
air_annual_long <- annual_df_long %>%
mutate(dataset = "Air")
# Plot
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = T)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = T)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
summer_annual <- summer_annual %>% filter(year < 2011)
winter_annual <- winter_annual %>% filter(year < 2011)
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
air_annual_long <- annual_df_long %>%
mutate(dataset = "Air")
# Plot
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = T)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = T)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
sst_annual_long <- annual_df_long %>%
mutate(dataset = "Seawater")
# Plot
sst_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
dat <- sst_hms %>% filter(year > 1937 & year < 2016)
# What are the warmest and coldest months?
dat %>% group_by(month) %>%
summarise(meanTemp = mean(tempC)) %>% ungroup() %>%
arrange(meanTemp)
# Coldest == Dec, Jan, Feb
# Warmest == July, Aug, Sep
##### SELECT SUMMER, WINTER TEMPS #####
# I will use the top 25th percentile of summer temps and bottom 25th percentile of winter temps
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = T)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = T)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
sst_annual_long <- annual_df_long %>%
mutate(dataset = "Seawater")
# Plot
sst_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
# I will use the top 25th percentile of summer temps and bottom 25th percentile of winter temps
remove_data = TRUE
remove_data
source('~/github/sbs_analysis/2_summarise_data/summarise_hms_sst.R')
dat <- sst_hms %>% filter(year > 1937 & year < 2016)
# What are the warmest and coldest months?
dat %>% group_by(month) %>%
summarise(meanTemp = mean(tempC)) %>% ungroup() %>%
arrange(meanTemp)
# Coldest == Dec, Jan, Feb
# Warmest == July, Aug, Sep
##### SELECT SUMMER, WINTER TEMPS #####
# I will use the top 25th percentile of summer temps and bottom 25th percentile of winter temps
remove_data = F
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = remove_data)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = remove_data)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
sst_annual_long <- annual_df_long %>%
mutate(dataset = "Seawater")
# Plot
sst_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
dat <- monterey %>% rename(tempC = air_obs) %>%
select(dateR, month, year, tempC) %>% tbl_df()
##### SELECT SUMMER, WINTER TEMPS #####
# I will use the top 25th percentile of summer temps and bottom 25th percentile of winter temps
remove_data = F
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = remove_data)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = remove_data)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
summer_annual <- summer_annual %>% filter(year < 2011)
winter_annual <- winter_annual %>% filter(year < 2011)
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
air_annual_long <- annual_df_long %>%
mutate(dataset = "Air")
# Plot
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
##### SELECT SUMMER, WINTER TEMPS #####
# I will use the top 25th percentile of summer temps and bottom 25th percentile of winter temps
remove_data = T
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = remove_data)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = remove_data)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
summer_annual <- summer_annual %>% filter(year < 2011)
winter_annual <- winter_annual %>% filter(year < 2011)
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
air_annual_long <- annual_df_long %>%
mutate(dataset = "Air")
# Plot
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
dat %>% group_by(month) %>%
summarise(meanTemp = mean(tempC)) %>% ungroup() %>%
arrange(meanTemp)
# Coldest == Dec, Jan, Feb
# Warmest == July, Aug, Sep
##### SELECT SUMMER, WINTER TEMPS #####
# I will use the top 25th percentile of summer temps and bottom 25th percentile of winter temps
remove_data = F
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = remove_data)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = remove_data)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
sst_annual_long <- annual_df_long %>%
mutate(dataset = "Seawater")
# Plot
sst_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
dat <- sst_hms %>% filter(year > 1937 & year < 2016)
# What are the warmest and coldest months?
dat %>% group_by(month) %>%
summarise(meanTemp = mean(tempC)) %>% ungroup() %>%
arrange(meanTemp)
# Coldest == Dec, Jan, Feb
# Warmest == July, Aug, Sep
##### SELECT SUMMER, WINTER TEMPS #####
# I will use the top 25th percentile of summer temps and bottom 25th percentile of winter temps
remove_data = F
summer_annual <- get_summer_annual_means(dat, my_quant = 0.75, remove = remove_data)
winter_annual <- get_winter_annual_means(dat, my_quant = 0.25, remove = remove_data)
annual_mean <- dat %>% group_by(year) %>%
summarise(mean = mean(tempC, na.rm = TRUE)) %>%
ungroup() %>% filter(!is.na(mean))
## Collate annual data
annual_df <- annual_mean %>%
mutate(minimum = winter_annual$tempC,
maximum = summer_annual$tempC)
# Get in long format
annual_df_long <- annual_df %>%
gather(key = metric, value = tempC, mean:maximum) %>%
filter(!is.na(tempC))
# Resave
sst_annual_long <- annual_df_long %>%
mutate(dataset = "Seawater")
# Plot
sst_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
# Plot
air_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
# Plot
sst_annual_long %>%
ggplot(aes(year, tempC, color = metric)) +
geom_line() +
geom_smooth(method = "lm")
